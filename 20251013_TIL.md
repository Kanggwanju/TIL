# ğŸ—“ï¸ 2025ë…„ 10ì›” 13ì¼ TIL



## ë„ì»¤ ì»´í¬ì¦ˆ
- ì—¬ëŸ¬ ì»¨í…Œì´ë„ˆë¡œ êµ¬ì„±ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì •ì˜í•˜ê³  ì‹¤í–‰í•˜ê¸° ìœ„í•œ ë„êµ¬
- YAML íŒŒì¼(docker-compose.yml)ì„ í†µí•´ ì„œë¹„ìŠ¤, ë„¤íŠ¸ì›Œí¬, ë³¼ë¥¨ ë“±ì„ êµ¬ì„±í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆì–´ ë³µì¡í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‰½ê²Œ ë°°í¬ ê°€ëŠ¥


ì„¸ ê°œì˜ ì»¨í…Œì´ë„ˆ(ë¦¬ì•¡íŠ¸, ìŠ¤í”„ë§ APP, DB)ë¥¼ ì‘ë™ì‹œí‚¤ê¸° ìœ„í•´ì„œëŠ” ì„¸ ë²ˆì˜ ì‹¤í–‰ í•„ìš”
ë„ì»¤ ì»´í¬ì¦ˆë¥¼ ì´ìš©í•˜ë©´ ì´ë¥¼ ë¬¶ì–´ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆìŒ
ì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ë„ ìˆì§€ë§Œ ë„ì»¤ ì»´í¬ì¦ˆë¥¼ ì‚¬ìš©í•˜ë©´ ê²½ëŸ‰í™”ëœ ì»¨í…Œì´ë„ˆ ì§‘í•©ì„ ì²˜ë¦¬ ê°€ëŠ¥

## ë„ì»¤ ì»´í¬ì¦ˆ ì„¤ì¹˜
- Docker Desktopì— í¬í•¨ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ë³„ë„ ì„¤ì¹˜ê°€ í•„ìš” ì—†ìŒ
- Linux ì‚¬ìš©ìì˜ ê²½ìš° ë„ì»¤ ê³µì‹ ì‚¬ì´íŠ¸ì—ì„œ ë³„ë„ë¡œ ì„¤ì¹˜

## ê¸°ë³¸ ëª…ë ¹ì–´
- `docker-compose up`: ë„ì»¤ ì»´í¬ì¦ˆ íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹œì‘
- `docker-compose up -d`: ë°±ê·¸ë¼ìš´ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰
- `docker-compose down`: ì‹¤í–‰ ì¤‘ì¸ ì„œë¹„ìŠ¤ë¥¼ ì¤‘ì§€í•˜ê³  ê´€ë ¨ ë¦¬ì†ŒìŠ¤ë¥¼ ì œê±°
- `docker-compose ps`: ë„ì»¤ ì»´í¬ì¦ˆë¡œ ê´€ë¦¬ë˜ëŠ” ì»¨í…Œì´ë„ˆì˜ ìƒíƒœ í™•ì¸

---

## ìŠ¤í”„ë§ ë¶€íŠ¸ ëª…ë ¹ì–´ ì‹¤í–‰

### ì¸í…”ë¦¬ì œì´ì—ì„œ ì„¤ì¹˜í•œ jdk í™˜ê²½ë³€ìˆ˜ ì„¤ì •

1. ë³€ìˆ˜ ìƒì„±
- ìƒˆë¡œ ë§Œë“¤ê¸°
- ë³€ìˆ˜ ì´ë¦„: JAVA_HOME
- ë³€ìˆ˜ ê°’: C:\Users\user\.jdks\corretto-17.0.16 (binì˜ ìƒìœ„ í´ë” ì„ íƒ)

2. Path í™˜ê²½ë³€ìˆ˜ ì„¤ì •
- Path ì§„ì…
- ìƒˆë¡œ ë§Œë“¤ê¸°
- %JAVA_HOME%\bin

### ì‹¤í–‰

1. `./gradlew clean build`
- ì´ì „ ë¹Œë“œë¥¼ ì§€ìš°ê³  ìƒˆë¡œ ë¹Œë“œ

2. ë¹Œë“œë¡œ ìƒì„±ëœ ìŠ¤ëƒ…ìƒ· ì‹¤í–‰
- `java -jar build/libs/demo-0.0.1-SNAPSHOT.jar`
- `application-dev.yml` ì‚¬ìš©
  - `java -jar build/libs/demo-0.0.1-SNAPSHOT.jar --spring.profiles.active=dev`
---

## `docker-compose.yml` íŒŒì¼ ì‘ì„±

### ì„œë¹„ìŠ¤ ì •ì˜
```yaml
services:
  app:
    image: dockerdemo:latest
    ports:
      - "9004:8687"
    environment:
      SPRING_PROFILES_ACTIVE: 'default'
```

- image: ì‚¬ìš©í•  ì´ë¯¸ì§€ë¥¼ ì§€ì •(ì´ë¯¸ì§€ ë¹Œë“œê°€ ìš°ì„ )
- ports: í˜¸ìŠ¤íŠ¸ì™€ ì»¨í…Œì´ë„ˆ ê°„ í¬íŠ¸ ë§¤í•‘ì„ ì •ì˜
- environment: ì»¨í…Œì´ë„ˆ ë‚´ì—ì„œ ì‚¬ìš©ë  í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¤ì •


### ë„¤íŠ¸ì›Œí¬ ë° ë³¼ë¥¨ ì„¤ì •
```yaml
volumes:
  app-volume:

networks:
  app-network:
    driver: bridge

```

- `volumes` ë° `networks`: ì‚¬ìš©í•  ë³¼ë¥¨ê³¼ ë„¤íŠ¸ì›Œí¬ë¥¼ ì„ ì–¸í•˜ê³  ì˜µì…˜ì„ ì„¤ì • ê°€ëŠ¥

---

## ìŠ¤í”„ë§ ë¶€íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ë„ì»¤ë¼ì´ì¦ˆ

- MariaDB Docker ì´ë¯¸ì§€ ì‚¬ìš©:
  - Docker Hubì—ì„œ MariaDB ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©
  - `docker-compose.yml` íŒŒì¼ì— MariaDB ì„œë¹„ìŠ¤ë¥¼ ì •ì˜í•˜ê³ , ìŠ¤í”„ë§ ë¶€íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ì—°ë™ ì„¤ì •
- ìŠ¤í”„ë§ ë¶€íŠ¸ì™€ MariaDB ì—°ë™:
  - `application.properties` ë˜ëŠ” `application.yml`ì— ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì •ë³´ë¥¼ ì„¤ì •

## ë„ì»¤ ì»´í¬ì¦ˆ ì„¤ì •
- ì´ì „ ì„¤ì •ì—ì„œëŠ” ë¯¸ë¦¬ ë¹Œë“œëœ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš© -> ì»´í¬ì¦ˆ ì„¤ì •
- ë‘ ë²ˆì˜ ì‘ì—…ì„ ê±°ì³ì•¼í–ˆê¸° ë•Œë¬¸ì— ë²ˆê±°ë¡œì›€ì´ ìˆìŒ
- ì„¤ì •ì„ í†µí•´ í•œë²ˆì— ê°€ëŠ¥

### ë„ì»¤ í—ˆë¸Œ DB ì´ë¯¸ì§€ ì°¾ê¸°
- `docker search mariadb â€”filter "is-official=true"`

### Dockerfile
```
# base imageë¡œ jdk 17ë²„ì „ ì§€ì •
FROM amazoncorretto:17

# ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
WORKDIR /app

# ëª¨ë“  ì†ŒìŠ¤ì½”ë“œ ë³µì‚¬
COPY . .

# ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹Œë“œ
RUN ./gradlew clean build -x test

# ì»¤ë§¨ë“œ ì‹¤í–‰
CMD ["java","-jar","build/libs/demo-0.0.1-SNAPSHOT.jar"]

EXPOSE 8687
```

### ìŠ¤í”„ë§ yml
application-dev.yml
```yaml
server:
  port: 8687

spring:
  datasource:
    url: ${SPRING_DATASOURCE_URL}  # Docker í™˜ê²½ë³€ìˆ˜ì—ì„œ ì •ì˜
    username: ${SPRING_DATASOURCE_USERNAME}  # Docker í™˜ê²½ë³€ìˆ˜ì—ì„œ ì •ì˜
    password: ${SPRING_DATASOURCE_PASSWORD}  # Docker í™˜ê²½ë³€ìˆ˜ì—ì„œ ì •ì˜
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true

```


### docker-compose-yml
```yaml
services:
  app:
    #    docker imageë¥¼ ë¹Œë“œí•˜ë ¤ë©´ Dockerfileì´ í•„ìš”í•¨.
    #    ê·¸ íŒŒì¼ì˜ ê²½ë¡œë¥¼ ì¡ì•„ì£¼ë©´ ì•Œì•„ì„œ ë¹Œë“œ
    build: .
    ports:
      - "9004:8687"
    depends_on:
      db:
        condition: service_healthy
    environment:
      SPRING_PROFILES_ACTIVE: 'dev'
      # í•˜ë‹¨ì˜ db ì„¤ì •ê³¼ ì—°ë™í•˜ì—¬ ì‘ì„±
      SPRING_DATASOURCE_URL: jdbc:mariadb://db:3306/dockerdb
      SPRING_DATASOURCE_USERNAME: root
      SPRING_DATASOURCE_PASSWORD: mariadb

  #  Sping Appì—ì„œëŠ” ì´ DBë¥¼ ì‚¬ìš©í•¨.
  db:
    # ë„ì»¤ í—ˆë¸Œì˜ DB ì´ë¯¸ì§€ ë¹Œë“œ
    image: mariadb:10
    environment:
      MYSQL_ROOT_PASSWORD: mariadb
      MYSQL_DATABASE: dockerdb # ì´ˆê¸° DB ìƒì„± ê°€ëŠ¥
    volumes: # DBëŠ” í•˜ë“œë””ìŠ¤í¬ í•„ìš”
      - db-data:/var/lib/mysql
    healthcheck:
      test: [ "CMD", "mysqladmin", "ping", "-h", "localhost" ]  # MariaDBê°€ ì‚´ì•„ìˆëŠ”ì§€ ì²´í¬
      interval: 5s
      timeout: 5s
      retries: 10

volumes:
  db-data:

```

