# 🗓️ 2025년 9월 25일 TIL

## 🔑 오늘의 키워드
- EC2
- 웹서버
- AWS CLI
- 탄력적 IP
- 보안 그룹
- 인스턴스 구매 옵션
- EBS (Elastic Block Store)

---

## EC2 리전 주의사항
- 잘못된 리전에 인스턴스를 생성하면 보이지 않아 과금될 수 있음
- 경로: **계정 → 결제 및 비용 관리 → 청구서 → 서비스별 요금 → EC2 확인**
- 결론: **리전을 확인하고 EC2 생성**

---

## 웹서버 기본 개념
- **웹서버 = HTML 파일을 서빙하는 컴퓨터**
- 실습: EC2 Linux 인스턴스를 웹서버로 사용

```Bash
$ sudo su  // 관리자 권한 변경
# yum update -y // 인스톨러 업데이트 -y옵션은 모두 yes
# yum install httpd -y // httpd라는 웹서버 설치
# service httpd start
# chkconfig httpd on
# cd /var/www/html
```

- EC2 세부 정보 → 퍼블릭 IP or 도메인 확인 → 브라우저 접속
- vi index.html 로 간단한 HTML 작성 후 접속 확인


---

## AWS CLI(AWS Command Line Interface)
- AWS 콘솔(웹사이트에서 클릭으로 하는 것) 대신에 명령어로 AWS를 조작할 수 있게 해주는 도구
- 명령어를 입력해서 EC2, S3, IAM 같은 AWS 서비스들을 관리 가능

### 설치
- https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html
- Windows - https://awscli.amazonaws.com/AWSCLIV2.msi
- 설치 후 실행파일 실행
- cmd에서 `aws help` 입력

---

## 탄력적 아이피와 보안 그룹 (중요!) 

### 탄력적 IP (Elastic IP)
- 인스턴스 생성시 자동으로 할당 받은 Public IP는 인스턴스를 재시작 하면 다른 IP로 재할당 받기에 Public IP 주소가 변경됨
- IP가 계속 변경되면 개발 설정을 계속 변경해줘야함.
- Elastic IP는 인터넷에 연결 가능한 고정적(정적)인 퍼블릭 IP 주소
- EC2 인스턴스의 ENI에 탄력적 IP주소를 연결하면 EC2 인스턴스를 다시 시작해도 동일한 IP주소로 접속할 수 있음
- 사용하지 않으면 IP 주소에 대한 비용이 청구 됨!!


### 탄력적 IP 주소 할당
- Amazon의 IPv4 주소 풀 선택, 할당
- 할당받고 방치하면 과금이 진행된다.
- 체크, 작업, 탄력적 IP 주소 연결, 인스턴스 선택 후 연결

## 탄력적 IP 과금 주의

### 탄력적 IP는 특정 경우에 시간당 $0.005 과금

### 과금되는 조건

1. 탄력적 IP를 발급받고 EC2인스턴스에 연결하지 않은 경우
2. EC2 인스턴스에 연결하였으나 인스턴스가 중지된 경우

### 많이 실수하는 과금 시나리오

1. EC2 인스턴스를 삭제한 후 탄력 IP를 해방(반납)하지 않음
- 탄력적 IP 탭 클릭 → 반납할 IP 클릭 → 작업 → 인스턴스 연결 해제 → 탄력적 IP 릴리스

---

## 보안 그룹 (Security Group)
- EC2 인스턴스에 대한 인바운드 및 아웃바운드 트래픽을 제어하는 인스턴스 수준의 방화벽
- 보안 그룹은 허용 규칙만 지정 가능하고 거부 규칙은 지정 할 수 없음
- 모두 차단, 일부 허용
- 인바운드 트래픽 : 외부에서 EC2 인스턴스로 들어오는 트래픽 (디폴트 값은 허용되어 있는 규칙이 없음)
- 아웃바운드 트래픽 : EC2인스턴스에서 외부로 나가는 트래픽 (디폴트 값은 모두 허용 되어 있음)

- React 개발 시:
  - 리액트 포트 `5173` 오픈 필요
  - 퍼블릭 IPv4 주소:5173으로 접속 가능
  - npm run dev -- --host 0.0.0.0으로 서버 실행
  - 혹은 설정을 통해 npm run dev만 쳐도 할 수 있도록 가능

---

## 인스턴스 구매 옵션

### 온디맨드 인스턴스 (On-Demand Instance)
- 사용한 만큼만 비용을 지불하는 인스턴스
- 처음 60초 이후 초당 과금
- 장기 약정이나 선 결제가 없음
- 단기간 동안 수요를 예측할 수 없는 워크로드 및 중단되어서는 안되는 애플리케이션에 적합
- EC2에서 처음으로 개발 중이거나 시험 중인 애플리케이션 사용에 적합

### 예약 인스턴스 (Reserved Instance)
- 1년 또는 3년 약정으로 구매하는 인스턴스
- 온디맨드에 비해 최대 75% 저렴
- 수요가 꾸준하고 예측가능한 경우에 유용
- 결제옵션은 전체 선결제, 부분 선결제, 선결제 없음 3가지 선택가능
- 선택가능한 예약 인스턴스 유형
    - 표준 예약 인스턴스(Standard Reserved Instances): 인스턴스 타입을 지정하면 예약기간동안 변경 불가능
    - 전환형 예약 인스턴스(Convertible Reserved Instances): 예약기간동안 인스턴스 타입 변경가능
    - 정기 예약 인스턴스(Scheduled Reserved Instances): 지정된 시간, 날짜 동안에 인스턴스가 시작되어 사용(반복적이며 하루, 한 주 또는 한달의 일부 기간 동안 필요한 경우 적합)

### Saving Plans
- 1년 또는 3년 기간에 특정 사용량 약정으로 구매하는 인스턴스
- EC2 뿐만 아니라 Lambda 및 Fargate 서비스도 사용 가능
- 사용량은 시간당 USD 요금으로 측정
- 예약 인스턴스와 달리 EC2 인스턴스 패밀리, 인스턴스 사이즈, 리전, 
  OS 관계 없이 적용 및 변경 가능한 유연성이 있음

### 전용 호스트 / 전용 인스턴스
- 내가 직접 깔아서 (윈도우같은것이 있다면) 사용하고 싶을때

### 스팟 인스턴스
- 사용하지 않는 예비 EC2용량을 경매방식으로 구매하여 사용하는 방식
- 경매 조건에 미달하면 인스턴스가 정지 또는 종료 되므로 언제든지 시작 및 종료가 가능한 경우에 사용
- 언제든 인스턴스가 종료될 수 있기 때문에 서버가 중단없이 지속적으로 실행 되어야하는 경우 사용 안함
- 예약인스턴스 + 스팟인스턴스(짧은 시간 급격하게 증가된 용량이 필요한 경우)의 조합으로 사용


---

## 스토리지 서비스

## Elastic Block Store (EBS)
- EC2에 연결하여 사용하는 블록 스토리지(HDD, SDD)
- EC2 인스턴스 시작 시 AMI가 설치 되는 EBS 루트 볼륨이 생성됨
- EC2 종료 후 EBS가 같이 삭제 되지 않으면 사용 비용이 청구 됨
- 여러 개의 EBS 볼륨을 생성하여 EC2에 추가 연결 가능
- 루트 볼륨은 자동적으로 삭제됨.
- EBS와 EC2는 동일한 가용영역에 있어야 연결 가능
- 볼륨 상태가 사용 가능으로 되어있으면 과금 대상이 될 수 있음
- 볼륨 연결을 통해 사용 중으로 만들어야 함

- 스냅샷(Snapshot) 기능을 통해 EBS 볼륨 백업 가능
- 수명 주기 관리자(Data Life Cycle Manager) 정책을 통해 스냅샷 생성 일
  정을 자동화 가능
- AWS Key Management Service (KMS)를 이용해 EBS 볼륨 암호화 가능

### 볼륨 연결
- 선택, 작업, 볼륨 연결

### 볼륨, 스냅샷 삭제
- 인스턴스 종료하려고 할 때
- 볼륨 분리, 볼륨 삭제 해야 과금 정책에서 피할 수 있음
- 스냅샷 또한 삭제해줘야함.

---

## 📝 최종 정리 핵심
- 리전 확인 필수 (잘못된 리전 → 숨어있는 과금 위험)
- 웹서버 구축: httpd 설치 + index.html 작성
- AWS CLI로 자동화된 AWS 관리 가능
- Elastic IP는 고정 IP 제공하지만 미사용 시 과금 주의
- 보안 그룹 = 허용 규칙만 설정하는 방화벽 (React 포트 직접 열어야 함)
- 인스턴스 구매 옵션: 온디맨드(유연) ↔ 예약/세이빙(저렴) ↔ 스팟(싸지만 위험)
- EBS는 사용/스냅샷 관리 안 하면 과금됨 → 필수 정리 습관화
