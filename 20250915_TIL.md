# ğŸ—“ï¸ 2025ë…„ 9ì›” 15ì¼ TIL

## ğŸ“Œ ì˜¤ëŠ˜ì˜ í‚¤ì›Œë“œ
`WebSocket` `STOMP` `ì‹¤ì‹œê°„ í†µì‹ ` `ì–‘ë°©í–¥ í†µì‹ ` `TCP` `ë©”ì‹œì§€ ë¸Œë¡œì»¤` `êµ¬ë…/ë°œí–‰` `í•¸ë“œì…°ì´í¬` `JWT ì¸ì¦` `SockJS` `ë¸Œë¡œë“œìºìŠ¤íŠ¸`

---

## HTTP vs WebSocket (TCP)

### HTTP (REST API)ì˜ íŠ¹ì§•

```
í´ë¼ì´ì–¸íŠ¸ â†’ ìš”ì²­ â†’ ì„œë²„
í´ë¼ì´ì–¸íŠ¸ â† ì‘ë‹µ â† ì„œë²„
    (ì—°ê²° ì¢…ë£Œ)
```

**íŠ¹ì§•**:
- **ë¹„ì—°ê²°ì„±(Connectionless)**: ìš”ì²­-ì‘ë‹µ í›„ ì—°ê²°ì„ ëŠìŒ
- **ë¬´ìƒíƒœì„±(Stateless)**: ì´ì „ í†µì‹  ë‚´ìš©ì„ ê¸°ì–µí•˜ì§€ ì•ŠìŒ
- **1:1 í†µì‹ **: í•˜ë‚˜ì˜ ìš”ì²­ì— í•˜ë‚˜ì˜ ì‘ë‹µ

**ì í•©í•œ ì‚¬ìš© ì‚¬ë¡€**:
- ê²Œì‹œê¸€ ëª©ë¡ ì¡°íšŒ
- ë°ì´í„° CRUD
- ì¼ë°˜ì ì¸ ì›¹ í˜ì´ì§€ ìš”ì²­

---

### WebSocket (TCP)ì˜ íŠ¹ì§•

```
í´ë¼ì´ì–¸íŠ¸ â”€â”€â”€â”€â”€â”€â”€ ì—°ê²° ìœ ì§€ â”€â”€â”€â”€â”€â”€â”€ ì„œë²„
    â†•                              â†•
ì–‘ë°©í–¥ ì‹¤ì‹œê°„ í†µì‹  (ì„œë²„ë„ ë¨¼ì € ë©”ì‹œì§€ ì „ì†¡ ê°€ëŠ¥)
```

**íŠ¹ì§•**:
- **ì—°ê²°ì„±(Connection-oriented)**: í•œ ë²ˆ ì—°ê²°í•˜ë©´ ê³„ì† ìœ ì§€
- **ì–‘ë°©í–¥ í†µì‹ (Full-duplex)**: í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ëª¨ë‘ ë¨¼ì € ë©”ì‹œì§€ ì „ì†¡ ê°€ëŠ¥
- **ì‹ ë¢°ì„±**: 3-way handshakeë¡œ ì—°ê²° ë³´ì¥
- **ì‹¤ì‹œê°„ì„±**: ì¦‰ê°ì ì¸ ë°ì´í„° ì „ì†¡

**ì í•©í•œ ì‚¬ìš© ì‚¬ë¡€**:
- ì‹¤ì‹œê°„ ì±„íŒ…
- ì•Œë¦¼ ì‹œìŠ¤í…œ
- ì‹¤ì‹œê°„ ê²Œì„
- ì£¼ì‹ ì‹œì„¸ ê°±ì‹ 
- ì‹¤ì‹œê°„ í€´ì¦ˆ (SignBellì˜ ê²½ìš°)

---

## WebSocket ì„¤ì • (Spring Boot)

### 1. ì˜ì¡´ì„± ì¶”ê°€

```groovy
// build.gradle
// WebSocket ê¸°ë³¸ ê¸°ëŠ¥
implementation 'org.springframework.boot:spring-boot-starter-websocket'

// WebSocket ë³´ì•ˆ ê¸°ëŠ¥ (simpDestMatchers ë“±)
implementation 'org.springframework.security:spring-security-messaging'
```

---

### 2. STOMPë€?

**STOMP (Simple Text Oriented Messaging Protocol)**:
- WebSocket ìœ„ì—ì„œ ë™ì‘í•˜ëŠ” **ë©”ì‹œì§€ í”„ë¡œí† ì½œ**
- "ë©”ì‹œì§€ë¥¼ ì–´ë–»ê²Œ ì£¼ê³ ë°›ì„ì§€" ì •í•œ ê°„ë‹¨í•œ ê·œì¹™
- pub/sub(ë°œí–‰/êµ¬ë…) íŒ¨í„´ì„ ì‰½ê²Œ êµ¬í˜„ ê°€ëŠ¥

**ë¹„ìœ **:
- **WebSocket**: ì „í™”ì„  (ì—°ê²° ìì²´)
- **STOMP**: ì „í™” í†µí™” ê·œì¹™ (ëˆ„ê°€ ë§í•˜ê³ , ì–´ë–»ê²Œ ì „ë‹¬í•˜ëŠ”ì§€)

---

### 3. WebSocket ì„¤ì • í´ë˜ìŠ¤

```java
@Configuration
@EnableWebSocketMessageBroker
public class WebSocketConfig implements WebSocketMessageBrokerConfigurer {
    
    @Override
    public void configureMessageBroker(MessageBrokerRegistry registry) {
        // ë©”ì‹œì§€ ë¸Œë¡œì»¤ í™œì„±í™”
        // "/topic"ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ì£¼ì†ŒëŠ” ë¸Œë¡œë“œìºìŠ¤íŠ¸ìš©
        registry.enableSimpleBroker("/topic");
        
        // "/app"ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ë©”ì‹œì§€ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ì „ë‹¬
        registry.setApplicationDestinationPrefixes("/app");
    }
    
    @Override
    public void registerStompEndpoints(StompEndpointRegistry registry) {
        // WebSocket ì—°ê²° ì—”ë“œí¬ì¸íŠ¸ ë“±ë¡
        registry.addEndpoint("/ws")
                .setAllowedOrigins("http://localhost:3000")
                .withSockJS();  // WebSocketì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì € ëŒ€ë¹„
    }
}
```

**ì„¤ì • ì„¤ëª…**:
1. **ì—°ê²° ì—”ë“œí¬ì¸íŠ¸**: `/ws` â†’ ë¸Œë¼ìš°ì €ê°€ ì„œë²„ì™€ WebSocket ì—°ê²°ì„ ë§ºëŠ” ì£¼ì†Œ
2. **ë©”ì‹œì§€ ì£¼ì†Œ ì²´ê³„**:
    - `/topic/*`: êµ¬ë…ìš© ì£¼ì†Œ (ë¸Œë¡œë“œìºìŠ¤íŠ¸)
    - `/app/*`: ë©”ì‹œì§€ ì „ì†¡ìš© ì£¼ì†Œ (ì»¨íŠ¸ë¡¤ëŸ¬)
3. **SockJS**: WebSocketì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ë¥¼ ìœ„í•œ í´ë°± ì˜µì…˜

---

## STOMP í•µì‹¬ ê°œë…

### ì£¼ìš” ìš©ì–´ ì •ë¦¬

| ìš©ì–´ | ì„¤ëª… | ë¹„ìœ  |
|------|------|------|
| **êµ¬ë…(Subscribe)** | íŠ¹ì • ì£¼ì†Œì˜ ë©”ì‹œì§€ë¥¼ ë°›ê² ë‹¤ê³  ì‹ ì²­ | ìœ íŠœë¸Œ ì±„ë„ êµ¬ë… |
| **ì „ì†¡(Send)** | íŠ¹ì • ì£¼ì†Œë¡œ ë©”ì‹œì§€ë¥¼ ë³´ëƒ„ | ì‚¬ì—° ë³´ë‚´ê¸° |
| **í† í”½(Topic)** | ë©”ì‹œì§€ë¥¼ ë°›ì„ ì£¼ì†Œ (ì±„íŒ…ë°© ê°™ì€ ê°œë…) | ì±„íŒ…ë°© ì£¼ì†Œ |
| **ë¸Œë¡œë“œìºìŠ¤íŠ¸(Broadcast)** | ê°™ì€ í† í”½ì„ êµ¬ë…í•œ ëª¨ë‘ì—ê²Œ ë©”ì‹œì§€ ì „ì†¡ | ë‹¨ì²´ ë©”ì‹œì§€ |
| **ë©”ì‹œì§€ ë¸Œë¡œì»¤(Broker)** | ë©”ì‹œì§€ë¥¼ ë°›ì•„ì„œ êµ¬ë…ìë“¤ì—ê²Œ ì „ë‹¬í•˜ëŠ” ì¤‘ê°œì | ìš°ì²´ë¶€ |

---

### ì£¼ì†Œ ì²´ê³„

```
êµ¬ë… ì£¼ì†Œ: /topic/rooms/{roomId}
    â†’ íŠ¹ì • ë°©ì˜ ë©”ì‹œì§€ë¥¼ ë°›ê¸° ìœ„í•œ ì£¼ì†Œ
    
ì „ì†¡ ì£¼ì†Œ: /app/rooms/{roomId}/chat
    â†’ íŠ¹ì • ë°©ìœ¼ë¡œ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ê¸° ìœ„í•œ ì£¼ì†Œ
```

**ì˜ˆì‹œ**:
```
/topic/rooms/1  â†’ ë°© 1ë²ˆì˜ ë©”ì‹œì§€ë¥¼ ë°›ëŠ” ì£¼ì†Œ
/app/rooms/1/chat  â†’ ë°© 1ë²ˆìœ¼ë¡œ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ëŠ” ì£¼ì†Œ
```

---

## WebSocket í†µì‹  íë¦„

### ì±„íŒ…ë°© ì˜ˆì‹œ (ë°© ID: 1)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1ë‹¨ê³„: ì—°ê²° (Handshake)                                â”‚
â”‚  ë¸Œë¼ìš°ì € â†’ "/ws" â†’ ì„œë²„                                â”‚
â”‚  (ì „í™”ì„  ì—°ê²°)                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2ë‹¨ê³„: êµ¬ë… (Subscribe)                                â”‚
â”‚  ë¸Œë¼ìš°ì € â†’ "/topic/rooms/1" êµ¬ë… ì‹ ì²­                  â”‚
â”‚  (ë°© 1ë²ˆì˜ ì†Œì‹ ë°›ê¸° ì‹ ì²­)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3ë‹¨ê³„: ë©”ì‹œì§€ ì „ì†¡ (Send)                              â”‚
â”‚  ë¸Œë¼ìš°ì € â†’ "/app/rooms/1/chat" â†’ ì„œë²„                  â”‚
â”‚  ë©”ì‹œì§€: "ì•ˆë…•í•˜ì„¸ìš”!"                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4ë‹¨ê³„: ë¸Œë¡œë“œìºìŠ¤íŠ¸ (Broadcast)                        â”‚
â”‚  ì„œë²„ â†’ "/topic/rooms/1" â†’ ëª¨ë“  êµ¬ë…ì                  â”‚
â”‚  (ë°© 1ë²ˆì„ êµ¬ë…í•œ ëª¨ë‘ì—ê²Œ ë©”ì‹œì§€ ì „ë‹¬)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ìƒì„¸ íë¦„ ì„¤ëª…

```javascript
// 1. WebSocket ì—°ê²°
const socket = new SockJS('http://localhost:9005/ws');
const stompClient = new Client({ webSocketFactory: () => socket });

// 2. ì—°ê²° ì„±ê³µ í›„
stompClient.onConnect = () => {
    // 3. í† í”½ êµ¬ë… (ë©”ì‹œì§€ ë°›ê¸° ì¤€ë¹„)
    stompClient.subscribe('/topic/rooms/1', (message) => {
        console.log('ë°›ì€ ë©”ì‹œì§€:', message.body);
    });
    
    // 4. ë©”ì‹œì§€ ì „ì†¡
    stompClient.publish({
        destination: '/app/rooms/1/chat',
        body: JSON.stringify({ content: 'ì•ˆë…•í•˜ì„¸ìš”!' })
    });
};
```

---

## êµ¬ë…ê³¼ ì „ì†¡ì˜ ê´€ê³„

### ì¤‘ìš”í•œ ê°œë… ì •ë¦¬

**êµ¬ë…ì€ ì „ì†¡ì˜ ì „ì œì¡°ê±´ì´ ì•„ë‹™ë‹ˆë‹¤!**

```
êµ¬ë… ì—†ì´ë„ ì „ì†¡ ê°€ëŠ¥ âœ…
    â†“
í•˜ì§€ë§Œ ë‚´ê°€ ë³´ë‚¸ ë©”ì‹œì§€ë¥¼ ë°›ìœ¼ë ¤ë©´ êµ¬ë… í•„ìš” âœ…
```

---

### ì‹œë‚˜ë¦¬ì˜¤ ì˜ˆì‹œ

#### ì¼€ì´ìŠ¤ 1: êµ¬ë… O, ì „ì†¡ O
```
ë¸Œë¼ìš°ì €: "/topic/rooms/1" êµ¬ë… âœ…
ë¸Œë¼ìš°ì €: "/app/rooms/1/chat" ë©”ì‹œì§€ ì „ì†¡ âœ…
ì„œë²„: "/topic/rooms/1"ë¡œ ë¸Œë¡œë“œìºìŠ¤íŠ¸ âœ…
ë¸Œë¼ìš°ì €: ë©”ì‹œì§€ ìˆ˜ì‹  âœ…
```
**ê²°ê³¼**: ì •ìƒ ì‘ë™ âœ…

---

#### ì¼€ì´ìŠ¤ 2: êµ¬ë… X, ì „ì†¡ O
```
ë¸Œë¼ìš°ì €: êµ¬ë… ì—†ìŒ âŒ
ë¸Œë¼ìš°ì €: "/app/rooms/1/chat" ë©”ì‹œì§€ ì „ì†¡ âœ…
ì„œë²„: "/topic/rooms/1"ë¡œ ë¸Œë¡œë“œìºìŠ¤íŠ¸ âœ…
ë¸Œë¼ìš°ì €: ë©”ì‹œì§€ ìˆ˜ì‹  ë¶ˆê°€ âŒ
```
**ê²°ê³¼**:
- ë©”ì‹œì§€ ì „ì†¡ì€ ì„±ê³µ
- í•˜ì§€ë§Œ ë‚´ê°€ ë³´ë‚¸ ë©”ì‹œì§€ë¥¼ ë°›ì„ ìˆ˜ ì—†ìŒ (ë¸Œë¡œë“œìºìŠ¤íŠ¸ ìˆ˜ì‹  ë¶ˆê°€)

---

### ì •ë¦¬

| ë™ì‘ | êµ¬ë… ì—¬ë¶€ | ì „ì†¡ ê°€ëŠ¥? | ìˆ˜ì‹  ê°€ëŠ¥? |
|------|-----------|------------|------------|
| ì „ì†¡ | í•„ìš” ì—†ìŒ | âœ… ê°€ëŠ¥ | âŒ ë¶ˆê°€ |
| ìˆ˜ì‹  | í•„ìˆ˜ | - | âœ… ê°€ëŠ¥ |

**ê²°ë¡ **:
- **ì „ì†¡**ì€ êµ¬ë… ì—†ì´ë„ ê°€ëŠ¥
- **ë¸Œë¡œë“œìºìŠ¤íŠ¸ ìˆ˜ì‹ **ì€ êµ¬ë…ì´ í•„ìˆ˜

---

## WebSocket ë³´ì•ˆ ì„¤ì •

### 1. ë³´ì•ˆ ì˜ì¡´ì„± ì¶”ê°€

```groovy
// WebSocket ë©”ì‹œì§€ ë³´ì•ˆ DSL (simpDestMatchers ë“±)
implementation 'org.springframework.security:spring-security-messaging'
```

---

### 2. CookieAuthHandshakeInterceptor

**ì—­í• **: WebSocket ì—°ê²° ì‹œ JWT ì¿ í‚¤ë¡œ ì‚¬ìš©ì ì¸ì¦

```java
@Component
public class CookieAuthHandshakeInterceptor implements HandshakeInterceptor {
    
    @Override
    public boolean beforeHandshake(
        ServerHttpRequest request, 
        ServerHttpResponse response,
        WebSocketHandler wsHandler, 
        Map<String, Object> attributes
    ) throws Exception {
        
        // HTTP ìš”ì²­ì—ì„œ ì¿ í‚¤ ì¶”ì¶œ
        HttpServletRequest servletRequest = 
            ((ServletServerHttpRequest) request).getServletRequest();
        
        Cookie[] cookies = servletRequest.getCookies();
        if (cookies != null) {
            for (Cookie cookie : cookies) {
                if ("ACCESS_TOKEN".equals(cookie.getName())) {
                    // JWT í† í° ê²€ì¦
                    String token = cookie.getValue();
                    // ê²€ì¦ ë¡œì§...
                    
                    // ì¸ì¦ ì •ë³´ë¥¼ WebSocket ì„¸ì…˜ì— ì €ì¥
                    attributes.put("user", authenticatedUser);
                    return true;
                }
            }
        }
        
        return false;  // ì¸ì¦ ì‹¤íŒ¨ ì‹œ ì—°ê²° ê±°ë¶€
    }
    
    @Override
    public void afterHandshake(...) {
        // í•¸ë“œì…°ì´í¬ ì™„ë£Œ í›„ ì²˜ë¦¬
    }
}
```

---

### ë™ì‘ íë¦„

```
1. ë¸Œë¼ìš°ì €ê°€ /wsë¡œ WebSocket ì—°ê²° ìš”ì²­
    â†“ (HTTP ìš”ì²­ì— ì¿ í‚¤ í¬í•¨)
2. CookieAuthHandshakeInterceptorê°€ ì¿ í‚¤ì—ì„œ JWT ì¶”ì¶œ
    â†“
3. JWT ê²€ì¦ (ìœ íš¨ì„±, ë§Œë£Œ í™•ì¸)
    â†“
4. ê²€ì¦ ì„±ê³µ â†’ ì‚¬ìš©ì ì •ë³´ë¥¼ WebSocket ì„¸ì…˜ì— ì €ì¥
    â†“
5. WebSocket ì—°ê²° ì™„ë£Œ
    â†“
6. ì´í›„ STOMP ë©”ì‹œì§€ì—ì„œ "ëˆ„ê°€ ë³´ëƒˆëŠ”ì§€" ì‹ë³„ ê°€ëŠ¥
```

---

### í•¸ë“œì…°ì´í¬(Handshake)ë€?

```
HTTP í”„ë¡œí† ì½œ (ì¼ë°˜ ì›¹ ìš”ì²­)
        â†“
    í•¸ë“œì…°ì´í¬ (í”„ë¡œí† ì½œ ì—…ê·¸ë ˆì´ë“œ)
        â†“
WebSocket í”„ë¡œí† ì½œ (ì–‘ë°©í–¥ ì‹¤ì‹œê°„ í†µì‹ )
```

**í•¸ë“œì…°ì´í¬ ê³¼ì •**:
1. í´ë¼ì´ì–¸íŠ¸ê°€ HTTP ìš”ì²­ìœ¼ë¡œ ì—°ê²° ì‹œë„
2. ì„œë²„ê°€ HTTP 101 ì‘ë‹µ (Switching Protocols)
3. HTTP â†’ WebSocketìœ¼ë¡œ í”„ë¡œí† ì½œ ì „í™˜
4. **ì´ ìˆœê°„ì— ë¸Œë¼ìš°ì €ëŠ” ì¿ í‚¤ë¥¼ í•¨ê»˜ ì „ì†¡**

**ì¤‘ìš”**: í•¸ë“œì…°ì´í¬ ì‹œì ì— ì¸ì¦í•˜ë©´, ì´í›„ ëª¨ë“  ë©”ì‹œì§€ì—ì„œ ì‚¬ìš©ì ì‹ë³„ ê°€ëŠ¥

---

### 3. WebSocket ì „ìš© SecurityConfig

**ì¼ë°˜ HTTPì™€ WebSocketì€ ë³´ì•ˆ ì„¤ì •ì´ ë‹¬ë¼ì•¼ í•¨**

```java
@Configuration
@EnableWebSocketSecurity
public class WebSocketSecurityConfig {
    
    @Bean
    public AuthorizationManager<Message<?>> messageAuthorizationManager(
        MessageMatcherDelegatingAuthorizationManager.Builder messages
    ) {
        messages
            .simpDestMatchers("/app/**").authenticated()  // ì „ì†¡ì€ ì¸ì¦ í•„ìš”
            .simpSubscribeDestMatchers("/topic/**").authenticated()  // êµ¬ë…ë„ ì¸ì¦ í•„ìš”
            .anyMessage().denyAll();  // ë‚˜ë¨¸ì§€ëŠ” ì°¨ë‹¨
        
        return messages.build();
    }
}
```

**ì„¤ì • ì„¤ëª…**:
- `/app/**`: ë©”ì‹œì§€ ì „ì†¡ ì‹œ ì¸ì¦ í•„ìš”
- `/topic/**`: í† í”½ êµ¬ë… ì‹œ ì¸ì¦ í•„ìš”
- ë‚˜ë¨¸ì§€: ëª¨ë‘ ì°¨ë‹¨

---

## Reactì—ì„œ WebSocket ì‚¬ìš©

### 1. STOMP ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜

```json
// package.json
"dependencies": {
  "@stomp/stompjs": "^7.1.1",
  "sockjs-client": "^1.6.1"
}
```

```bash
npm install @stomp/stompjs sockjs-client
```

---

### 2. WebSocket ì—°ê²° ì˜ˆì‹œ

```javascript
import { Client } from '@stomp/stompjs';
import SockJS from 'sockjs-client';

// WebSocket ì—°ê²° í•¨ìˆ˜
const connectWebSocket = (roomId) => {
  // SockJSë¡œ WebSocket ì—°ê²°
  const socket = new SockJS('http://localhost:9005/ws');
  
  // STOMP í´ë¼ì´ì–¸íŠ¸ ìƒì„±
  const stompClient = new Client({
    webSocketFactory: () => socket,
    reconnectDelay: 5000,  // ì¬ì—°ê²° ë”œë ˆì´
    
    onConnect: () => {
      console.log('WebSocket ì—°ê²° ì„±ê³µ');
      
      // í† í”½ êµ¬ë…
      stompClient.subscribe(`/topic/rooms/${roomId}`, (message) => {
        const data = JSON.parse(message.body);
        console.log('ë°›ì€ ë©”ì‹œì§€:', data);
      });
    },
    
    onDisconnect: () => {
      console.log('WebSocket ì—°ê²° ì¢…ë£Œ');
    },
    
    onStompError: (frame) => {
      console.error('STOMP ì—ëŸ¬:', frame);
    }
  });
  
  // ì—°ê²° ì‹œì‘
  stompClient.activate();
  
  return stompClient;
};

// ë©”ì‹œì§€ ì „ì†¡
const sendMessage = (stompClient, roomId, content) => {
  stompClient.publish({
    destination: `/app/rooms/${roomId}/chat`,
    body: JSON.stringify({ content })
  });
};
```

---

## ğŸ¯ ìµœì¢… ì •ë¦¬

- **WebSocketì€ ì‹¤ì‹œê°„ ì–‘ë°©í–¥ í†µì‹ **ì„ ìœ„í•œ í”„ë¡œí† ì½œ (HTTPëŠ” ë‹¨ë°©í–¥ ìš”ì²­-ì‘ë‹µ)
- **STOMPëŠ” WebSocket ìœ„ì—ì„œ ë™ì‘**í•˜ëŠ” ë©”ì‹œì§€ í”„ë¡œí† ì½œ (pub/sub íŒ¨í„´)
- **í•µì‹¬ íë¦„**: ì—°ê²°(/ws) â†’ êµ¬ë…(/topic/*) â†’ ì „ì†¡(/app/*) â†’ ë¸Œë¡œë“œìºìŠ¤íŠ¸
- **êµ¬ë… ì—†ì´ ì „ì†¡ ê°€ëŠ¥**í•˜ì§€ë§Œ, ë¸Œë¡œë“œìºìŠ¤íŠ¸ ìˆ˜ì‹ ì€ êµ¬ë… í•„ìˆ˜
- **í•¸ë“œì…°ì´í¬ ì‹œ JWT ì¸ì¦**: ì¿ í‚¤ì—ì„œ í† í° ì¶”ì¶œí•˜ì—¬ WebSocket ì„¸ì…˜ì— ì‚¬ìš©ì ì •ë³´ ì €ì¥
- **WebSocket ì „ìš© SecurityConfig**: HTTPì™€ ë³„ë„ë¡œ ë©”ì‹œì§€ ë³´ì•ˆ ì„¤ì • í•„ìš”
- **SockJS í´ë°±**: WebSocket ë¯¸ì§€ì› ë¸Œë¼ìš°ì € ëŒ€ë¹„
- í•µì‹¬ í¬ì¸íŠ¸: **ì‹¤ì‹œê°„ í†µì‹  ì´í•´, STOMP ì£¼ì†Œ ì²´ê³„, ì¸ì¦ íë¦„, pub/sub íŒ¨í„´**
