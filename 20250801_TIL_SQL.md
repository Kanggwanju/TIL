# 🗓️ 2025년 8월 1일 TIL - SQL 정리


ROLLUP과 GROUPING
- 계층적인 소계(Subtotal)와 총계(Grand Total)를 자동으로 생성


GROUP BY ROLLUP(A, B): 자동으로 소계와 총계
1. `GROUP BY A, B` (가장 상세한 레벨)
2. `GROUP BY A` (중간 레벨 소계)
3. `전체 집계` (최상위 레벨 총계)


`GROUPING` 함수

GROUPING(컬럼명)

> - 결과가 **0** 이면 -> 진짜 데이터, 즉 **그룹화에 사용된 컬럼**입니다.
> - 결과가 **1** 이면 -> `ROLLUP`에 의해 생성된 **소계 또는 총계를 나타내는 가짜 `NULL`*입니다.

```sql
SELECT
    CASE WHEN GROUPING(user_id) = 1 THEN '전체 합계' ELSE TO_CHAR(user_id) END AS "사용자",
    CASE WHEN GROUPING(post_type) = 1 THEN '사용자 소계' ELSE post_type END AS "게시물 종류",
    SUM(view_count) AS "총 조회수"
FROM POSTS
GROUP BY ROLLUP(user_id, post_type)
ORDER BY user_id, post_type
;
```

GROUP BY CUBE(A, B): 모든 조합으로 집계
1. `GROUP BY A, B`
2. `GROUP BY A` (A 소계)
3. `GROUP BY B` (B 소계) **<-- `ROLLUP`에는 없던 조합!**
4. `전체 집계`

GROUPING SETS(): 내가 원하는 조합만 집계

---
     ROLLUP(A)  ->  A, 전체
     CUBE(A)  ->  A, 전체

     ROLLUP(A, B)
    ->  A + B, A, 전체

     CUBE(A, B)
    -> A + B, A, B, 전체

     ROLLUP((A,B))   ->  A + B, 전체
   
     A, ROLLUP(B)   ->   A ,  A + B
     A, CUBE(B)   ->   A ,  A + B


     GROUPING SETS((A, B))   -> A + B만 하고 끝
     GROUPING SETS(A)   -> A 만 하고 끝
     GROUPING SETS(B)   -> B 만 하고 끝
     GROUPING SETS(())   -> 전체통계만 내고 끝

     GROUPING SETS(A, B)   -> A, B
     GROUPING SETS((A, B),  A, ())   ->  ROLLUP과 같아짐
     GROUPING SETS((A, B),  A, B, ())   ->  CUBE와 같아짐
     GROUPING SETS((A, B),  A, B)   ->  CUBE랑 같게할건데 전체는빼줘

---


윈도우 함수
- 원본 데이터는 그대로 둔 채 각 행에 대한 분석 값을 추가
- 문법: 분석 함수() OVER ( [PARTITION BY 컬럼] [ORDER BY 컬럼] )

`PARTITION BY`: 전체 데이터를 어떤 기준으로 그룹으로 나눌지 지정
`ORDER BY`: 나눠진 각 그룹(파티션) 안에서 어떤 순서로 분석할지 정렬 기준을 정함
 

RANK 보자마자 패턴 맞는지 확인

    RANK            1 2 2 4 4 4 7
    DENSE_RANK      1 2 2 3 3 3 3 3 4
    ROW_NUMBER      1 2 3 4 5 6 7 8

`LAG(컬럼, [칸 수], [기본값])`: **이전(Previous)** 행의 값을 가져옵니다. (과거 엿보기)
`LEAD(컬럼, [칸 수], [기본값])`: **다음(Next)** 행의 값을 가져옵니다. (미래 엿보기)
    - `[칸 수]`: 몇 칸 앞/뒤로 갈지 정합니다. 기본값은 1입니다.
    - `[기본값]`: 가져올 행이 없을 때(예: 첫 행의 이전 행) 표시할 값입니다.


---

노랭이책 87번

추천경로   추천인   피추천인   추천점수      RNUM
=================================================
SNS        나한일     강감찬       75         2
SNS        이순신     강감찬       80         1
응모        홍길동     강감찬       88        1
응모        저절로     이순신       78        2
홈피        저절로     이대로       93        2
홈피        홍두깨     심청이       98        1



SNS        이순신     강감찬       80           
응모        홍길동     강감찬       88            
홈피        홍두깨     심청이       98          

---

노랭이책 89번

  [  X  ]
  
  사원ID   최고연봉
====================
   001      3000
   002      3000
   003      4500
   004      4500
   005      4500
   006      4500
   007      4500



