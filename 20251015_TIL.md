# 🗓️ 2025년 10월 15일 TIL


## 쿠버네티스
- 각 서버의 상태를 실시간으로 체크하고
- 손님이 몰리는 지점에는 자동으로 직원을 더 보내주고(스케일링)
- 어떤 지점에 문제가 생기면 즉시 다른 지점으로 손님을 안내하거나 매장을 복구(자동 복구)

### 컨테이너 오케스트레이션(Container Orchestration)
- 여러 대의 서버(컨테이너)를 마치 하나의 거대한 컴퓨터처럼 지휘하고 관리하는 기술

### 쿠버네티스가 해결해 주는 것
- 자동 복구 (Self-healing)
- 자동 스케일링 (Auto-scaling)
- 무중단 배포 (Zero-downtime Deployment)


## AWS ECR (Elastic Container Registry)
- 도커 허브의 AWS 버전
- ECR로 이미지를 업로드(`docker push`)하는 것은언제나 무료
- 같은 AWS 리전(Region) 내에서 ECR 이미지를 다운로드하는 것은 무료
- ex) 서울 리전(ap-northeast-2)의 ECR에서 서울 리전의 EKS 클러스터로 이미지를 가져오는 것은 비용이 발생하지 않음 (우리 실습이 바로 이 경우)
- ECR에서 집 컴퓨터(로컬)나 다른 클라우드 서버로 이미지를 다운로드하는 경우, 인터넷으로 나가는 데이터 전송 비용이 발생

### 컨테이너 레지스트리 (Container Registry)
- 컨테이너 이미지 보관
- 이미지를 위한 중앙 저장소

옵션 1: 도커 허브
- Docker의 공식 레지스트리로, 전 세계 개발자들이 공개용 이미지를 공유
옵션 2: AWS ECR
- IAM과 완벽하게 연동되어 우리만 접근할 수 있는 비공개 이미지 저장소

---

## ECR 리포지토리 생성
- Elastic Container Registry
- 리포지토리 생성 버튼 클릭
- 리포지토리 이름 설정(my-spring-app)

---

## ECR에 스프링 부트 앱 이미지 올리기 실습

### Step 0: 사전 준비 - AWS CLI 설정
1. IAM 사용자 생성 및 Access Key 발급
  - AWS 콘솔에서 IAM 서비스로 이동하여 '사용자'를 생성(eks-manager)
  - `AdministratorAccess` 정책 연결
  - '보안 자격 증명' 탭에서 '액세스 키 만들기'를 선택하고, 액세스 키 ID와 비밀 액세스 키를 발급

2. AWS CLI 설정
  - 터미널(또는 PowerShell)을 열고 `aws configure` 명령어를 입력
  - 액세스 키 ID와 비밀 액세스 키, AWS 리전(예: ap-northeast-2), 기본 출력 형식(예: json)

### Step 1: ECR에 Docker 로그인하기

1. ECR 콘솔에서 '푸시 명령 보기' 활용
  - 인증 토큰을 검색하고 레지스트리에 대해 Docker 클라이언트를 인증
  - Windows PowerShell 관리자 권한으로 실행
  - macOS / Linux 푸시 명령 입력

### Step 2: Docker 이미지 빌드 및 태깅하기

1. 프로젝트 클론 (https://github.com/Kanggwanju/memo-api)
  - `Dockerfile`이 있는 프로젝트 루트 디렉토리로 이동
2. Docker 이미지 빌드
  - docker buildx build --platform linux/amd64 --load -t my-spring-app .

3. ECR 콘솔에서 '푸시 명령 보기' 활용(3번), 이미지에 ECR 리포지토리 주소로 태그 달기

### Step 3: ECR로 이미지 Push 하기
1. ECR 콘솔에서 '푸시 명령 보기' 활용(4번)