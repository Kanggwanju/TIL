
# 🗓️ 2025년 7월 22일 TIL - SQL 함수 정리

SQL

Function
- 텍스트 데이터를 자유자재로 다룰 수 있게 해주는 아주 유용한 도구


1. 대소문자 변환
- `UPPER(문자열)`: 모든 글자를**대문자**로 바꿔줍니다.
- `LOWER(문자열)`: 모든 글자를**소문자**로 바꿔줍니다.
- `INITCAP(문자열)`:**첫 글자만 대문자**로, 나머지는 소문자로 바꿔줍니다.

```sql
-- USERS 테이블에서 username을 다양한 형태로 변환
SELECT
    username,
    UPPER(username) AS "대문자로 변환",
    LOWER(username) AS "소문자로 변환",
    INITCAP(username) AS "첫 글자만 대문자"
FROM
    USERS
WHERE
    user_id IN (9); -- 헬로키티만 예시로 봄
```
[실행 결과]
| username | 대문자로 변환 | 소문자로 변환 | 첫 글자만 대문자 |
| --- | --- | --- | --- |
| hello_kitty | HELLO_KITTY | hello_kitty | Hello_kitty |


2. 문자열 길이와 위치
   `LENGTH(문자열)`: 글자 수를 세어서 **길이**를 숫자로 알려줌
- 공백도 포함
  `INSTR(문자열, '찾을 단어')`: 문자열 안에서 '찾을 단어'가**몇 번째 위치**에서 처음 나타나는지 알려줌
- 못 찾으면 0을 반환
- 찾은 단어의 제일 앞글자 위치 반환
- DB에서 제일 처음 인덱스는 1임을 기억해야 함.


3. 문자열 자르기와 붙이기
   `SUBSTR(문자열, 시작 위치, 자를 길이)`: 문자열을 원하는 만큼 잘라냄
- 시작 위치에서 시작해서 자를 길이만큼 자르는 걸 의미
- 예) SUBSTR('일이삼사오육', 2, 3) -> 결과: '이삼사'
  `CONCAT(문자열1, 문자열2)`: 두 문자열을 합침 (|| 연산자와 기능은 같음)


4. 채우고, 바꾸고, 다듬기
   `LPAD(문자열, 총 길이, '채울 문자')`: 문자열 왼쪽에 문자를 채워 총 길이를 맞춤
- LPAD(u.user_id, 5, '0') -> 결과: '00001'
  `RPAD(문자열, 총 길이, '채울 문자')`: 문자열 오른쪽에 문자를 채워 총 길이를 맞춤
- RPAD(u.username, 10, '*') -> 결과: 'ryan******'
  `REPLACE(문자열, '바꿀 단어', '새 단어')`: 특정 단어를 찾아 다른 단어로 교체
- REPLACE(p.content, '#일상', '#데일리') -> 결과: #일상이 #데일리로 변경됨
- REPLACE(p.content, '#일상') -> 결과: #일상이 모두 지워짐
  `TRIM(문자열)`: 문자열 양옆의 불필요한 공백을 제거


5. 숫자 데이터 요리하기: 숫자 함수
   `ROUND(숫자, [자리수])`: 지정한 자리수에서 숫자를 반올림
- ROUND(3.141592, 4) -> 3.1416
  `TRUNC(숫자, [자리수])`: 지정한 자리수에서 숫자를 **버림(절사)**
- TRUNC(3.141592, 4) -> 3.1415
  `CEIL(숫자)`: 숫자보다 크거나 같은 정수 중 가장 작은 값을 구함(올림)
- CEIL(3.14) -> 4
  `FLOOR(숫자)`: 숫자보다 작거나 같은 정수 중 가장 큰 값을 구함(내림)
- FLOOR(3.14) -> 3
  `MOD(숫자1, 숫자2)`: 숫자1을 숫자2로 나눈 나머지를 구함
- MOD(user_id, 2) -> 0이 나오면 짝수, 1이 나오면 홀수


6. 시간 데이터 요리하기: 날짜 함수
   `ADD_MONTHS(날짜, 숫자)`: 해당 날짜로부터 몇 개월 뒤의 날짜를 계산
   `MONTHS_BETWEEN(날짜1, 날짜2)`: 두 날짜 사이의 개월 수 차이를 계산
   `LAST_DAY(날짜)`: 해당 날짜가 속한 달의 마지막 날
   `NEXT_DAY(날짜, '요일')`: 해당 날짜 이후에 처음으로 오는 특정 요일의 날짜를 알려줌
- NEXT_DAY(registration_date, '금요일')
  `TRUNC(날짜, '기준')`: 날짜를 특정 기준으로 버림 ('MM'이면 해당 월의 1일)
  `ROUND(날짜, '기준')`: 날짜를 특정 기준으로 반올림 ('MM'이면 16일을 기준으로 다음 달 또는 이번 달 1일)

날짜와 숫자, 직접 더하고 빼기 (날짜 연산)

- `날짜 + 1`: 하루 뒤
- `날짜 - 1`: 하루 전
- `날짜1 - 날짜2`: 두 날짜 사이의 일수 차이

- **1시간**:`1/24`
- **1분**:`1/(24*60)`
- **1초**:`1/(24*60*60)`

7. 데이터의 옷 갈아입히기: 변환 함수
   `TO_CHAR(날짜/숫자, '형식')`: 날짜나 숫자를 우리가 원하는 형식의 문자열로 변환
- TO_CHAR(registration_date, 'YYYY"년" MM"월" DD"일" MI"분"') -> 2020년 02월 08일 00분
- TO_CHAR(registration_date, 'YYYY-MM-DD (DY)') -> 2020-02-08 (토)
  `TO_DATE(문자열, '형식')`: 특정 형식의 문자열을 날짜 타입으로 변환
- WHERE creation_date > TO_DATE('2024-05-20', 'YYYY-MM-DD')
- 2024년 5월 20일 이후에 만들어진 것만 가져옴
  `TO_NUMBER(문자열)`: 숫자처럼 생긴 문자열을 숫자 타입으로 변환

8. '없음'을 다루는 기술: NULL 관련 함수
   `NVL(값, NULL일 경우 대체할 값)`: 값이 NULL이면, 정해둔 대체 값으로 바꿔줌
   `NVL2(값, NULL이 아닐 때, NULL일 때)`
   `COALESCE(값1, 값2, 값3, ...)`: 괄호 안의 값들을 순서대로 보면서, 가장 먼저 나오는 NULL이 아닌 값 선택
- COALESCE(null, null, 50, 100) -> 50
  `NULLIF(값1, 값2)`: 두 값이 서로 같으면 NULL을 반환하고, 다르면 첫 번째 값(값1)


9. SQL의 IF문: CASE 표현식
```sql
-- 가입 연도에 따라 등급을 나누고, 게시물 종류를 한글로 바꿔봅시다.
SELECT
    username,
    registration_date,
    CASE
        WHEN TO_CHAR(registration_date, 'YYYY') >= '2023' THEN '🌱 새싹 유저'
        WHEN TO_CHAR(registration_date, 'YYYY') >= '2021' THEN '🌳 기존 유저'
        ELSE '💎 고인물 유저'
    END AS "유저 등급",
    p.post_type,
    CASE p.post_type
        WHEN 'photo' THEN '사진'
        WHEN 'video' THEN '영상'
        ELSE '기타'
    END AS "게시물 종류"
FROM
    USERS u, POSTS p
WHERE
    u.user_id = p.user_id;
```
