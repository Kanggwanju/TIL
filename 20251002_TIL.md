# 🗓️ 2025년 10월 2일 TIL



## DNS설정과 HTTPS


## 백엔드 배포

### 도메인 구매하기

AWS Route 53에서 구매
장점
- AWS 서비스와 호환성이 좋아서 설정이 쉬움
- 가비아에서 구매하면 인증 절차를 수동으로 진행해야함

단점
- 상대적으로 비쌀 수 있는 '유지' 비용
- 제한적인 도메인 종류
- 초보자에게는 다소 복잡한 UI


가비아(Gabia)에서 구매하는 경우
장점
- 저렴, 직관적, 다양한 도메인 지원 등


---

AWS에 도메인 등록

Route S3 -> 호스팅 영역(Hosted zones) -> Create hosted zone

도메인 이름은 구매한 도메인 등록, Public hosted zone으로 해줘야 남들도 들어올 수 있음

가비아에서 네임서버 설정에 AWS에서 등록한 호스팅 영역의
Value/Route traffic to의 4가지 주소를 적으면 된다.
주의점은 제일 마지막의 .은 제거하고 작성해야한다.

확인하는법
```cmd
nslookup -type=NS mydomain.com 8.8.8.8
```

---

SSL/TLS 인증서 발급받기
- https를 사용하기 위해 인증서를 받아야 함

AWS Certificate Manager(ACM) 이동
- 리전 확인 필수!(아시아 태평양(서울))
- 퍼블릭 인증서 요청
- 도메인 이름 지정하기 (와일드카드 방식)
  - *.gwanju.shop
  - gwanju.shop
- 검증 방법 선택 및 요청
  - DNS 검증

Route 53으로 도메인 소유권 검증
- ACM으로 이동
- Route 53에서 레코드 생성 클릭
- 체크된 레코드 생성
- Route 53 - Hosted zones - 구매한 도메인 클릭 - CNAME 타입 레코드가 추가된 것을 확인 가능
- ACM 인증서 검증 상태는 일정시간 대기가 필요(발급됨으로 변경)

---

EC2에 API 배포

인스턴스 생성
- 네트워크 설정
- VPC는 기본
- 보안 그룹 생성
- 보안 그룹 이름 (deploy-ai-study-sg)
- 인바운드 보안 그룹 규칙 (위치 무관 -> 내 IP)

기타 EC2 생성, RDS 생성, 백엔드 서버 env 설정은 생략.

---

로드 밸런서 생성

대상 그룹(Target Group) 만들기
- 로드밸런싱 (대상 그룹)
- 대상 그룹 생성
- 대상 그룹 이름(식별하기 쉬운 이름 자유롭게) 
- 포트 9000, 나머지 기본값
- 사용 가능한 인스턴스 체크
- 아래에 보류 중인 것으로 포함 클릭
- 대상 그룹 생성

애플리케이션 로드 밸런서(ALB) 생성
- 로드밸런싱 (로드밸런서)
- 로드 밸런서 생성
- ALB 생성
- 이름(식별 쉬운 이름)
- 가용 영역 및 서브넷(4가지 다 선택)
- 보안 그룹(디폴트는 x 눌러서 없애고, 새 보안 그룹을 생성하는 링크 클릭)
- 보안 그룹 이름(ai-study-alb-sg)
- 설명(ai-study-alb-sg)
- 인바운드 규칙 (유형: HTTPS, 소스: Anywhere-IPv4)
- 보안 그룹 생성
- ALB 생성 화면으로 돌아가서 생성한 보안 그룹 선택
- 리스너 및 라우팅 (HTTPS 443)
- 라우팅 액션(대상 그룹으로 전달, 이전에 생성한 대상 그룹 선택)
- 기본 SSL/TLS 인증서(이전에 발급한 인증서 선택)
- 로드 밸런서 생성

---

도메인과 ALB 연결

Route 53 호스팅 영역으로 이동
- 이전에 생성했던 도메인(예:gondue.co.kr)을 클릭
- 레코드 생성 클릭
- 레코드 정보 입력 (★가장 중요)
- 레코드 이름(api)
- 별칭 (Alias) 활성화, Allias to Application and Classic Load Balancer, Asia Pacific (Seoul), 이전에 생성한 로드 밸런서 선택
- 레코드 생성

EC2 보안그룹 인바운드 규칙 편집
- 유형(사용자 지정 TCP), 포트 범위(9000), 소스(사용자 지정, 보안 그룹 ai-study-alb-sg)


