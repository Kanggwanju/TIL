# 🗓️ 2025년 10월 2일 TIL

## 📌 오늘의 키워드

`DNS`, `Route 53`, `도메인`, `HTTPS`, `SSL/TLS 인증서`, `ACM`, `ALB`, `대상 그룹`, `네임서버`, `호스팅 영역`

---

## DNS와 HTTPS 개요

### 개념 정리

* **DNS (Domain Name System)**: 도메인 이름을 IP 주소로 변환하는 시스템
* **HTTPS**: HTTP에 SSL/TLS 암호화를 추가한 보안 프로토콜
* **SSL/TLS 인증서**: 웹사이트의 신원을 확인하고 데이터를 암호화하는 디지털 인증서

### 배포 아키텍처

```
[클라이언트]
    ↓ HTTPS 요청 (api.gwanju.shop)
[Route 53 DNS]
    ↓ 도메인 → ALB IP 변환
[Application Load Balancer]
    ↓ SSL/TLS 종료 (인증서 처리)
[대상 그룹]
    ↓ HTTP 트래픽 전달
[EC2 인스턴스 (Spring Boot:9000)]
    ↓
[RDS (MariaDB)]
```

### 포인트

* HTTPS는 검색 엔진 최적화(SEO)와 사용자 신뢰도 향상에 필수
* ALB에서 SSL/TLS 종료를 처리하여 EC2 부하 감소
* Route 53은 DNS 서비스로 도메인과 AWS 리소스를 연결

---

## 도메인 구매

### 개념 정리

* 도메인은 웹사이트의 주소 (예: gwanju.shop, example.com)
* AWS Route 53 또는 외부 도메인 등록 대행사에서 구매 가능

### 구매 옵션 비교

#### AWS Route 53

**장점**

| 항목 | 설명 |
|------|------|
| AWS 통합 | Route 53, ACM, ELB 등과 자동 연동 |
| 자동화 | DNS 설정이 간편하고 자동화됨 |
| 안정성 | AWS 인프라 기반의 높은 가용성 |
| 관리 편의성 | 모든 설정을 AWS 콘솔에서 관리 |

**단점**

| 항목 | 설명 |
|------|------|
| 비용 | 도메인 유지 비용이 다소 높음 |
| 도메인 종류 | 제공하는 TLD(.com, .net 등) 제한적 |
| 학습 곡선 | 초보자에게는 UI가 다소 복잡 |

#### 가비아 (Gabia)

**장점**

| 항목 | 설명 |
|------|------|
| 저렴한 비용 | 도메인 등록 및 유지 비용 저렴 |
| 직관적 UI | 한국어 지원 및 쉬운 인터페이스 |
| 다양한 도메인 | 더 많은 TLD 선택 가능 |
| 고객 지원 | 한국어 고객 지원 |

**단점**

| 항목 | 설명 |
|------|------|
| 수동 설정 | AWS 연동 시 네임서버 수동 설정 필요 |
| 인증 절차 | SSL 인증 시 추가 수동 작업 필요 |

### 추천

* **AWS 초보자 + 간편함 우선**: Route 53
* **비용 절감 + AWS 경험자**: 가비아 + Route 53 호스팅 영역

### 포인트

* 도메인은 연간 구독 방식 (갱신 주의)
* 프로젝트용이라면 `.shop`, `.site` 같은 저렴한 TLD 고려
* 개인 포트폴리오라면 `.me`, `.dev` 추천

---

## Route 53 호스팅 영역 생성

### 개념 정리

* **호스팅 영역 (Hosted Zone)**: 특정 도메인에 대한 DNS 레코드를 관리하는 컨테이너
* Route 53에서 도메인의 DNS 설정을 관리하는 기본 단위

### 호스팅 영역 생성 단계

**1단계: Route 53 콘솔 접속**
1. AWS Management Console → Route 53
2. 좌측 메뉴에서 `Hosted zones` 클릭
3. `Create hosted zone` 버튼 클릭

**2단계: 호스팅 영역 정보 입력**

| 설정 항목 | 입력 값 | 설명 |
|----------|---------|------|
| Domain name | gwanju.shop | 구매한 도메인 입력 |
| Description | (선택 사항) | 호스팅 영역 설명 |
| Type | Public hosted zone | 외부 접속 허용 |

**3단계: 호스팅 영역 생성**
* `Create hosted zone` 클릭
* 자동으로 NS(네임서버)와 SOA 레코드가 생성됨

### 네임서버 정보 확인

호스팅 영역 생성 후, 다음과 같은 네임서버 4개가 표시됨:

```
NS 레코드:
ns-1234.awsdns-12.org.
ns-5678.awsdns-34.com.
ns-9012.awsdns-56.net.
ns-3456.awsdns-78.co.uk.
```

### 포인트

* **Public vs Private**: Public은 인터넷에서 접근 가능, Private는 VPC 내부용
* **비용**: 호스팅 영역당 월 $0.50 + 쿼리당 요금
* **네임서버**: 4개의 네임서버 주소를 반드시 메모해둘 것

---

## 가비아에서 네임서버 설정

### 개념 정리

* 가비아에서 구매한 도메인의 DNS 관리를 AWS Route 53으로 위임
* 네임서버를 AWS Route 53의 주소로 변경하여 연결

### 네임서버 변경 단계

**1단계: 가비아 콘솔 로그인**
1. 가비아 웹사이트 접속 (www.gabia.com)
2. My가비아 → 서비스 관리
3. 구매한 도메인 선택

**2단계: 네임서버 변경**
1. `네임서버 관리` 메뉴 클릭
2. `네임서버 설정` 탭 이동
3. `다른 네임서버 사용` 선택

**3단계: AWS 네임서버 입력**

⚠️ **중요**: Route 53에서 복사한 네임서버 주소의 **마지막 점(.)을 제거**하고 입력

```
AWS에서 복사:
ns-1234.awsdns-12.org.    ← 마지막 점 있음

가비아에 입력:
ns-1234.awsdns-12.org     ← 마지막 점 제거
```

**입력 예시**
```
1차 네임서버: ns-1234.awsdns-12.org
2차 네임서버: ns-5678.awsdns-34.com
3차 네임서버: ns-9012.awsdns-56.net
4차 네임서버: ns-3456.awsdns-78.co.uk
```

**4단계: 적용**
* `적용` 버튼 클릭
* DNS 전파 대기 (최대 48시간, 보통 몇 분 ~ 몇 시간)

### DNS 전파 확인

**Windows (CMD 또는 PowerShell)**
```cmd
nslookup -type=NS gwanju.shop 8.8.8.8
```

**Mac/Linux (Terminal)**
```bash
nslookup -type=NS gwanju.shop 8.8.8.8
```

**정상 응답 예시**
```
Server:  google-public-dns-a.google.com
Address:  8.8.8.8

gwanju.shop nameserver = ns-1234.awsdns-12.org
gwanju.shop nameserver = ns-5678.awsdns-34.com
gwanju.shop nameserver = ns-9012.awsdns-56.net
gwanju.shop nameserver = ns-3456.awsdns-78.co.uk
```

### 온라인 도구로 확인

* https://dnschecker.org
* https://www.whatsmydns.net

위 사이트에서 도메인을 입력하고 NS 레코드 조회

### 포인트

* **전파 시간**: DNS 변경사항이 전 세계에 퍼지는 데 시간 소요
* **캐싱**: 이전 DNS 정보가 캐시되어 있으면 즉시 반영 안 될 수 있음
* **TTL(Time To Live)**: DNS 레코드의 캐시 유지 시간
* **점(.) 제거 필수**: 가비아 등 외부 도메인 업체에서는 마지막 점 제거

---

## SSL/TLS 인증서 발급 (ACM)

### 개념 정리

* **ACM (AWS Certificate Manager)**: SSL/TLS 인증서를 무료로 발급 및 관리하는 AWS 서비스
* HTTPS 통신을 위해 필수
* 인증서는 특정 도메인에 대해 발급되며 ELB, CloudFront 등에 연결 가능

### 인증서 발급 단계

**1단계: ACM 콘솔 접속**

⚠️ **중요**: 리전을 **아시아 태평양(서울) ap-northeast-2**로 설정

1. AWS Management Console → Certificate Manager
2. 우측 상단에서 리전 확인 (서울)
3. `인증서 요청` 버튼 클릭

**2단계: 인증서 유형 선택**
* `퍼블릭 인증서 요청` 선택
* `다음` 클릭

**3단계: 도메인 이름 지정**

**와일드카드 방식 권장**

```
완전히 정규화된 도메인 이름:
*.gwanju.shop         ← 서브도메인 모두 포함 (api, www, admin 등)
gwanju.shop           ← 루트 도메인
```

**도메인 추가 방법**
1. 첫 번째 입력란: `*.gwanju.shop`
2. `이 인증서에 다른 이름 추가` 클릭
3. 두 번째 입력란: `gwanju.shop`

**와일드카드의 장점**
```
하나의 인증서로 다음 모두 커버:
- api.gwanju.shop
- www.gwanju.shop
- admin.gwanju.shop
- blog.gwanju.shop
```

**4단계: 검증 방법 선택**

| 검증 방법 | 설명 | 권장 |
|----------|------|------|
| DNS 검증 | Route 53에 CNAME 레코드 추가로 자동 검증 | ✅ 권장 |
| 이메일 검증 | 도메인 관리자 이메일로 확인 링크 전송 | 수동 작업 필요 |

* `DNS 검증` 선택
* `요청` 버튼 클릭

### 포인트

* **리전 주의**: ELB와 같은 리전에 인증서 생성 필수
* **와일드카드**: `*.domain.com`은 1단계 서브도메인만 커버 (2단계 `api.v1.domain.com`은 별도 인증서 필요)
* **무료**: ACM에서 발급하는 인증서는 완전 무료
* **자동 갱신**: ACM이 자동으로 인증서 갱신 관리

---

## Route 53으로 도메인 소유권 검증

### 개념 정리

* ACM에서 발급한 인증서를 활성화하려면 도메인 소유권 증명 필요
* Route 53에 CNAME 레코드를 추가하여 자동 검증

### 검증 단계

**1단계: ACM에서 레코드 생성**
1. ACM 콘솔로 이동
2. 방금 요청한 인증서 클릭 (상태: 검증 보류 중)
3. `Route 53에서 레코드 생성` 버튼 클릭
4. 도메인 옆 체크박스 선택 (2개 모두)
5. `레코드 생성` 버튼 클릭

**2단계: Route 53 확인**
1. Route 53 → Hosted zones 이동
2. 구매한 도메인(gwanju.shop) 클릭
3. CNAME 타입 레코드 2개가 추가된 것 확인

**CNAME 레코드 예시**
```
이름: _a1b2c3d4e5f6g7h8.gwanju.shop
유형: CNAME
값: _i9j0k1l2m3n4o5p6.acm-validations.aws.
```

**3단계: 검증 완료 대기**
* ACM 콘솔로 돌아가서 새로고침
* 상태가 `검증 보류 중` → `발급됨`으로 변경 (보통 5~10분 소요)

### 검증 프로세스

```
1. ACM 인증서 요청
    ↓
2. Route 53에 CNAME 레코드 생성 (자동)
    ↓
3. AWS가 DNS 쿼리로 도메인 소유권 확인
    ↓
4. 검증 완료 → 인증서 상태: 발급됨
    ↓
5. ELB, CloudFront 등에 인증서 연결 가능
```

### 검증 상태 확인

| 상태 | 설명 | 조치 |
|------|------|------|
| 검증 보류 중 | DNS 레코드 확인 대기 | 5~30분 대기 |
| 발급됨 | 검증 완료, 사용 가능 | ELB에 연결 가능 |
| 실패 | 검증 실패 | DNS 레코드 재확인 |

### 포인트

* **자동 검증**: Route 53 사용 시 클릭 한 번으로 완료
* **수동 검증**: 가비아 등 외부 DNS 사용 시 CNAME 수동 추가 필요
* **대기 시간**: 보통 5~10분, 최대 30분 정도 소요
* **영구 레코드**: 검증용 CNAME 레코드는 삭제하지 말 것 (자동 갱신에 필요)

---

## EC2 인스턴스 생성 및 RDS 생성, 백엔드 서버 env 설정 생략

---

## 대상 그룹 (Target Group) 생성

### 개념 정리

* **대상 그룹**: ALB가 트래픽을 라우팅할 대상(EC2 인스턴스 등)의 논리적 그룹

### 대상 그룹 생성 단계

**1단계: 대상 그룹 콘솔 이동**
1. EC2 → 로드 밸런싱 → `대상 그룹` 클릭
2. `대상 그룹 생성` 버튼 클릭

**2단계: 기본 구성**

| 설정 항목 | 값 | 설명 |
|----------|-----|------|
| 대상 유형 | Instances | EC2 인스턴스 선택 |
| 대상 그룹 이름 | ai-study-api-tg | 식별하기 쉬운 이름 |
| 프로토콜 | HTTP | ALB → EC2는 HTTP 사용 |
| 포트 | 9000 | Spring Boot 실행 포트 |
| VPC | 기본 VPC | EC2와 동일한 VPC |

**3단계: 대상 등록**
1. `사용 가능한 인스턴스` 섹션에서 생성한 EC2 인스턴스 체크
2. `아래에 보류 중인 것으로 포함` 버튼 클릭
3. 포트 `9000` 확인
4. `대상 그룹 생성` 버튼 클릭

### 포인트

* **포트 일치**: 대상 그룹 포트와 Spring Boot 실행 포트 일치 필수
* **보안 그룹**: EC2 보안 그룹에서 포트 9000이 ALB에서 접근 가능하도록 설정 필요

---

## Application Load Balancer (ALB) 생성

### 개념 정리

* **ALB**: Layer 7 로드 밸런서로 HTTP/HTTPS 트래픽 분산
* SSL/TLS 종료를 처리하여 EC2의 부하 감소
* 도메인과 연결되어 HTTPS 엔드포인트 제공

### ALB 생성 단계

**1단계: 로드 밸런서 콘솔 이동**
1. EC2 → 로드 밸런싱 → `로드 밸런서` 클릭
2. `로드 밸런서 생성` 버튼 클릭
3. `Application Load Balancer` 선택 → `생성` 클릭

**2단계: 기본 구성**

| 설정 항목 | 값 | 설명 |
|----------|-----|------|
| 이름 | ai-study-alb | 식별하기 쉬운 이름 |
| 체계 | Internet-facing | 인터넷에서 접근 가능 |
| IP 주소 유형 | IPv4 | |

**3단계: 네트워크 매핑**

**가용 영역 선택**: 최소 2개 이상 선택 (고가용성)

```
✅ ap-northeast-2a (AZ1) - 서브넷 선택
✅ ap-northeast-2b (AZ2) - 서브넷 선택
✅ ap-northeast-2c (AZ3) - 서브넷 선택
✅ ap-northeast-2d (AZ4) - 서브넷 선택
```

**4단계: 보안 그룹 생성**

기본 보안 그룹 제거 후 새 보안 그룹 생성:

1. `새 보안 그룹 생성` 링크 클릭 (새 탭 열림)
2. 보안 그룹 생성:

| 설정 항목 | 값 |
|----------|-----|
| 보안 그룹 이름 | ai-study-alb-sg |
| 설명 | AI Study ALB Security Group |
| VPC | 기본 VPC (EC2와 동일) |

**인바운드 규칙**

| 유형 | 프로토콜 | 포트 | 소스 | 설명 |
|------|---------|------|------|------|
| HTTPS | TCP | 443 | 0.0.0.0/0 | 전 세계 HTTPS 접속 허용 |
| HTTP | TCP | 80 | 0.0.0.0/0 | (선택) HTTP → HTTPS 리다이렉트용 |

3. `보안 그룹 생성` 클릭
4. ALB 생성 탭으로 돌아가기
5. 새로고침 후 방금 생성한 `ai-study-alb-sg` 선택

**5단계: 리스너 및 라우팅**

**HTTPS 리스너 추가**

| 설정 항목 | 값 | 설명 |
|----------|-----|------|
| 프로토콜 | HTTPS | |
| 포트 | 443 | 표준 HTTPS 포트 |
| 기본 작업 | 대상 그룹으로 전달 | |
| 대상 그룹 | ai-study-api-tg | 이전에 생성한 대상 그룹 선택 |

**SSL/TLS 인증서 선택**

| 설정 항목 | 값 |
|----------|-----|
| 인증서 소스 | ACM에서 선택 |
| 인증서 | *.gwanju.shop | 이전에 발급받은 인증서 |

**HTTP → HTTPS 리다이렉트 (선택 사항)**

HTTP 리스너 추가:
1. `리스너 추가` 클릭
2. 프로토콜: HTTP, 포트: 80
3. 기본 작업: `리디렉션 대상`
4. 리디렉션 대상: HTTPS, 포트: 443

**6단계: 요약 및 생성**
* 설정 검토
* `로드 밸런서 생성` 버튼 클릭
* 생성 완료까지 약 2~3분 소요

### ALB 상태 확인

1. 로드 밸런서 목록에서 생성한 ALB 클릭
2. 상태가 `Provisioning` → `Active`로 변경될 때까지 대기

**DNS 이름 확인**
```
DNS 이름: ai-study-alb-1234567890.ap-northeast-2.elb.amazonaws.com
```

### 테스트

ALB DNS 주소로 접속 테스트:
```bash
curl https://ai-study-alb-1234567890.ap-northeast-2.elb.amazonaws.com
```

### 포인트

* **다중 AZ**: 최소 2개 이상의 가용 영역 선택으로 고가용성 확보
* **보안 그룹**: ALB는 0.0.0.0/0(전 세계) 허용, EC2는 ALB에서만 허용
* **SSL/TLS 종료**: ALB에서 HTTPS를 처리하고 EC2로는 HTTP 전달
* **리다이렉트**: HTTP 요청을 HTTPS로 자동 리다이렉트 권장
* **비용**: ALB는 시간당 요금 + LCU 요금 발생

---

## 도메인과 ALB 연결 (Route 53 A 레코드)

### 개념 정리

* Route 53의 A 레코드(Alias)를 생성하여 도메인을 ALB와 연결
* 사용자가 `api.gwanju.shop`으로 접속 시 ALB로 라우팅

### A 레코드 생성 단계

**1단계: Route 53 호스팅 영역 이동**
1. Route 53 → Hosted zones
2. 도메인(gwanju.shop) 클릭

**2단계: 레코드 생성**
1. `레코드 생성` 버튼 클릭

**3단계: 레코드 정보 입력** ⭐ **가장 중요**

| 설정 항목 | 값 | 설명 |
|----------|-----|------|
| 레코드 이름 | api | 결과: api.gwanju.shop |
| 레코드 유형 | A | IPv4 주소 레코드 |
| 별칭 (Alias) | ✅ 활성화 | ALB와 직접 연결 |
| 트래픽 라우팅 대상 | Application and Classic Load Balancer | |
| 리전 | Asia Pacific (Seoul) [ap-northeast-2] | ALB 리전과 일치 |
| 로드 밸런서 | ai-study-alb-xxx | 생성한 ALB 선택 |

**4단계: 레코드 생성**
* `레코드 생성` 버튼 클릭

### A 레코드 vs CNAME 레코드

| 레코드 유형 | 설명 | 사용 사례 |
|-----------|------|----------|
| A (Alias) | IP 주소 또는 AWS 리소스 직접 연결 | 루트 도메인, ALB 연결 |
| CNAME | 다른 도메인 이름으로 리다이렉트 | 서브도메인만 가능 |

**A 레코드 (Alias)의 장점**
* AWS 리소스 직접 연결
* Zone Apex(루트 도메인)에 사용 가능
* 쿼리 요금 무료

### 레코드 설정 예시

```
도메인 구조:
- gwanju.shop (루트) → CloudFront 또는 S3
- api.gwanju.shop (서브도메인) → ALB (백엔드)
- www.gwanju.shop (서브도메인) → S3 또는 CloudFront (프론트엔드)
```

### DNS 전파 확인

**명령어로 확인**
```bash
# A 레코드 조회
nslookup api.gwanju.shop

# 결과 예시
Server:  192.168.0.1
Address:  192.168.0.1#53

Non-authoritative answer:
Name:    api.gwanju.shop
Address: 52.79.123.45
Name:    api.gwanju.shop
Address: 3.35.67.89
```

**브라우저로 확인**
```
https://api.gwanju.shop/health
```

### 포인트

* **Alias 필수**: ALB 연결 시 반드시 Alias 활성화
* **리전 일치**: Route 53 레코드의 리전과 ALB 리전 일치 필요
* **전파 시간**: DNS 전파는 보통 즉시~몇 분 소요 (Route 53은 빠름)
* **HTTPS 자동 적용**: ALB에 인증서가 연결되어 있으므로 자동으로 HTTPS 동작

---

## EC2 보안 그룹 인바운드 규칙 편집

### 개념 정리

* EC2 인스턴스의 보안 그룹을 수정하여 ALB에서만 트래픽을 받도록 설정
* 직접적인 외부 접근을 차단하여 보안 강화

### 보안 그룹 규칙 수정 단계

**1단계: EC2 보안 그룹 찾기**
1. EC2 → 인스턴스 클릭
2. 생성한 인스턴스 선택
3. `보안` 탭 → 보안 그룹 링크 클릭

**2단계: 인바운드 규칙 편집**
1. `인바운드 규칙 편집` 버튼 클릭
2. 기존 규칙 검토

**3단계: 애플리케이션 포트 규칙 수정**

**기존 규칙 (변경 전)**
```
유형: 사용자 지정 TCP
포트: 9000
소스: 0.0.0.0/0 (전 세계)
```

**새 규칙 (변경 후)** ⭐ **보안 강화**
```
유형: 사용자 지정 TCP
프로토콜: TCP
포트 범위: 9000
소스: 사용자 지정 → ai-study-alb-sg (ALB 보안 그룹)
설명: Allow traffic from ALB only
```

**4단계: SSH 규칙 유지**
```
유형: SSH
포트: 22
소스: 내 IP (123.456.789.0/32)
```

**5단계: 규칙 저장**
* `규칙 저장` 버튼 클릭

### 최종 보안 그룹 구조

```
[인터넷]
    ↓ HTTPS:443
[ALB 보안 그룹]
  - 인바운드: 0.0.0.0/0 → 443 (HTTPS)
  - 아웃바운드: EC2 보안 그룹 → 9000
    ↓
[EC2 보안 그룹]
  - 인바운드: ALB 보안 그룹 → 9000 (Spring Boot)
  - 인바운드: 내 IP → 22 (SSH)
  - 아웃바운드: 모든 트래픽 허용
    ↓
[EC2 인스턴스]
```

### 보안 계층 설명

**계층 1: ALB 보안 그룹**
* 전 세계에서 HTTPS(443) 접속 허용
* 외부와의 유일한 접점

**계층 2: EC2 보안 그룹**
* ALB에서만 애플리케이션 포트(9000) 접근 허용
* SSH는 관리자 IP에서만 허용
* 직접적인 외부 접속 차단

**계층 3: NACL (선택 사항)**
* 서브넷 레벨의 추가 방화벽

### 보안 규칙 검증

**1. 외부에서 직접 EC2 접근 차단 확인**
```bash
# EC2 퍼블릭 IP로 직접 접근 시도 (차단되어야 함)
curl http://52.79.123.45:9000
# 타임아웃 발생 → 정상
```

**2. ALB를 통한 접근 성공 확인**
```bash
# 도메인으로 접근 시도 (성공해야 함)
curl https://api.gwanju.shop/health
# HTTP 200 OK → 정상
```

### 포인트

* **보안 강화**: EC2는 ALB를 통해서만 접근 가능
* **소스 지정**: 보안 그룹을 소스로 지정하면 해당 SG를 가진 리소스만 허용
* **SSH 유지**: 관리 목적의 SSH는 내 IP로 제한 유지
* **DDoS 방어**: 직접 접근 차단으로 DDoS 공격 표면 축소
* **확장성**: Auto Scaling 시에도 동일한 보안 그룹 적용 가능

---

## 전체 아키텍처 요약

### 최종 배포 구조

```
[클라이언트: 브라우저]
        ↓
    https://api.gwanju.shop
        ↓
[Route 53 DNS]
  - 호스팅 영역: gwanju.shop
  - A 레코드: api → ALB
        ↓
[ACM SSL/TLS 인증서]
  - *.gwanju.shop
  - gwanju.shop
        ↓
[Application Load Balancer]
  - 리스너: HTTPS:443
  - SSL/TLS 종료
  - 보안 그룹: ai-study-alb-sg (0.0.0.0/0 → 443)
        ↓
[대상 그룹: ai-study-api-tg]
  - 프로토콜: HTTP
  - 포트: 9000
  - Health Check: /health
        ↓
[EC2 인스턴스]
  - Spring Boot :9000
  - 보안 그룹: deploy-ai-study-sg (ALB만 허용)
        ↓
[RDS (MariaDB)]
  - 프라이빗 서브넷
  - 보안 그룹: EC2에서만 접근
```

### 트래픽 흐름

**1. DNS 조회**
```
사용자 → api.gwanju.shop 입력
Route 53 → ALB IP 주소 반환
```

**2. HTTPS 연결**
```
브라우저 → ALB:443 (HTTPS 요청)
ALB → ACM 인증서로 SSL/TLS 핸드셰이크
```

**3. 트래픽 전달**
```
ALB → Health Check로 정상 대상 확인
ALB → 대상 그룹의 EC2:9000 (HTTP로 전달)
```

**4. 애플리케이션 처리**
```
EC2 → Spring Boot 애플리케이션 처리
EC2 → RDS 데이터베이스 조회
EC2 → 응답 반환
```

**5. 응답 반환**
```
ALB ← EC2 (HTTP 응답)
브라우저 ← ALB (HTTPS 응답)
```

### 보안 계층

**계층 1: DNS (Route 53)**
* DDoS 보호 (AWS Shield Standard 자동 적용)
* DNSSEC 지원 가능

**계층 2: 로드 밸런서 (ALB)**
* WAF(Web Application Firewall) 연결 가능
* SSL/TLS 종료로 암호화 통신
* 보안 그룹: 443 포트만 개방

**계층 3: 애플리케이션 (EC2)**
* ALB에서만 접근 가능
* SSH는 관리자 IP만 허용
* 최소 권한 원칙 적용

**계층 4: 데이터베이스 (RDS)**
* 프라이빗 서브넷 배치
* EC2에서만 접근 가능
* 암호화 저장 가능

---

## 🎯 최종 정리

* **도메인 구매** → Route 53 호스팅 영역 생성 → 네임서버 변경 (가비아 사용 시)
* **ACM 인증서 발급**: 와일드카드(`*.gwanju.shop`, `gwanju.shop`) + DNS 검증
* **EC2 배포**: Spring Boot 애플리케이션
* **대상 그룹 생성**: 포트 9000
* **ALB 생성**: HTTPS:443 리스너 + ACM 인증서 연결 + 다중 AZ 선택
* **Route 53 A 레코드**: `api.gwanju.shop` → ALB 연결 (Alias 활성화)
* **보안 강화**: EC2 보안 그룹을 ALB에서만 접근 가능하도록 수정
* **최종 구조**: 사용자 → Route 53 → ALB(HTTPS 종료) → 대상 그룹 → EC2(HTTP:9000) → RDS
