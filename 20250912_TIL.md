# ğŸ—“ï¸ 2025ë…„ 9ì›” 12ì¼ TIL

## ğŸ“Œ ì˜¤ëŠ˜ì˜ í‚¤ì›Œë“œ
`Private Route` `ë¼ìš°íŠ¸ ê°€ë“œ` `@Builder.Default` `@PrePersist` `JPA ì½œë°±` `optional` `nullable` `@AuthenticationPrincipal` `Mock ë°ì´í„°` `React ìµœì í™”` `Zustand ì„±ëŠ¥` `Axios`

---

## Private Route (ë¼ìš°íŠ¸ ê°€ë“œ) - React

### Loader vs Component ë°©ì‹

**Loader ë°©ì‹ì˜ í•œê³„**:
- ë¡œë”© ì¤‘ UIë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ì—†ìŒ
- ì‚¬ìš©ì ê²½í—˜ì´ ë–¨ì–´ì§

**Component ë°©ì‹ì˜ ì¥ì **:
- ë¡œë”© ìƒíƒœë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ìˆìŒ
- ë” ì„¸ë°€í•œ ì œì–´ ê°€ëŠ¥

---

### Private Route ì»´í¬ë„ŒíŠ¸ êµ¬í˜„

```jsx
const PrivateRoute = ({ children }) => {
  const { isAuthenticated, loading, hasCheckedAuth, fetchMe } = useAuthStore();

  // ìµœì´ˆ ì§„ì… ì‹œ ì¸ì¦ ì²´í¬ 1íšŒë§Œ ì‹¤í–‰
  useEffect(() => {
    if (!hasCheckedAuth) {
      fetchMe();
    }
  }, [hasCheckedAuth, fetchMe]);
  
  // ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìëŠ” ë©”ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
  if (!isAuthenticated) {
    return (
      <Navigate
        to='/'
        replace  // ë’¤ë¡œê°€ê¸° ì‹œ ì´ì „ í˜ì´ì§€ë¡œ ëŒì•„ê°€ì§€ ì•Šë„ë¡
      />
    );
  }

  // ì¸ì¦ëœ ì‚¬ìš©ìë§Œ children ë Œë”ë§
  return children;
};
```

**ë™ì‘ ë°©ì‹**:
1. ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ `hasCheckedAuth` í™•ì¸
2. ì¸ì¦ ì²´í¬ë¥¼ í•˜ì§€ ì•Šì•˜ë‹¤ë©´ `fetchMe()` ì‹¤í–‰
3. ì¸ì¦ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ë©”ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
4. ì¸ì¦ë˜ì—ˆìœ¼ë©´ ìì‹ ì»´í¬ë„ŒíŠ¸ ë Œë”ë§

---

### Router ì„¤ì •ì— ì ìš©

```jsx
{
  path: '/app',
  element: (
    <PrivateRoute>
      <AppLayout />
    </PrivateRoute>
  ),
  children: [
    { index: true, element: <Dashboard /> },
    { path: 'rooms', element: <StudyRoomList /> },
    { path: 'rooms/:id', element: <RoomDetail /> },
  ],
}
```

**êµ¬ì¡°**:
- `/app` ê²½ë¡œì™€ ê·¸ í•˜ìœ„ ê²½ë¡œëŠ” ëª¨ë‘ ì¸ì¦ í•„ìš”
- `PrivateRoute`ë¡œ ê°ì‹¸ì„œ ë³´í˜¸
- ì¸ì¦ë˜ì§€ ì•Šì€ ì ‘ê·¼ì€ ìë™ìœ¼ë¡œ ì°¨ë‹¨

**í™”ë©´ ì˜ˆì‹œ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”’ ì¸ì¦ì´ í•„ìš”í•œ í˜ì´ì§€ì…ë‹ˆë‹¤      â”‚
â”‚                                     â”‚
â”‚  ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™ ì¤‘...         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## JPA ì—”í‹°í‹° ì´ˆê¸°ê°’ ì„¤ì •

### @Builder.Default vs @PrePersist

ë‘ ë°©ì‹ ëª¨ë‘ í•„ë“œì˜ ê¸°ë³¸ê°’ì„ ì„¤ì •í•˜ì§€ë§Œ, ë™ì‘ ì‹œì ê³¼ ìš°ì„ ìˆœìœ„ê°€ ë‹¤ë¦…ë‹ˆë‹¤.

---

### 1. @Builder.Default (Lombok)

```java
@Builder.Default
@Column(name = "max_participants", nullable = false)
private Integer maxParticipants = 4;
```

**íŠ¹ì§•**:
- **Lombokì˜ ë¹Œë” íŒ¨í„´**ì—ì„œ ì‚¬ìš©
- **ê°ì²´ ìƒì„± ì‹œì **ì— ê¸°ë³¸ê°’ í• ë‹¹
- ë¹Œë”ë¡œ ê°ì²´ë¥¼ ìƒì„±í•  ë•Œ í•´ë‹¹ í•„ë“œë¥¼ ëª…ì‹œí•˜ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ê°’ ì‚¬ìš©

**ì˜ˆì‹œ**:
```java
// maxParticipantsë¥¼ ëª…ì‹œí•˜ì§€ ì•Šìœ¼ë©´ 4ê°€ ìë™ í• ë‹¹
StudyRoom room = StudyRoom.builder()
    .title("ìŠ¤í„°ë””ë£¸")
    .host(user)
    // maxParticipantsëŠ” 4ë¡œ ìë™ ì„¤ì •
    .build();
```

---

### 2. @PrePersist (JPA)

```java
@PrePersist
void onPrePersist() {
    // MVP ìš”êµ¬ì‚¬í•­: í•­ìƒ 4ëª…ìœ¼ë¡œ ê³ ì •
    this.maxParticipants = 4;
}
```

**íŠ¹ì§•**:
- **JPAì˜ ë¼ì´í”„ì‚¬ì´í´ ì½œë°±**
- ì—”í‹°í‹°ê°€ **ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ë˜ê¸° ì§ì „**(INSERT ì „)ì— ì‹¤í–‰
- `@Builder.Default`ë¡œ ì„¤ì •ëœ ê°’ë„ ë®ì–´ì“¸ ìˆ˜ ìˆìŒ

---

### ìš°ì„ ìˆœìœ„ ë¹„êµ

```java
@Entity
public class StudyRoom {
    @Builder.Default
    @Column(nullable = false)
    private Integer maxParticipants = 4;  // 1ìˆœìœ„: ë¹Œë” ê¸°ë³¸ê°’
    
    @PrePersist
    void onPrePersist() {
        this.maxParticipants = 4;  // 2ìˆœìœ„: DB ì €ì¥ ì§ì „ (ìµœì¢…ê°’)
    }
}
```

**ì‹¤í–‰ ìˆœì„œ**:
1. `@Builder.Default`: ê°ì²´ ìƒì„± ì‹œ â†’ `maxParticipants = 4`
2. ê°œë°œìê°€ ê°’ì„ ë³€ê²½ â†’ `room.setMaxParticipants(10)`
3. `@PrePersist`: DB ì €ì¥ ì§ì „ â†’ `maxParticipants = 4` (ë‹¤ì‹œ 4ë¡œ ë®ì–´ì”€)
4. ìµœì¢… DBì— ì €ì¥ë˜ëŠ” ê°’ â†’ **4**

**ê²°ë¡ **: `@PrePersist`ê°€ ìµœì¢… ìš°ì„ ê¶Œì„ ê°€ì§

---

## JPA ì—°ê´€ê´€ê³„ í•„ìˆ˜ ì„¤ì •

### optional=false vs nullable=false

```java
@ManyToOne(fetch = FetchType.LAZY, optional = false)
@JoinColumn(name = "host_id", nullable = false)
private User host;
```

ë‘˜ ë‹¤ `null`ì„ ë°©ì§€í•˜ì§€ë§Œ, **ê²€ì¦ ì‹œì ê³¼ ë ˆë²¨**ì´ ë‹¤ë¦…ë‹ˆë‹¤.

---

### 1. optional=false (JPA ë ˆë²¨)

```java
@ManyToOne(optional = false)
```

**íŠ¹ì§•**:
- **JPA ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨**ì—ì„œ ê²€ì¦
- ì—”í‹°í‹° ì €ì¥ ì‹œ `host`ê°€ `null`ì´ë©´ **JPAê°€ ì˜ˆì™¸ ë°œìƒ**
- ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ì „ì— ì°¨ë‹¨

**ì˜ˆì‹œ**:
```java
StudyRoom room = StudyRoom.builder()
    .title("ìŠ¤í„°ë””ë£¸")
    .host(null)  // âŒ optional=falseì´ë¯€ë¡œ ì˜ˆì™¸ ë°œìƒ
    .build();

roomRepository.save(room);  // ğŸ’¥ JPAê°€ DB ì¿¼ë¦¬ ì „ì— ì˜ˆì™¸ ë˜ì§
```

---

### 2. nullable=false (DB ë ˆë²¨)

```java
@JoinColumn(nullable = false)
```

**íŠ¹ì§•**:
- **ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ë ˆë²¨**ì—ì„œ `NOT NULL` ì œì•½ ì¡°ê±´ ìƒì„±
- JPAë¥¼ ê±°ì¹˜ì§€ ì•Šì€ ì§ì ‘ SQL ì ‘ê·¼ì—ë„ `null` ë°©ì§€
- DB í…Œì´ë¸” ìƒì„± ì‹œ `NOT NULL` ì œì•½ ì¡°ê±´ ì¶”ê°€

**ìƒì„±ë˜ëŠ” DDL**:
```sql
CREATE TABLE study_room (
    id BIGINT PRIMARY KEY,
    title VARCHAR(255),
    host_id BIGINT NOT NULL,  -- nullable=falseì— ì˜í•´ ìƒì„±
    FOREIGN KEY (host_id) REFERENCES users(id)
);
```

---

### ë¹„êµ ì •ë¦¬

| ì†ì„± | optional=false | nullable=false |
|------|----------------|----------------|
| ê²€ì¦ ë ˆë²¨ | **JPA (ì• í”Œë¦¬ì¼€ì´ì…˜)** | **ë°ì´í„°ë² ì´ìŠ¤** |
| ê²€ì¦ ì‹œì  | ì—”í‹°í‹° ì €ì¥ ì „ | SQL ì‹¤í–‰ ì‹œ |
| ì˜í–¥ ë²”ìœ„ | JPAë¥¼ í†µí•œ ì ‘ê·¼ë§Œ | ëª¨ë“  DB ì ‘ê·¼ |
| ì—ëŸ¬ ë°œìƒ ìœ„ì¹˜ | Java ì½”ë“œ ë ˆë²¨ | DB ë ˆë²¨ |

---

### ì™œ ë‘˜ ë‹¤ ì‚¬ìš©í•˜ëŠ”ê°€?

```java
@ManyToOne(fetch = FetchType.LAZY, optional = false)  // JPA ë ˆë²¨ ê²€ì¦
@JoinColumn(name = "host_id", nullable = false)       // DB ë ˆë²¨ ì œì•½
private User host;
```

**ì´ìœ **:
- `optional=false`: ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë¹ ë¥´ê²Œ ì—ëŸ¬ ê°ì§€
- `nullable=false`: ë°ì´í„°ë² ì´ìŠ¤ ë¬´ê²°ì„± ë³´ì¥
- **ì´ì¤‘ ì•ˆì „ì¥ì¹˜**ë¡œ ë”ìš± ê²¬ê³ í•œ ë°ì´í„° ê´€ë¦¬

**ì‹¤ë¬´ ê¶Œì¥**:
- í•„ìˆ˜ ì—°ê´€ê´€ê³„ëŠ” **ë‘˜ ë‹¤ ì‚¬ìš©**í•˜ëŠ” ê²ƒì´ ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤

---

## Spring Security - ì¸ì¦ ì •ë³´ ê°€ì ¸ì˜¤ê¸°

### @AuthenticationPrincipal

```java
@GetMapping("/profile")
public ResponseEntity<UserProfile> getProfile(
    @AuthenticationPrincipal UserDetails userDetails
) {
    // SecurityContextì— ì €ì¥ëœ ë¡œê·¸ì¸ ì •ë³´ë¥¼ ë°”ë¡œ ì‚¬ìš©
    String email = userDetails.getUsername();
    // ...
}
```

**ë™ì‘ íë¦„**:
```
1. Aê°€ ë¡œê·¸ì¸
    â†“
2. JWT í•„í„°ê°€ í† í° ê²€ì¦
    â†“
3. SecurityContextì— Aì˜ ì¸ì¦ ì •ë³´ ì €ì¥
    â†“
4. ìš”ì²­ ì‹œ @AuthenticationPrincipalë¡œ ì •ë³´ ì¶”ì¶œ
```

**ì¥ì **:
- SecurityContextì—ì„œ ìë™ìœ¼ë¡œ ì¸ì¦ ì •ë³´ë¥¼ êº¼ë‚´ì˜´
- ìˆ˜ë™ìœ¼ë¡œ í† í° íŒŒì‹±í•  í•„ìš” ì—†ìŒ
- ì½”ë“œê°€ ê°„ê²°í•´ì§

---

## Mock ë°ì´í„° (ê°€ì§œ ë°ì´í„°)

### Mock ë°ì´í„°ë€?

```javascript
// Mock ë°ì´í„° ì˜ˆì‹œ
const mockRooms = [
  {
    id: 1,
    title: "ì•Œê³ ë¦¬ì¦˜ ìŠ¤í„°ë””",
    host: "í™ê¸¸ë™",
    participants: 3,
    maxParticipants: 4
  },
  {
    id: 2,
    title: "ë¦¬ì•¡íŠ¸ ê³µë¶€ë°©",
    host: "ê¹€ì² ìˆ˜",
    participants: 2,
    maxParticipants: 4
  }
];
```

**ì‚¬ìš© ëª©ì **:
- ë°±ì—”ë“œ APIê°€ ì¤€ë¹„ë˜ê¸° ì „ì— í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ ì§„í–‰
- UI/UX ë Œë”ë§ í…ŒìŠ¤íŠ¸
- ë°ì´í„° êµ¬ì¡° ë¯¸ë¦¬ ì„¤ê³„

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤**:
1. ë°±ì—”ë“œ ê°œë°œ ì¤‘ â†’ í”„ë¡ íŠ¸ëŠ” Mock ë°ì´í„°ë¡œ ê°œë°œ
2. API ì™„ì„± â†’ Mock ë°ì´í„°ë¥¼ ì‹¤ì œ API í˜¸ì¶œë¡œ êµì²´
3. í…ŒìŠ¤íŠ¸ â†’ Mock ë°ì´í„°ë¡œ ë‹¤ì–‘í•œ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸

---

## React ì„±ëŠ¥ ìµœì í™”

### 1. ì¡°ê±´ë¶€ ë Œë”ë§ ìµœì í™”

**ë°”ë‹ë¼ JS ë°©ì‹ (ë¹„íš¨ìœ¨ì )**:
```javascript
// DOMì—ëŠ” ì¡´ì¬í•˜ì§€ë§Œ CSSë¡œ ìˆ¨ê¹€
modal.style.display = 'none';
```

**React ë°©ì‹ (íš¨ìœ¨ì )**:
```jsx
const Modal = ({ open, children }) => {
  // ëª¨ë‹¬ì´ ë‹«í˜€ìˆìœ¼ë©´ ì•„ì˜ˆ ë Œë”ë§í•˜ì§€ ì•ŠìŒ
  if (!open) return null;
  
  return createPortal(
    <div className="modal">{children}</div>,
    document.body
  );
};
```

**ì¥ì **:
- ì»´í¬ë„ŒíŠ¸ê°€ DOMì— ì¡´ì¬í•˜ì§€ ì•ŠìŒ (ë©”ëª¨ë¦¬ ì ˆì•½)
- ë¶ˆí•„ìš”í•œ ë Œë”ë§ ì—†ìŒ (ì„±ëŠ¥ í–¥ìƒ)
- Portal ì‚¬ìš© ì‹œ ë”ìš± íš¨ê³¼ì 

---

### 2. Zustand ì„ íƒì  êµ¬ë… ìµœì í™”

**ë¹„íš¨ìœ¨ì ì¸ ë°©ì‹ (ì „ì²´ êµ¬ë…)**:
```jsx
// âŒ Storeì˜ ëª¨ë“  ìƒíƒœë¥¼ êµ¬ë…
const { rooms, setRooms, addRoomToTop } = useRoomStore();
// roomsê°€ ë³€ê²½ë˜ì§€ ì•Šì•„ë„ setRooms, addRoomToTop ë³€ê²½ ì‹œ ë¦¬ë Œë”ë§
```

**íš¨ìœ¨ì ì¸ ë°©ì‹ (ì„ íƒì  êµ¬ë…)**:
```jsx
// âœ… í•„ìš”í•œ ê²ƒë§Œ ì„ íƒì ìœ¼ë¡œ êµ¬ë…
const rooms = useRoomStore((state) => state.rooms);
const setRooms = useRoomStore((state) => state.setRooms);
const addRoomToTop = useRoomStore((state) => state.addRoomToTop);
```

**ì„±ëŠ¥ ì°¨ì´**:
```
ì „ì²´ êµ¬ë…: ì•„ë¬´ ê°’ì´ë‚˜ ë³€ê²½ë˜ë©´ ë¦¬ë Œë”ë§
    â†“
ì„ íƒì  êµ¬ë…: êµ¬ë…í•œ ê°’ë§Œ ë³€ê²½ë˜ë©´ ë¦¬ë Œë”ë§
    â†“
ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ ê°ì†Œ â†’ ì„±ëŠ¥ í–¥ìƒ
```

**ì‹¤ë¬´ ê¶Œì¥**:
- í•­ìƒ ì„ íƒì  êµ¬ë… ì‚¬ìš©
- ì—¬ëŸ¬ ê°’ì´ í•„ìš”í•´ë„ ê°ê° ì„ íƒì ìœ¼ë¡œ êµ¬ë…

---

## Axios HTTP ë©”ì„œë“œ

### GET, POST, PUT, PATCH

```javascript
// ê¸°ë³¸ í˜•ì‹
axios.get('/api/rooms');
axios.post('/api/rooms', { title: "ìŠ¤í„°ë””ë£¸" });
axios.put('/api/rooms/1', { title: "ìˆ˜ì •ëœ ì œëª©" });
axios.patch('/api/rooms/1', { title: "ì¼ë¶€ ìˆ˜ì •" });
```

---

### DELETE (ì£¼ì˜!)

**ì¼ë°˜ ë©”ì„œë“œì™€ ë‹¤ë¥¸ í˜•ì‹**:
```javascript
// âŒ ì˜ëª»ëœ ë°©ì‹ (bodyê°€ ì „ë‹¬ë˜ì§€ ì•ŠìŒ)
axios.delete(`/rooms/${roomId}`, { roomId });

// âœ… ì˜¬ë°”ë¥¸ ë°©ì‹ (data ì†ì„± ì‚¬ìš©)
axios.delete(`/rooms/${roomId}/leave`, { 
  data: { roomId } 
});
```

**ì´ìœ **:
- GETê³¼ DELETEëŠ” HTTP ëª…ì„¸ìƒ bodyë¥¼ ê¶Œì¥í•˜ì§€ ì•ŠìŒ
- AxiosëŠ” DELETEì— bodyë¥¼ ë³´ë‚´ë ¤ë©´ `data` ì†ì„±ìœ¼ë¡œ ê°ì‹¸ì•¼ í•¨

**ë¹„êµ**:
```javascript
// POST/PUT/PATCH: ë‘ ë²ˆì§¸ ì¸ìê°€ ë°”ë¡œ body
axios.post(url, { key: value });

// DELETE: data ì†ì„±ìœ¼ë¡œ ê°ì‹¸ì•¼ í•¨
axios.delete(url, { data: { key: value } });
```

---

## ğŸ¯ ìµœì¢… ì •ë¦¬

- **Private Route**ëŠ” ì»´í¬ë„ŒíŠ¸ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í•˜ì—¬ ë¡œë”© UI ì œê³µ ë° ì‚¬ìš©ì ê²½í—˜ ê°œì„ 
- **@Builder.Default vs @PrePersist**: ë¹Œë”ëŠ” ê°ì²´ ìƒì„± ì‹œ, PrePersistëŠ” DB ì €ì¥ ì§ì „ ì‹¤í–‰ (PrePersistê°€ ìµœì¢… ìš°ì„ ê¶Œ)
- **optional=false (JPA) + nullable=false (DB)** ì¡°í•©ìœ¼ë¡œ ì´ì¤‘ ì•ˆì „ì¥ì¹˜ êµ¬ì¶•
- **@AuthenticationPrincipal**ë¡œ SecurityContextì˜ ì¸ì¦ ì •ë³´ë¥¼ ê°„í¸í•˜ê²Œ ì¶”ì¶œ
- **React ìµœì í™”**: ì¡°ê±´ë¶€ ë Œë”ë§ìœ¼ë¡œ ë¶ˆí•„ìš”í•œ DOM ì œê±°, Zustand ì„ íƒì  êµ¬ë…ìœ¼ë¡œ ë¦¬ë Œë”ë§ ìµœì†Œí™”
- **Axios DELETE**: ì¼ë°˜ ë©”ì„œë“œì™€ ë‹¬ë¦¬ `data` ì†ì„±ìœ¼ë¡œ body ì „ë‹¬ í•„ìš”
- í•µì‹¬ í¬ì¸íŠ¸: **ì„±ëŠ¥ ìµœì í™”, JPA ì—”í‹°í‹° ì„¤ê³„, ë³´ì•ˆ ì¸ì¦, API í˜¸ì¶œ íŒ¨í„´ ì´í•´**
