# ğŸ—“ï¸ 2025ë…„ 9ì›” 12ì¼ TIL




í”„ë¼ì´ë¹— ë¼ìš°íŠ¸ ì»´í¬ë„ŒíŠ¸ (ë¼ìš°íŠ¸ ê°€ë“œ)

ë¡œë”ë¥¼ ì‚¬ìš©í•´ì„œ ë¼ìš°íŠ¸ ê°€ë“œë¥¼ í•  ë•Œì—ëŠ” ë¡œë”©ì¤‘ì…ë‹ˆë‹¤. ë“±ì˜ uië¥¼ ë³´ì—¬ì¤„ ìˆ˜ ì—†ì—ˆìŒ
ì»´í¬ë„ŒíŠ¸ë¡œ ë¼ìš°íŠ¸ê°€ë“œë¥¼ í•˜ë©´ ê°€ëŠ¥


```jsx
const PrivateRoute = ({ children }) => {
  const { isAuthenticated, loading, hasCheckedAuth, fetchMe } = useAuthStore();

  // ìµœì´ˆ ì§„ì… ì‹œ ì¸ì¦ ì²´í¬ 1íšŒ
  useEffect(() => {
    if (!hasCheckedAuth) {
      fetchMe();
    }
  }, [hasCheckedAuth, fetchMe]);
  
  if (!isAuthenticated) {
    return (
      <Navigate
        to='/'
        replace
      />
    );
  }

  return children;
};
```

ì»´í¬ë„ŒíŠ¸ë¡œ ë¼ìš°íŠ¸ê°€ë“œ

```jsx
{
  path: '/app',
    element: (
    <PrivateRoute>
      <AppLayout />
    </PrivateRoute>
  ),
    children: [
    { index: true, element: <Dashboard /> },
    { path: 'rooms', element: <StudyRoomList /> },
    { path: 'rooms/:id', element: <RoomDetail /> },
  ],
},

```

![img.png](routeGuard.png)

---


### `@Builder.Default`ì™€ `@PrePersist`ì˜ ì°¨ì´

`@Builder.Default`ëŠ” **Lombokì˜ ë¹Œë” íŒ¨í„´**ì—ì„œ ì‚¬ìš©ë˜ë©°,
ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ì‹œì ì— í•„ë“œì— ê¸°ë³¸ê°’ì„ í• ë‹¹í•´ìš”.

`@PrePersist`ëŠ” **JPAì˜ ì½œë°± ê¸°ëŠ¥**ìœ¼ë¡œ, ì—”í‹°í‹°ê°€
ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ë˜ê¸° ì§ì „(INSERT ì¿¼ë¦¬ ì‹¤í–‰ ì „)ì—
íŠ¹ì • ë©”ì„œë“œë¥¼ ì‹¤í–‰ì‹œì¼œìš”.

ì´ ë‘˜ì„ í•¨ê»˜ ì‚¬ìš©í•˜ë©´, `@Builder.Default`ë¡œ ì„¤ì •ëœ ê°’ì€ 
`@PrePersist`ê°€ ì‹¤í–‰ë  ë•Œ ë®ì–´ì“°ì—¬ì§‘ë‹ˆë‹¤. 

ë”°ë¼ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ë˜ëŠ” ìµœì¢… ê°’ì€
`@PrePersist`ì— ì˜í•´ ê²°ì •ë¼ìš”.

---

### `optional=false`ì™€ `@ManyToOne`

`@ManyToOne`ì˜ `optional=false`ëŠ” **JPA ë ˆë²¨**ì—ì„œ
ì—°ê´€ê´€ê³„ì˜ í•„ìˆ˜ ì—¬ë¶€ë¥¼ ê²€ì¦í•©ë‹ˆë‹¤.
ë§Œì•½ `host` í•„ë“œê°€ `null`ì¸ ìƒíƒœë¡œ ì—”í‹°í‹°ë¥¼
ì €ì¥í•˜ë ¤ê³  í•˜ë©´, JPAëŠ” ë°ì´í„°ë² ì´ìŠ¤ë¡œ ì¿¼ë¦¬ë¥¼
ë³´ë‚´ê¸° ì „ì— ì˜ˆì™¸ë¥¼ ë°œìƒì‹œì¼œìš”.

ë°˜ë©´, `@JoinColumn(nullable=false)`ëŠ”
**ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ë ˆë²¨**ì—ì„œ `NOT NULL`
ì œì•½ì¡°ê±´ì„ ì„¤ì •í•˜ëŠ” ì—­í• ì„ í•´ìš”. ì´ëŠ” JPAë¥¼ ê±°ì¹˜ì§€ ì•Šì€ ë‹¤ë¥¸ ë°©ì‹ì˜ DB ì ‘ê·¼ì—ë„ `null` ê°’ì´ ë“¤ì–´ì˜¤ëŠ” ê²ƒì„ ë§‰ì•„ì¤˜ìš”.

ë‘ ì†ì„± ëª¨ë‘ `null` ê°’ì„ ë°©ì§€í•˜ì§€ë§Œ, `optional=false`ëŠ” **ì• í”Œë¦¬ì¼€ì´ì…˜(JPA)**ì—ì„œ, `nullable=false`ëŠ” **ë°ì´í„°ë² ì´ìŠ¤**ì—ì„œ ê°ê° ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ë‹´ë‹¹í•˜ëŠ” ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤.


```java
// StudyRoom.java
@Builder.Default
@Column(name = "max_participants", nullable = false)
private Integer maxParticipants = 4;

// optional=falseë¡œ ì„¤ì •í•œ ì´ìœ ëŠ” StudyRoomì˜ host(ë°©ì¥)ëŠ” ë°˜ë“œì‹œ ì¡´ì¬í•´ì•¼ í•˜ëŠ” í•„ìˆ˜ ì—°ê´€ê´€ê³„ì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
// ì¦‰, ìŠ¤í„°ë””ë£¸ ìƒì„± ì‹œ ë°˜ë“œì‹œ host(ìœ ì €)ê°€ ì§€ì •ë˜ì–´ì•¼ í•˜ë©°, nullì´ ë  ìˆ˜ ì—†ìŒì„ JPAì™€ DBì— ëª…í™•íˆ ì•Œë¦¬ê¸° ìœ„í•¨ì…ë‹ˆë‹¤.
@ManyToOne(fetch = FetchType.LAZY, optional = false)
@JoinColumn(name = "host_id", nullable = false)
private User host;


@PrePersist
void onPrePersist() {
    // MVP ìš”êµ¬ì‚¬í•­: í•­ìƒ 4ëª…ìœ¼ë¡œ ê³ ì •
    this.maxParticipants = 4;
}

```

---

Aê°€ ë¡œê·¸ì¸í•˜ë©´ í† í° í•„í„°ê°€ í† í°ì„ ê²€ì¦í•˜ê³ ,
ì‹œíë¦¬í‹° ì»¨í…ìŠ¤íŠ¸ì— Aê°€ ë¡œê·¸ì¸ í•œ ì •ë³´ë¥¼ ì €ì¥í•¨.

í—¤ë”ì— í† í°ê³¼ í•¨ê»˜ íŠ¹ì • ìš”ì²­ì„ ë³´ë‚´ë©´ `@AuthenticationPrincipal`ë¥¼ í†µí•´
ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥ëœ ë¡œê·¸ì¸ ì •ë³´ë¥¼ êº¼ë‚´ì„œ ì‚¬ìš© ê°€ëŠ¥

---

Mock (ê°€ì§œ, ì¸í˜•)
- í…ŒìŠ¤íŠ¸ìš© ë°ì´í„°
- ë°±ì—”ë“œì™€ ì—°ê²°ë˜ê¸° ì „ì— ë¯¸ë¦¬ í”„ë¡ íŠ¸ì—ì„œ ê°€ì§œ ë°ì´í„°ë¡œ ë Œë”ë§ í™•ì¸

---

ë°”ë‹ë¼ì—ì„œëŠ” `display: none`ìœ¼ë¡œ ëª¨ë‹¬ì´ ì•ˆë³´ì´ê²Œ í–ˆì§€ë§Œ,
ë¦¬ì•¡íŠ¸ì—ì„œëŠ” ëª¨ë‹¬ì´ ë‹«í˜€ìˆìœ¼ë©´ ì•„ì˜ˆ ì»´í¬ë„ŒíŠ¸ë¥¼
ë Œë”ë§í•˜ì§€ ì•ŠìŒ(í¬í„¸/ì„±ëŠ¥ ìµœì í™”) `if (!open) return null;`

---

ì„±ëŠ¥ìƒ ìœ„ìª½ ì½”ë“œê°€ ë” ì¢‹ìŒ ì•„ë˜ìª½ì€ ëª¨ë“ ê²ƒì„ ë‹¤ ë¶ˆëŸ¬ì˜´
```jsx
// ì „ì—­ Store: rooms ëª©ë¡ê³¼ ì„¸íŒ… ì•¡ì…˜ ì‚¬ìš©
const rooms = useRoomStore((s) => s.rooms);
const setRooms = useRoomStore((s) => s.setRooms);
const addRoomToTop = useRoomStore((s) => s.addRoomToTop);

const {rooms, setRooms, addRoomToTop} = useRoomStore
```

---

axios 

get, post, put ë“±
```js
.post(`/rooms/${roomId}/join`, { roomId })
```

delete
```js
.delete(`/rooms/${roomId}/leave`, { data: { roomId } })
```













