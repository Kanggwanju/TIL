# 🗓️ 2025년 7월 30일 TIL - SQL 정리


FROM절 서브쿼리: 인라인 뷰 (Inline View)
- 인라인 뷰(Inline View)는 FROM 절에 사용되는 서브쿼리를 말함
- 이 서브쿼리의 실행 결과는 쿼리가 실행되는 동안에만 존재하는 '임시 가상 테이블'처럼 취급

```sql
-- 인라인 뷰 서브쿼리 (FROM 절에 서브쿼리 사용)
-- 사용자별 피드 작성 개수
SELECT 
  U.USER_ID,
  U.USERNAME,
  PC.POST_COUNT
FROM (
  SELECT USER_ID, COUNT(*) AS POST_COUNT
  FROM POSTS
  GROUP BY USER_ID
) PC
JOIN USERS U
ON PC.USER_ID = U.USER_ID
;
```
- `JOIN`절 뒤의 테이블과 FROM 절의 테이블을 변경해도 상관없음 


---


`SELECT`절의 서브쿼리: 스칼라 서브쿼리 (Scalar Subquery)
- `SELECT`절에 사용되는 서브쿼리로, 반드시 하나의 값(단일 행, 단일 컬럼)만을 반환
- 메인 쿼리의 한 행이 처리될 때마다, 그 행과 관련된 값을 계산해서 
- 새로운 컬럼처럼 보여주는 역할

```sql
-- 유저정보를 조회(USERS) + 상세 bio(USER_PROFILES)도 같이 조회
SELECT
  U.USER_ID,
  U.USERNAME,
  UP.BIO
FROM USERS U
JOIN USER_PROFILES UP
ON U.USER_ID = UP.USER_ID
;
```
- `UP`에서 `BIO` 하나 꺼내려고 `JOIN`하는게 낭비

스칼라 서브쿼리 사용
```sql
SELECT
  U.USER_ID,
  U.USERNAME,
  (SELECT BIO FROM USER_PROFILES UP WHERE U.USER_ID = UP.USER_ID) AS BIO
FROM USERS U
;
```
- 바깥쪽 메인쿼리 한 행을 실행할때마다 연관 서브쿼리를 반복실행
- 스칼라 서브쿼리에선 USERS의 USER_ID에 맞는 행만 가져와야함


---


비연관 서브쿼리
- 혼자서도 실행 가능
- 바깥 쿼리와 아무런 관계없이, 독립적으로 딱 한 번만 실행

연관 서브쿼리
- 실행하는 데에 바깥이 필요함
- 바깥 쿼리의 한 행, 한 행이 처리될 때마다 
- 그 행의 값을 참조하여 다시 실행되는 서브쿼리
- 스칼라 서브쿼리가 대표적인 예시


---


존재 여부만 확인하기: `EXISTS`, `NOT EXISTS`

EXISTS 쿼리의 SELECT에 아무거나 와도 상관없는 이유
목적 자체가 뭔가를 조회해서 가져오려는게 아님.
WHERE를 써야하는데 구색을 맞춰주기 위해 SELECT를 쓴 것
`WHERE p.user_id = u.user_id`
p 테이블의 유저 아이디가 u 테이블의 유저 아이디에도 있으면
그대로 true로 판단하고, 바깥의 SELECT를 실행해도 되게 함.

NOT EXISTS는 조건에 부합하지 않는 행만 통과.


### 게시물을 한 번이라도 작성한 적이 있는 모든 사용자의 이름을 알려주세요.

JOIN 사용
```sql
SELECT DISTINCT P.USER_ID, U.USERNAME
FROM POSTS P
JOIN USERS U
ON P.USER_ID = U.USER_ID
ORDER BY P.USER_ID
;
```

EXISTS 사용
```sql
SELECT
    u.user_id, u.username
FROM
    USERS u
WHERE
    EXISTS (SELECT 1
            FROM POSTS p
            WHERE p.user_id = u.user_id)
;
```

