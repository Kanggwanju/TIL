# 🗓️ 2025년 8월 13일 TIL



여행 생성
- 여행을 생성하기 위해서는 유저여야 함. (로그인 된 유저만 가능)


유저 정보 조회, 엔티티를 가져옴
```java
// 토큰에서 파싱한 유저이름을 통해 유저정보를 조회
User foundUser = userRepository.findByUsername(username)
        .orElseThrow(
                () -> new BusinessException(ErrorCode.USER_NOT_FOUND)
        );
```

여행 엔티티 생성
- JPA는 FK를 넣을때 id만 넣는게 아니라 엔터티를 통째로넣어야함
```java
Trip savedTrip = Trip.builder()
        .title(request.getTitle())
        .budget(request.getBudget())
        .description(request.getDescription())
        .startDate(request.getStartDate())
        .endDate(request.getEndDate())
        .status(request.getStatus())
        .destination(request.getDestination())
        .user(foundUser) // 지금 로그인한 사람의 정보 (엔터티)
        .build();
```



토큰이 필요한 작업에선
토큰이 없으면 요청을 보낼 수 없게 해야 함.
-> 인가 설정

SecurityConfig.java에서 진행
```java
// 인가 설정
.authorizeHttpRequests(
        auth -> auth
                // 공개 접근 가능한 경로 (로그인 불필요)
                .requestMatchers(
                        "/"
                        , "/login"
                        , "/signup"
                ).permitAll()
                .requestMatchers("/css/**", "/js/**", "/images/**").permitAll()
                .requestMatchers("/api/auth/**").permitAll()

                // 인증 및 권한이 필요한 경로
                .requestMatchers("/api/**").authenticated()

                // 기타 경로
                // 모든 다른 요청은 인증이 필요하다
                .anyRequest().authenticated()
)

```

클라이언트는 로그인을 했을 때 서버에서 토큰을 받고

토큰이 필요한 작업에서 요청을 보낼 때 헤더에 토큰을 집어넣음

서버는 그 토큰을 파싱하여 제대로된 토큰인지 검사를 함.
그리고, 토큰에서 꺼낸 정보(사용자 이름)를 비즈니스 로직에 사용


`@AuthenticationPrincipal`
- 스프링 시큐리티 컨텍스트에서 인증된 사용자의 정보를 가져옴


