# ğŸ—“ï¸ 2025ë…„ 9ì›” 19ì¼ TIL

## ğŸ“Œ ì˜¤ëŠ˜ì˜ í‚¤ì›Œë“œ

`Spring AI`, `í† í° ì œí•œ`, `ë¬¸ë§¥ ìœ ì§€`, `Rate Limiting`, `AOP`, `Interceptor`, `Swagger`, `@Lob`, `OpenAPI`

---

## Spring AI ë¬¸ë§¥ ìœ ì§€ì™€ í† í° ê´€ë¦¬

### ê°œë… ì •ë¦¬

* LLM APIëŠ” ì…ë ¥/ì¶œë ¥ í† í° ëª¨ë‘ ê³¼ê¸ˆ ëŒ€ìƒì´ë¯€ë¡œ ë¬´í•œì • ë¬¸ë§¥ì„ ì „ë‹¬í•  ìˆ˜ ì—†ìŒ
* ë¬¸ë§¥ ìœ ì§€ë¥¼ ìœ„í•´ ì´ì „ ëŒ€í™”ë¥¼ ì…ë ¥ í† í°ì— í¬í•¨ì‹œí‚¤ì§€ë§Œ, ë¹„ìš© íš¨ìœ¨ì„ ê³ ë ¤í•´ì•¼ í•¨
* ìµœì†Œí•œì˜ ë¬¸ë§¥ ìœ ì§€ ì „ëµì´ í•„ìš”í•¨

### í† í° ì œí•œì˜ ì¢…ë¥˜

* **ì…ë ¥ í† í°**: ì‚¬ìš©ìì˜ ì§ˆë¬¸ + ì´ì „ ëŒ€í™” ë¬¸ë§¥
* **ì¶œë ¥ í† í°**: AIì˜ ì‘ë‹µ

### ë¬¸ë§¥ ìœ ì§€ ì „ëµ

**ë°©ë²• 1: ìµœê·¼ Nê°œì˜ ì§ˆë¬¸ë§Œ í¬í•¨**
```
ì˜ˆ) ìµœê·¼ 10ê°œì˜ ì§ˆë¬¸/ë‹µë³€ë§Œ ì „ë‹¬
```

**ë°©ë²• 2: ìš”ì•½ë³¸ í™œìš©**
```
ì˜ˆ) ìµœê·¼ 30ê°œ ì§ˆë¬¸ì„ ìš”ì•½í•˜ì—¬ ì „ë‹¬
- ì¥ì : ë” ë§ì€ ë¬¸ë§¥ ìœ ì§€ ê°€ëŠ¥
- ë‹¨ì : ìš”ì•½ ê³¼ì •ì—ì„œ ì •ë³´ ì†ì‹¤ ê°€ëŠ¥
```

### í¬ì¸íŠ¸

* í† í°ì€ ì…ë ¥/ì¶œë ¥ ëª¨ë‘ ê³¼ê¸ˆë˜ë¯€ë¡œ ë¹„ìš© ê´€ë¦¬ê°€ ì¤‘ìš”
* ëŒ€í™” ê¸¸ì´ê°€ ê¸¸ì–´ì§ˆìˆ˜ë¡ ì…ë ¥ í† í°ì´ ì¦ê°€í•˜ì—¬ ë¹„ìš© ìƒìŠ¹
* í”„ë¡œì íŠ¸ íŠ¹ì„±ì— ë§ëŠ” ì ì ˆí•œ ë¬¸ë§¥ ìœ ì§€ ì „ëµ ì„ íƒ í•„ìš”

---

## @Lob ì–´ë…¸í…Œì´ì…˜

### ê°œë… ì •ë¦¬

* Large Objectì˜ ì•½ìë¡œ, ëŒ€ìš©ëŸ‰ í…ìŠ¤íŠ¸ë‚˜ ë°”ì´ë„ˆë¦¬ ë°ì´í„°ë¥¼ DBì— ì €ì¥í•  ë•Œ ì‚¬ìš©
* `CLOB`(Character Large Object): ëŒ€ìš©ëŸ‰ í…ìŠ¤íŠ¸ ì €ì¥
* `BLOB`(Binary Large Object): ëŒ€ìš©ëŸ‰ ì´ë¯¸ì§€/íŒŒì¼ ì €ì¥

### ì˜ˆì‹œ ì½”ë“œ

```java
@Entity
public class AiConversation {
    
    // ë³´ë‚¸ í”„ë¡¬í”„íŠ¸(ì§ˆë¬¸/ìš”ì²­) - ëŒ€ìš©ëŸ‰ í…ìŠ¤íŠ¸ ì²˜ë¦¬
    @Lob
    @Column(name = "prompt", nullable = false)
    private String prompt;
    
    // AIì˜ ì‘ë‹µ - ëŒ€ìš©ëŸ‰ í…ìŠ¤íŠ¸ ì²˜ë¦¬
    @Lob
    @Column(name = "response", nullable = false)
    private String response;
}
```

### í¬ì¸íŠ¸

* **ì´ë¯¸ì§€ëŠ” DBì— ì§ì ‘ ì €ì¥í•˜ì§€ ë§ ê²ƒ**  
  â†’ ë³„ë„ íŒŒì¼ ì„œë²„(S3, CDN ë“±)ì— ì €ì¥í•˜ê³  URLë§Œ DBì— ì €ì¥í•˜ëŠ” ê²ƒì„ ê¶Œì¥
* `@Lob` ì—†ì´ ê¸´ í…ìŠ¤íŠ¸ë¥¼ ì €ì¥í•˜ë©´ DB ì»¬ëŸ¼ í¬ê¸° ì œí•œìœ¼ë¡œ ì—ëŸ¬ ë°œìƒ ê°€ëŠ¥
* í”„ë¡¬í”„íŠ¸ì™€ ì‘ë‹µì€ ê¸¸ì´ë¥¼ ì˜ˆì¸¡í•˜ê¸° ì–´ë ¤ìš°ë¯€ë¡œ `@Lob` ì‚¬ìš©ì´ ì ì ˆí•¨

---

## Spring ë²„ì „ê³¼ Spring AI

### ê°œë… ì •ë¦¬

* Spring AI ì •ì‹ ë²„ì „ì„ ì‚¬ìš©í•˜ë ¤ë©´ **Spring Boot 3.4 ì´ìƒ** í•„ìš”
* ai-study-mate í”„ë¡œì íŠ¸ì—ì„œëŠ” Spring ë²„ì „ì„ ë‚®ê²Œ ì„¤ì •í•˜ì—¬ ë§ˆì¼ìŠ¤í†¤ ë²„ì „ ì‚¬ìš©
* ë§ˆì¼ìŠ¤í†¤ ë²„ì „: ì •ì‹ ë¦´ë¦¬ìŠ¤ ì „ í…ŒìŠ¤íŠ¸ ë²„ì „

### Gradle ì„¤ì • ì˜ˆì‹œ

```groovy
ext {
    set('springAiVersion', '1.0.0-M5')  // M5 = Milestone 5
}

dependencies {
    implementation "org.springframework.ai:spring-ai-openai-spring-boot-starter:${springAiVersion}"
}
```

### í¬ì¸íŠ¸

* ì •ì‹ ë²„ì „ì€ ì•ˆì •ì„±ì´ ë†’ì§€ë§Œ ìµœì‹  ê¸°ëŠ¥ ì‚¬ìš© ì œí•œì 
* ë§ˆì¼ìŠ¤í†¤ ë²„ì „ì€ ìµœì‹  ê¸°ëŠ¥ ì‚¬ìš© ê°€ëŠ¥í•˜ì§€ë§Œ ë³€ê²½ ê°€ëŠ¥ì„± ìˆìŒ
* í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” ì •ì‹ ë²„ì „ ì‚¬ìš© ê¶Œì¥

---

## Rate Limiting (ìš”ì²­ ì œí•œ)

### ê°œë… ì •ë¦¬

* ì‚¬ìš©ìë³„ AI API í˜¸ì¶œ íšŸìˆ˜ì™€ í† í° ì‚¬ìš©ëŸ‰ì„ ì œí•œí•˜ì—¬ ë¹„ìš© ê´€ë¦¬ ë° ê³µì •ì„± í™•ë³´
* **ë¶„ë‹¹ ì œí•œ**: ì§§ì€ ì‹œê°„ ë‚´ ê³¼ë„í•œ ìš”ì²­ ë°©ì§€ (ìŠ¤íŒ¸/ë´‡ ì°¨ë‹¨)
* **ì¼ì¼ ì œí•œ**: í•˜ë£¨ ì´ ì‚¬ìš©ëŸ‰ ì œí•œ (ë¹„ìš© ê´€ë¦¬)

### ì œí•œ ì •ì±…

| ì œí•œ í•­ëª© | ê¸°ì¤€ | ëª©ì  |
|----------|------|------|
| ë¶„ë‹¹ ìš”ì²­ | 3íšŒ/ë¶„ | ìŠ¤íŒ¸ ë°©ì§€ |
| ì¼ì¼ ìš”ì²­ | 10íšŒ/ì¼ | ê³µì •ì„± í™•ë³´ |
| ì¼ì¼ í† í° | 100,000í† í°/ì¼ | ë¹„ìš© ë³´í˜¸ |

### Rate Limiter ì„œë¹„ìŠ¤ êµ¬í˜„

```java
@Service
public class RateLimiterService {

    private static final int REQUESTS_PER_MINUTE = 3;
    private static final int REQUESTS_PER_DAY = 10;
    private static final int TOKENS_PER_DAY = 100000;

    private final Map<String, MinuteWindow> minuteWindows = new ConcurrentHashMap<>();
    private final Map<String, DayCounter> dayCounters = new ConcurrentHashMap<>();

    /**
     * ì‚¬ìš©ìë³„ ìš”ì²­ í•œë„ë¥¼ ê²€ì‚¬í•˜ê³  ì‚¬ìš©ëŸ‰ì„ ê¸°ë¡í•©ë‹ˆë‹¤.
     *
     * @param providerId ì‚¬ìš©ì ì‹ë³„ì
     * @param estimatedTokens ì˜ˆìƒ í† í° ì‚¬ìš©ëŸ‰
     * @return í—ˆìš©ë˜ë©´ true, í•œë„ ì´ˆê³¼ ì‹œ false
     */
    public boolean tryConsume(String providerId, int estimatedTokens) {
        if (providerId == null || providerId.isBlank()) {
            return false;
        }
        // ë¶„ë‹¹ ì œí•œê³¼ ì¼ì¼ ì œí•œì„ ëª¨ë‘ í†µê³¼í•´ì•¼ í•¨
        boolean minuteOk = checkMinuteLimit(providerId);
        boolean dayOk = checkDayLimit(providerId, estimatedTokens);

        return minuteOk && dayOk;
    }

    /**
     * ë¶„ë‹¹ ìš”ì²­ í•œë„ë¥¼ ê²€ì‚¬í•˜ê³  ê°±ì‹ í•©ë‹ˆë‹¤.
     */
    private boolean checkMinuteLimit(String providerId) {
        long nowMillis = System.currentTimeMillis();
        
        // 1. ì‚¬ìš©ìì˜ ë¶„ë‹¹ ì¹´ìš´í„°ë¥¼ ê°€ì ¸ì˜¤ê±°ë‚˜ ìƒì„±
        MinuteWindow window = minuteWindows.computeIfAbsent(
            providerId, 
            k -> new MinuteWindow(nowMillis)
        );

        // 2. ë¶„ì´ ë°”ë€Œì—ˆëŠ”ì§€ í™•ì¸í•˜ê³ , ë°”ë€Œì—ˆë‹¤ë©´ ë¦¬ì…‹
        if (!window.isSameMinute(nowMillis)) {
            window.reset(nowMillis);
        }
        
        // 3. í•œë„ ì´ˆê³¼ ê²€ì‚¬
        if (window.count.get() >= REQUESTS_PER_MINUTE) {
            return false; // ë¶„ë‹¹ í•œë„ ì´ˆê³¼!
        }
        
        // 4. ì¹´ìš´í„° ì¦ê°€ í›„ í†µê³¼
        window.count.incrementAndGet();
        return true;
    }

    /**
     * ì¼ì¼ ìš”ì²­ ë° í† í° í•œë„ë¥¼ ê²€ì‚¬í•˜ê³  ê°±ì‹ í•©ë‹ˆë‹¤.
     */
    private boolean checkDayLimit(String providerId, int estimatedTokens) {
        long nowMillis = System.currentTimeMillis();
        DayCounter day = dayCounters.computeIfAbsent(
            providerId, 
            k -> new DayCounter(nowMillis)
        );

        // ë‚ ì§œê°€ ë°”ë€Œì—ˆëŠ”ì§€ í™•ì¸
        if (!day.isSameDay(nowMillis)) {
            day.reset(nowMillis);
        }
        
        // ì¼ì¼ ìš”ì²­ ìˆ˜ í•œë„ ê²€ì‚¬
        if (day.requests.get() >= REQUESTS_PER_DAY) {
            return false;
        }
        
        // ì¼ì¼ í† í° í•œë„ ê²€ì‚¬
        if (day.tokens.get() + estimatedTokens > TOKENS_PER_DAY) {
            return false;
        }
        
        // ì¹´ìš´í„° ì¦ê°€
        day.requests.incrementAndGet();
        day.tokens.addAndGet(estimatedTokens);
        return true;
    }

    // --- ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ ë©”ì„œë“œë“¤ ---

    public int getRemainingRequestsPerMinute(String providerId) {
        long now = System.currentTimeMillis();
        MinuteWindow w = minuteWindows.get(providerId);
        if (w == null || !w.isSameMinute(now)) return REQUESTS_PER_MINUTE;
        return Math.max(0, REQUESTS_PER_MINUTE - w.count.get());
    }

    public int getRemainingRequestsPerDay(String providerId) {
        long now = System.currentTimeMillis();
        DayCounter d = dayCounters.get(providerId);
        if (d == null || !d.isSameDay(now)) return REQUESTS_PER_DAY;
        return Math.max(0, REQUESTS_PER_DAY - d.requests.get());
    }

    public int getRemainingTokensPerDay(String providerId) {
        long now = System.currentTimeMillis();
        DayCounter d = dayCounters.get(providerId);
        if (d == null || !d.isSameDay(now)) return TOKENS_PER_DAY;
        return Math.max(0, TOKENS_PER_DAY - d.tokens.get());
    }

    // --- ë‚´ë¶€ ì¹´ìš´í„° í´ë˜ìŠ¤ë“¤ ---

    private static final class MinuteWindow {
        long windowStartMillis;
        AtomicInteger count = new AtomicInteger(0);

        MinuteWindow(long now) {
            this.windowStartMillis = now;
        }
        
        boolean isSameMinute(long now) {
            return (this.windowStartMillis / 60000) == (now / 60000);
        }

        void reset(long now) {
            this.windowStartMillis = now;
            this.count.set(0);
        }
    }

    private static final class DayCounter {
        long dayStartMillis;
        AtomicInteger requests = new AtomicInteger(0);
        AtomicInteger tokens = new AtomicInteger(0);

        DayCounter(long now) {
            this.dayStartMillis = now;
        }

        /**
         * íƒ€ì„ì¡´ì„ ê³ ë ¤í•œ ë‚ ì§œ ë¹„êµ
         * (ìƒˆë²½ 1ì‹œì— KSTì™€ UTCëŠ” ë‹¤ë¥¸ ë‚ ì¼ ìˆ˜ ìˆìŒ)
         */
        boolean isSameDay(long now) {
            ZoneId zone = ZoneId.systemDefault();
            ZonedDateTime a = Instant.ofEpochMilli(this.dayStartMillis).atZone(zone);
            ZonedDateTime b = Instant.ofEpochMilli(now).atZone(zone);
            return a.toLocalDate().isEqual(b.toLocalDate());
        }

        void reset(long now) {
            this.dayStartMillis = now;
            this.requests.set(0);
            this.tokens.set(0);
        }
    }
}
```

### í¬ì¸íŠ¸

* `ConcurrentHashMap` ì‚¬ìš©ìœ¼ë¡œ ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ì•ˆì „í•œ ë™ì‹œì„± ì œì–´
* `AtomicInteger`ë¡œ ì¹´ìš´í„° ì¦ê°€ ì‹œ race condition ë°©ì§€
* **ì£¼ì˜**: í˜„ì¬ êµ¬í˜„ì€ ì¸ë©”ëª¨ë¦¬ ë°©ì‹ìœ¼ë¡œ, ì„œë²„ê°€ ì—¬ëŸ¬ ëŒ€ë©´ ì„œë²„ ê°„ ê³µìœ  ë¶ˆê°€
* **ìš´ì˜ í™˜ê²½**: Redis ê°™ì€ ë¶„ì‚° ìºì‹œë¥¼ ì‚¬ìš©í•œ ë¶„ì‚° Rate Limiting í•„ìš”

---

## Filter vs Interceptor

### ê°œë… ì •ë¦¬

* Springì—ì„œ ìš”ì²­ì„ ìë™ìœ¼ë¡œ ê²€ì‚¬í•˜ëŠ” ë‘ ê°€ì§€ AOP ë°©ì‹
* ì‹¤í–‰ ìˆœì„œ: **Filter â†’ DispatcherServlet â†’ Interceptor â†’ Controller**

### ë¹„êµí‘œ

| í•­ëª© | Filter | Interceptor |
|------|--------|-------------|
| ì‹¤í–‰ ì‹œì  | DispatcherServlet ì´ì „ | DispatcherServlet ì´í›„ |
| Spring Context | ì ‘ê·¼ ë¶ˆê°€ | ì ‘ê·¼ ê°€ëŠ¥ |
| ì ìš© ë²”ìœ„ | ëª¨ë“  ìš”ì²­ (ì„œë¸”ë¦¿ ë ˆë²¨) | Spring MVC ìš”ì²­ë§Œ |
| ì£¼ìš” ìš©ë„ | ì¸ì½”ë”©, ë³´ì•ˆ, ë¡œê¹… | ì¸ì¦/ì¸ê°€, ë¡œê¹…, ì„¸ë¶€ ì œì–´ |

### Filter íŠ¹ì§•

* **ìœ„ì¹˜**: Springì˜ DispatcherServletì´ ìš”ì²­ì„ ë°›ê¸° ì „ì— ì‹¤í–‰
* **ìš©ë„**: Spring Security í•„í„°, í† í° ê²€ì‚¬ í•„í„°, ì¸ì½”ë”© í•„í„° ë“±
* **ë²”ìœ„**: ëª¨ë“  HTTP ìš”ì²­ì— ëŒ€í•´ ì‹¤í–‰ (ì •ì  ë¦¬ì†ŒìŠ¤ í¬í•¨)

### Interceptor íŠ¹ì§•

* **ìœ„ì¹˜**: DispatcherServletì´ Controllerë¡œ ìš”ì²­ì„ ì „ë‹¬í•˜ê¸° ì „/í›„ì— ì‹¤í–‰
* **ìš©ë„**: íŠ¹ì • ê²½ë¡œì— ëŒ€í•œ ì„¸ë°€í•œ ì œì–´ (Rate Limiting ë“±)
* **ë²”ìœ„**: Spring MVCê°€ ì²˜ë¦¬í•˜ëŠ” ìš”ì²­ë§Œ (ì •ì  ë¦¬ì†ŒìŠ¤ ì œì™¸ ê°€ëŠ¥)

---

## Rate Limit Interceptor êµ¬í˜„

### ê°œë… ì •ë¦¬

* AI API í˜¸ì¶œ ì „ì— ì‚¬ìš©ìì˜ ìš”ì²­ í•œë„ë¥¼ ìë™ìœ¼ë¡œ ê²€ì‚¬
* í•œë„ ì´ˆê³¼ ì‹œ ì¦‰ì‹œ ì°¨ë‹¨í•˜ì—¬ ë¹„ìš© ë³´í˜¸ ë° ì„œë²„ ì•ˆì •ì„± í™•ë³´
* `/api/ai/**` ê²½ë¡œì—ë§Œ ì„ íƒì ìœ¼ë¡œ ì ìš©

### Interceptor êµ¬í˜„

```java
/**
 * ë ˆì´íŠ¸ ë¦¬ë¯¸íŠ¸(Rate Limit)ë¥¼ ì ìš©í•˜ê¸° ìœ„í•œ ìŠ¤í”„ë§ MVC ì¸í„°ì…‰í„°
 *
 * ì™œ í•„ìš”í•œê°€?
 * 1) ë¹„ìš© ë³´í˜¸: LLM í˜¸ì¶œì€ í† í° ì‚¬ìš©ëŸ‰ì— ë”°ë¼ ë¹„ìš© ë°œìƒ
 * 2) ê³µì •ì„±: íŠ¹ì • ì‚¬ìš©ìì˜ ê³¼ë„í•œ í˜¸ì¶œ ë°©ì§€
 * 3) ì•ˆì •ì„±: íŠ¸ë˜í”½ ê¸‰ì¦(ìŠ¤íŒ¸/ë´‡)ìœ¼ë¡œë¶€í„° ì„œë²„ ë³´í˜¸
 *
 * ë™ì‘ ê³¼ì •
 * 1. SecurityContextì—ì„œ ì¸ì¦ëœ ì‚¬ìš©ì ì‹ë³„ì(providerId) ì¶”ì¶œ
 * 2. Content-Length í—¤ë”ë¡œ í† í° ì‚¬ìš©ëŸ‰ ì¶”ì •
 * 3. RateLimiterServiceë¡œ í•œë„ ê²€ì‚¬
 * 4. í•œë„ ì´ˆê³¼ ì‹œ BusinessException ë°œìƒ (429 Too Many Requests)
 */
@Component
@RequiredArgsConstructor
public class RateLimitInterceptor implements HandlerInterceptor {

    private final RateLimiterService rateLimiterService;

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) {
        // 1. ì¸ì¦ëœ ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ
        Authentication auth = SecurityContextHolder.getContext().getAuthentication();
        if (auth == null || auth.getPrincipal() == null) {
            throw new BusinessException(
                ErrorCode.UNAUTHORIZED, 
                ErrorCode.UNAUTHORIZED.getDefaultMessage()
            );
        }
        String providerId = String.valueOf(auth.getPrincipal());

        // 2. í† í° ì‚¬ìš©ëŸ‰ ì¶”ì • (Content-Length ê¸°ë°˜)
        int estimatedTokens = 0;
        if ("POST".equalsIgnoreCase(request.getMethod())) {
            int contentLength = request.getContentLength();
            if (contentLength < 0) {
                String cl = request.getHeader("Content-Length");
                if (cl != null) {
                    try { 
                        contentLength = Integer.parseInt(cl); 
                    } catch (NumberFormatException ignore) { 
                        contentLength = -1; 
                    }
                }
            }
            if (contentLength > 0) {
                // ë§¤ìš° ë‹¨ìˆœí•œ ê·¼ì‚¬ì¹˜: 4ë°”ì´íŠ¸ â‰ˆ 1í† í°
                estimatedTokens = Math.max(0, contentLength / 4);
            }
        }

        // 3. Rate Limit ê²€ì‚¬
        boolean allowed = rateLimiterService.tryConsume(providerId, estimatedTokens);
        if (!allowed) {
            throw new BusinessException(
                ErrorCode.RATE_LIMIT_EXCEEDED, 
                ErrorCode.RATE_LIMIT_EXCEEDED.getDefaultMessage()
            );
        }
        
        return true; // í†µê³¼: ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ì§„í–‰
    }
}
```

### Interceptor ë“±ë¡

```java
@Configuration
public class WebMvcConfig implements WebMvcConfigurer {

    private final RateLimitInterceptor rateLimitInterceptor;

    public WebMvcConfig(RateLimitInterceptor rateLimitInterceptor) {
        this.rateLimitInterceptor = rateLimitInterceptor;
    }

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        // /api/ai/** ê²½ë¡œì—ë§Œ Rate Limit ì ìš©
        registry.addInterceptor(rateLimitInterceptor)
                .addPathPatterns("/api/ai/**");
    }
}
```

### í¬ì¸íŠ¸

* **í† í° ì¶”ì •ì˜ í•œê³„**: `4ë°”ì´íŠ¸ â‰ˆ 1í† í°`ì€ ë§¤ìš° ë‹¨ìˆœí•œ ê·¼ì‚¬ì¹˜
  - ì‹¤ì œë¡œëŠ” ì–¸ì–´, ëª¨ë¸, í”„ë¡¬í”„íŠ¸ ë³µì¡ë„ì— ë”°ë¼ ë‹¬ë¼ì§
  - ì˜ì–´: 1ë‹¨ì–´ â‰ˆ 1í† í°, í•œêµ­ì–´: 1ìŒì ˆ â‰ˆ 1í† í° ì •ë„
* **ì£¼ì˜ì‚¬í•­**:
  - ë³¸ë¬¸ì„ ì§ì ‘ ì½ìœ¼ë©´ Streamì´ ì†Œëª¨ë˜ì–´ Controllerì—ì„œ ì¬ì‚¬ìš© ë¶ˆê°€
  - Content-Length í—¤ë” ê¸°ë°˜ ì¶”ì •ìœ¼ë¡œ ì´ ë¬¸ì œ íšŒí”¼
* **ë¶„ì‚° í™˜ê²½**: Redisë¥¼ ì‚¬ìš©í•œ ë¶„ì‚° Rate Limitingìœ¼ë¡œ í™•ì¥ ê°€ëŠ¥

---

## Swagger (OpenAPI) ì„¤ì •

### ê°œë… ì •ë¦¬

* RESTful APIë¥¼ ì„¤ê³„, ë¬¸ì„œí™”, í…ŒìŠ¤íŠ¸í•˜ëŠ” ì˜¤í”ˆì†ŒìŠ¤ í”„ë ˆì„ì›Œí¬
* ê°œë°œìê°€ API ëª…ì„¸ë¥¼ ì‰½ê²Œ í™•ì¸í•˜ê³  í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆëŠ” UI ì œê³µ
* OpenAPI 3.0 ìŠ¤í™ ê¸°ë°˜

### Gradle ì˜ì¡´ì„± ì„¤ì •

```groovy
dependencies {
    // Spring AI (Google AI via OpenAI compatible API)
    implementation("org.springframework.ai:spring-ai-openai-spring-boot-starter:${springAiVersion}") {
        // Swagger êµ¬ë²„ì „/ì¤‘ë³µ ì¶©ëŒ ë°©ì§€
        exclude group: 'io.swagger.core.v3', module: 'swagger-annotations'
        exclude group: 'io.swagger', module: 'swagger-annotations'
        exclude group: 'io.swagger', module: 'swagger-models'
        exclude group: 'com.github.victools', module: 'jsonschema-module-swagger-2'
    }

    // Spring Boot 3ìš© OpenAPI UI 
    implementation 'org.springdoc:springdoc-openapi-starter-webmvc-ui:2.3.0'
}
```

### Swagger ê²½ë¡œ ë³€ê²½

```java
@Configuration
public class WebMvcConfig implements WebMvcConfigurer {
    
    @Override
    public void addViewControllers(@NonNull ViewControllerRegistry registry) {
        // ë£¨íŠ¸ ê²½ë¡œ(/) ì ‘ê·¼ ì‹œ Swagger UIë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
        registry.addRedirectViewController("/", "/swagger-ui/index.html");
    }
}
```

### OpenAPI ì„¤ì • ì˜ˆì‹œ

```java
@Configuration
public class OpenApiConfig {
    
    @Bean
    public OpenAPI customOpenAPI() {
        return new OpenAPI()
            .info(new Info()
                .title("AI Study Mate API")
                .version("1.0.0")
                .description("ì‹¤ì‹œê°„ AI í•™ìŠµ ë„ìš°ë¯¸ ì„œë¹„ìŠ¤ API ë¬¸ì„œ")
                .contact(new Contact()
                    .name("ê°œë°œíŒ€")
                    .email("support@aistudymate.com")
                )
            )
            .addSecurityItem(new SecurityRequirement().addList("bearer-jwt"))
            .components(new Components()
                .addSecuritySchemes("bearer-jwt", 
                    new SecurityScheme()
                        .type(SecurityScheme.Type.HTTP)
                        .scheme("bearer")
                        .bearerFormat("JWT")
                        .description("JWT í† í°ì„ ì…ë ¥í•˜ì„¸ìš” (Bearer ì œì™¸)")
                )
            );
    }
}
```

### API ë¬¸ì„œí™” ì–´ë…¸í…Œì´ì…˜

```java
@RestController
@RequestMapping("/api/ai")
@Tag(name = "AI API", description = "AI ëŒ€í™” ê´€ë ¨ API")
public class AiController {
    
    @PostMapping("/chat")
    @Operation(
        summary = "AIì™€ ëŒ€í™”í•˜ê¸°", 
        description = "ì‚¬ìš©ìì˜ ì§ˆë¬¸ì— ëŒ€í•´ AIê°€ ì‘ë‹µí•©ë‹ˆë‹¤."
    )
    @ApiResponses({
        @ApiResponse(
            responseCode = "200", 
            description = "ì„±ê³µ",
            content = @Content(schema = @Schema(implementation = AiResponse.class))
        ),
        @ApiResponse(responseCode = "429", description = "ìš”ì²­ í•œë„ ì´ˆê³¼"),
        @ApiResponse(responseCode = "401", description = "ì¸ì¦ ì‹¤íŒ¨")
    })
    public ResponseEntity<AiResponse> chat(
        @Parameter(description = "ì‚¬ìš©ì ì§ˆë¬¸", required = true)
        @RequestBody ChatRequest request
    ) {
        // ...
    }
}
```

### í¬ì¸íŠ¸

* Swagger UIëŠ” ê°œë°œ ë‹¨ê³„ì—ì„œ ë§¤ìš° ìœ ìš©í•œ API í…ŒìŠ¤íŠ¸ ë„êµ¬
* `@Tag`, `@Operation`, `@ApiResponse` ë“±ìœ¼ë¡œ ìƒì„¸í•œ ë¬¸ì„œ ì‘ì„± ê°€ëŠ¥
* Bearer í† í° ì¸ì¦ ì„¤ì •ìœ¼ë¡œ Swagger UIì—ì„œ ì§ì ‘ ì¸ì¦ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
* **ì£¼ì˜**: í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” Swagger UI ì ‘ê·¼ ì œí•œ ê³ ë ¤ í•„ìš”

---

## ğŸ¯ ìµœì¢… ì •ë¦¬

* **Spring AI ë¬¸ë§¥ ìœ ì§€**: í† í° ë¹„ìš©ì„ ê³ ë ¤í•˜ì—¬ ìµœê·¼ Nê°œ ëŒ€í™” ë˜ëŠ” ìš”ì•½ë³¸ í™œìš©
* **@Lob ì–´ë…¸í…Œì´ì…˜**: ëŒ€ìš©ëŸ‰ í…ìŠ¤íŠ¸(í”„ë¡¬í”„íŠ¸/ì‘ë‹µ) ì €ì¥ ì‹œ í•„ìˆ˜, ì´ë¯¸ì§€ëŠ” íŒŒì¼ ì„œë²„ ì‚¬ìš©
* **Rate Limiting**: ë¶„ë‹¹/ì¼ì¼ ìš”ì²­ ì œí•œìœ¼ë¡œ ë¹„ìš© ë³´í˜¸, ê³µì •ì„± í™•ë³´, ì„œë²„ ì•ˆì •ì„± ìœ ì§€
* **Filter vs Interceptor**: FilterëŠ” ëª¨ë“  ìš”ì²­, InterceptorëŠ” íŠ¹ì • ê²½ë¡œì— ì„ íƒì  ì ìš©
* **Rate Limit Interceptor**: AI API ê²½ë¡œì—ë§Œ ì ìš©ë˜ì–´ ìë™ìœ¼ë¡œ í•œë„ ê²€ì‚¬
* **Swagger/OpenAPI**: API ë¬¸ì„œí™” ë° í…ŒìŠ¤íŠ¸ ë„êµ¬, ê°œë°œ ìƒì‚°ì„± í–¥ìƒ
* **ë¶„ì‚° í™˜ê²½ ê³ ë ¤**: ì¸ë©”ëª¨ë¦¬ ë°©ì‹ì€ ë‹¨ì¼ ì„œë²„ìš©, ìš´ì˜ í™˜ê²½ì—ì„œëŠ” Redis ê¸°ë°˜ ë¶„ì‚° ì²˜ë¦¬ í•„ìš”
