# 🗓️ 2025년 7월 30일 TIL










N+1 문제 및 Fetch Join


게시물과 게시물에 달린 댓글을 보고싶을때
`SQL`에서는 `LEFT OUTER JOIN`을 사용해서 데이터를 가져옴
게시물에 댓글이 3개 달려있으면 게시물도 3번 봐야하는 문제가 있음.
```sql
SELECT
  P.POST_ID,
  P.CONTENT,
  C.COMMENT_ID,
  C.COMMENT_TEXT
FROM POSTS P
LEFT JOIN COMMENTS C
ON P.POST_ID = C.POST_ID
ORDER BY P.POST_ID
;
```
이는 자바 입장에서 보자면 댓글 3개는 `List`로 처리하면 됨.


자바에선 게시물 목록부터 1번 조회
```sql
SELECT
  P.POST_ID,
  P.CONTENT
FROM POSTS P
ORDER BY P.POST_ID
;
```

게시물 개수가 100개라면
각각의 게시물의 댓글을 조회하기 위해 100번의 조회가 실행되어야 함.
```sql
-- 1번 피드에 달린 댓글 조회
SELECT
  C.COMMENT_ID,
  C.COMMENT_TEXT
FROM COMMENTS C
WHERE C.POST_ID = 1
;
--- 다음은 2번, 3번, ...
```

결국 100 + 1, N + 1의 문제가 발생 (너무 많은 쿼리를 실행)

이를 해결하기 위해서 자바에서는 임의로 Fetch Join을 만들었음
Fetch Join은 JPQL로만 작성 가능







다대다 관계

    상품 N    :        M  회원

              1  주문 1

    - 다대다 관계는 이 관계를 1대 다와 다대 1로 풀어줄 
      중간테이블이 필요함

    1개의 상품(청소기)  여러명의 회원이 주문할 수 있음
    한명의 회원은  여러 상품을 주문할 수 있음

    [ 상품 ]
    상품번호    상품명        
       1            에어컨                
       2            청소기            
    [ 주문 ]
     상품번호    회원번호
        1                1
        1                2
        2                1

    [ 회원 ]
    회원번호    회원명    
       1            김철수         
       2            박영희         







