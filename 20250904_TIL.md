# ğŸ—“ï¸ 2025ë…„ 9ì›” 4ì¼ TIL


## íšŒì›ê°€ì… ê³¼ì •
1. ì‚¬ìš©ìê°€ ì´ë©”ì¼ ì…ë ¥
2. ì…ë ¥ëœ ì´ë©”ì¼ì— ì¸ì¦ì½”ë“œ ë°œì†¡
3. ì˜³ì€ ì¸ì¦ì½”ë“œ ì…ë ¥ ì‹œ ë¹„ë°€ë²ˆí˜¸ ì„¤ì •

- ì´ì „ì— 1, 2ë²ˆ ê³¼ì • ì‘ì„±, 3ë²ˆì¸ ë¹„ë°€ë²ˆí˜¸ ì„¤ì • ì°¨ë¡€.


## [FE] ë¹„ë°€ë²ˆí˜¸ ì„¤ì •
- ì´ì „ ê³¼ì •ì„ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰í–ˆì„ ë•Œ ì§„í–‰ ê°€ëŠ¥

1. `input` íƒœê·¸ì— `onChange` ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¥¼ ì—°ê²°
- ë°•ìŠ¤ì— ê¸€ìë¥¼ í•œ ê¸€ìë¼ë„ ì…ë ¥í•˜ê±°ë‚˜ ì§€ìš°ëŠ” ë“± ì–´ë–¤ ë³€í™”ë¥¼ ì¤„ ë•Œë§ˆë‹¤
- `changeHandler` í•¨ìˆ˜ê°€ ìë™ìœ¼ë¡œ í˜¸ì¶œ
```jsx
// PasswordInput.jsx
return (
  <>
    <p>Step 3: ì•ˆì „í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.</p>
    <input
      ref={passwordRef}
      type='password'
      value={password}
      onChange={changeHandler}
      className={errorMessage ? styles.invalidInput : ''}
      placeholder='Enter your password'
    />
    {errorMessage && <p className={styles.errorMessage}>{errorMessage}</p>}
  </>
);
```

2. `changeHandler` í•¨ìˆ˜
- ì…ë ¥ëœ ë¹„ë°€ë²ˆí˜¸ë¥¼ `e.target.value`ë¥¼ í†µí•´ ë°›ì•„ì˜´
- `setPassword`ë¥¼ í†µí•´ ìƒíƒœ ë³€ìˆ˜ ë³€ê²½
- `validatePassword` í•¨ìˆ˜ë¥¼ í†µí•´ íŒ¨ìŠ¤ì›Œë“œ íŒ¨í„´ê²€ì¦
- íŒ¨í„´ ê²€ì¦ì„ í†µê³¼ ë° ì‹¤íŒ¨í•˜ë©´ ì—ëŸ¬ë©”ì‹œì§€ ë¯¸ì„¤ì •, ë¶€ëª¨ê°€ ë‚´ë ¤ì¤€ onSuccess í•¨ìˆ˜ í˜¸ì¶œ

```jsx
const [password, setPassword] = useState('');
const [errorMessage, setErrorMessage] = useState('');

const changeHandler = (e) => {
  const newPassword = e.target.value;
  setPassword(newPassword);

  if (validatePassword(newPassword)) {
    setErrorMessage('');
    onSuccess(true, newPassword);
  } else {
    setErrorMessage(
      'ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ë©°, ìˆ«ì, ë¬¸ì, íŠ¹ìˆ˜ë¬¸ìë¥¼ ëª¨ë‘ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.'
    );
    onSuccess(false, newPassword);
  }
};
```

---

## [FE] íšŒì›ê°€ì… ì™„ë£Œ

1. í•¨ìˆ˜ ë‚´ë ¤ì£¼ê¸°
- `signUpForm` ì»´í¬ë„ŒíŠ¸ì—ì„œ `passwordSuccessHandler`ë¥¼ `onSuccess`ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ë‚´ë ¤ì¤Œ
- `PasswordInput`ì—ì„œ `onSuccess` í•¨ìˆ˜ ì‹¤í–‰ ì‹œ, `passwordSuccessHandler`ê°€ ì‹¤í–‰ë¨
```jsx
// signUpForm.jsx
return (
  // ...
  {step === 3 && <PasswordInput onSuccess={passwordSuccessHandler} />}
  // ...
);
```

2. íšŒì›ê°€ì… ì™„ë£Œ ë²„íŠ¼ ê°€ì‹œí™”
- `PasswordInput`ì—ì„œ ì…ë ¥ì´ íŒ¨í„´ê²€ì¦ì„ í†µê³¼í•  ê²½ìš° `onSuccess(true, newPassword);` ì‹¤í–‰
- íŒ¨í„´ê²€ì¦ì— ì‹¤íŒ¨í•  ê²½ìš° `onSuccess(false, newPassword);` ì‹¤í–‰
- ë”°ë¼ì„œ íšŒì›ê°€ì… ì™„ë£Œ ë²„íŠ¼ì€ íŒ¨í„´ê²€ì¦ í†µê³¼ ì—¬ë¶€ì— ë”°ë¼ ë™ì ìœ¼ë¡œ ê°€ì‹œí™” ë¨
```jsx
// íŒ¨ìŠ¤ì›Œë“œ ì…ë ¥ì´ ëë‚  ë•Œ í˜¸ì¶œë  í•¨ìˆ˜
const passwordSuccessHandler = (isValid, password) => {
  setEnteredPassword(password);
  // íšŒì›ê°€ì…ë²„íŠ¼ì„ ì—´ì–´ì¤„ì§€ ì—¬ë¶€
  setIsActiveButton(isValid);
};

return (
  // ...
  {
    isActiveButton &&
    <div>
      <button onClick={handleSubmit}>íšŒì›ê°€ì… ì™„ë£Œ</button>
    </div>
  }
  // ...
);
```

3. `handleSubmit`: ì™„ë£Œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ í•¨ìˆ˜
- `navigate` íšŒì›ê°€ì… ì™„ë£Œ í›„, ì‚¬ìš©ìë¥¼ ë©”ì¸ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜

```jsx
// íšŒì›ê°€ì… ì™„ë£Œ ì´ë²¤íŠ¸
const handleSubmit = e => {
  e.preventDefault();

  (async () => {
    const response = await fetch(`${AUTH_API_URL}/join`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        email: enteredEmail,
        password: enteredPassword
      })
    });

    if (!response.ok) throw new Error('íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');

    const data = await response.json();
    alert(data.message);
    navigate('/');

  })();
};
```

---

## [BE] íšŒì›ê°€ì… ë§ˆë¬´ë¦¬ ì²˜ë¦¬
- íšŒì›ê°€ì… ì™„ë£Œ ë²„íŠ¼ì„ ëˆ„ë¥¸ ì‚¬ìš©ìëŠ” ì´ë¯¸ ì„ì‹œë¡œ íšŒì›ê°€ì… ë˜ì–´ìˆìŒ
- ë°±ì—”ë“œì—ì„œëŠ” ì´ë©”ì¼ê³¼ íŒ¨ìŠ¤ì›Œë“œë¥¼ ë°›ê³ 
- ì„ì‹œ íšŒì›ê°€ì…ëœ íšŒì›ì˜ íŒ¨ìŠ¤ì›Œë“œì™€ ìƒì„±ì‹œê°„ì„ ì±„ì›Œë„£ìœ¼ë©´ ë
- `EventUser` ì—”í‹°í‹°ì—ëŠ” `confirm` í¸ì˜ ë©”ì„œë“œ(ë¹„ë°€ë²ˆí˜¸, ìƒì„±ì‹œê°„ ì±„ì›Œë„£ê¸°) ìƒì„±
```java
// EventUserService.java
public void confirmSignup(SignupRequest dto) {

    // ì„ì‹œ íšŒì›ê°€ì…ëœ íšŒì›ì •ë³´ë¥¼ ì¡°íšŒ
    EventUser foundUser = eventUserRepository.findByEmail(dto.email()).orElseThrow(
            () -> new RuntimeException("ì„ì‹œ íšŒì›ê°€ì…ëœ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.")
    );

    // ì´ë©”ì¼ ì¸ì¦ì„ ë°›ì•˜ëŠ”ì§€ í™•ì¸
    if (!foundUser.isEmailVerified()) {
        throw new RuntimeException("ì´ë©”ì¼ ì¸ì¦ì´ ì™„ë£Œë˜ì§€ ì•Šì€ íšŒì›ì…ë‹ˆë‹¤.");
    }
    
    // ë°ì´í„°ë² ì´ìŠ¤ì— ì„ì‹œ íšŒì›ê°€ì…ëœ íšŒì›ì •ë³´ì˜ íŒ¨ìŠ¤ì›Œë“œì™€ ìƒì„±ì‹œê°„ì„ ì±„ì›Œë„£ê¸°
    foundUser.confirm(dto.password());
    eventUserRepository.save(foundUser);
}

// EventUser.java
public class EventUser {
    // ...
    public void confirm(String password) {
        this.password = password;
        this.createdAt = LocalDateTime.now();
    }
}
```

---

## [BE] íŒ¨ìŠ¤ì›Œë“œ ì•”í˜¸í™” ì²˜ë¦¬
- í˜„ì¬ DBì— íŒ¨ìŠ¤ì›Œë“œê°€ ê·¸ëŒ€ë¡œ ë“¤ì–´ê°€ê³  ìˆìŒ
- ë³´ì•ˆì— ì‹¬ê°í•œ ë¬¸ì œì´ë¯€ë¡œ í•´ì‹œ ì•”í˜¸í™” í•„ìš”

1. ë¹„ë°€ë²ˆí˜¸ í•´ì‹œ ì•”í˜¸í™”ë¥¼ ìœ„í•´ ì˜ì¡´ì„± ì¶”ê°€
```groovy
// ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ëª¨ë“ˆ
implementation 'org.springframework.boot:spring-boot-starter-security'
```

2. Spring Security ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” ì„¤ì • íŒŒì¼ ìƒì„±(`PasswordEncoderConfig`)
- ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•”í˜¸í™”í•˜ëŠ” í•µì‹¬ì ì¸ êµ¬ì„± ìš”ì†Œë¥¼ ì„¤ì •
- `BCryptPasswordEncoder`ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡
- ì´ ì½”ë“œê°€ ì—†ìœ¼ë©´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì§ì ‘ ì•”í˜¸í™”í•˜ëŠ” ì½”ë“œë¥¼ ë§¤ë²ˆ ì‘ì„±

```java
@Configuration
public class PasswordEncoderConfig {
    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}
```

3. ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”í•˜ì—¬ DBì— ì €ì¥
- `passwordEncoder`ë¥¼ í†µí•´ ë¹„ë°€ë²ˆí˜¸ ë¬¸ìì—´ì„ í•´ì‹œ ì•”í˜¸í™”
```java
// EventUserService.java
private final PasswordEncoder passwordEncoder;

public void confirmSignup(SignupRequest dto) {

    // ...
    // ë°ì´í„°ë² ì´ìŠ¤ì— ì„ì‹œ íšŒì›ê°€ì…ëœ íšŒì›ì •ë³´ì˜ íŒ¨ìŠ¤ì›Œë“œì™€ ìƒì„±ì‹œê°„ì„ ì±„ì›Œë„£ê¸°
    foundUser.confirm(passwordEncoder.encode(dto.password()));
    eventUserRepository.save(foundUser);
}
```

---



ì•¡ì…˜ í•¨ìˆ˜ëŠ” ì—¬ëŸ¬ê°œ ëª» ê±¸ìŒ
-> ë¡œê·¸ì•„ì›ƒì„ í•˜ëŠ” ë¼ìš°íŠ¸ë¥¼ ìƒˆë¡œ ë§Œë“¤ìŒ


// í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì—ëŠ” ë°”ë¡œ ì „ë‹¬ ê°€ëŠ¥
loader: userDataLoader,
// loaderì˜ ë¦¬í„´ë°ì´í„°ëŠ” children(Outlet)ë“¤ì—ê²ŒëŠ” ì „ë‹¬ë˜ì§€ ì•ŠëŠ”ê²Œ ê¸°ë³¸
// ê·¸ëŸ°ë° idë¥¼ ì£¼ë©´ Childrenë“¤ì´ idë¡œ ê°€ì ¸ê°ˆ ìˆ˜ ìˆìŒ
id: 'user-token-data'

// ìƒìœ„ ë ˆì´ì•„ì›ƒì´ ê°€ì§€ê³  ìˆëŠ” ë¡œë”ì˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ë•ŒëŠ” idë¥¼ ì‚¬ìš©
const userData = useLoaderData('user-token-data');
