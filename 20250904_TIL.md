# ğŸ—“ï¸ 2025ë…„ 9ì›” 4ì¼ TIL


## íšŒì›ê°€ì… ê³¼ì •
1. ì‚¬ìš©ìê°€ ì´ë©”ì¼ ì…ë ¥
2. ì…ë ¥ëœ ì´ë©”ì¼ì— ì¸ì¦ì½”ë“œ ë°œì†¡
3. ì˜³ì€ ì¸ì¦ì½”ë“œ ì…ë ¥ ì‹œ ë¹„ë°€ë²ˆí˜¸ ì„¤ì •

- ì´ì „ì— 1, 2ë²ˆ ê³¼ì • ì‘ì„±, 3ë²ˆì¸ ë¹„ë°€ë²ˆí˜¸ ì„¤ì • ì°¨ë¡€.


## [FE] ë¹„ë°€ë²ˆí˜¸ ì„¤ì •
- ì´ì „ ê³¼ì •ì„ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰í–ˆì„ ë•Œ ì§„í–‰ ê°€ëŠ¥

1. `input` íƒœê·¸ì— `onChange` ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¥¼ ì—°ê²°
- ë°•ìŠ¤ì— ê¸€ìë¥¼ í•œ ê¸€ìë¼ë„ ì…ë ¥í•˜ê±°ë‚˜ ì§€ìš°ëŠ” ë“± ì–´ë–¤ ë³€í™”ë¥¼ ì¤„ ë•Œë§ˆë‹¤
- `changeHandler` í•¨ìˆ˜ê°€ ìë™ìœ¼ë¡œ í˜¸ì¶œ
```jsx
// PasswordInput.jsx
return (
  <>
    <p>Step 3: ì•ˆì „í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.</p>
    <input
      ref={passwordRef}
      type='password'
      value={password}
      onChange={changeHandler}
      className={errorMessage ? styles.invalidInput : ''}
      placeholder='Enter your password'
    />
    {errorMessage && <p className={styles.errorMessage}>{errorMessage}</p>}
  </>
);
```

2. `changeHandler` í•¨ìˆ˜
- ì…ë ¥ëœ ë¹„ë°€ë²ˆí˜¸ë¥¼ `e.target.value`ë¥¼ í†µí•´ ë°›ì•„ì˜´
- `setPassword`ë¥¼ í†µí•´ ìƒíƒœ ë³€ìˆ˜ ë³€ê²½
- `validatePassword` í•¨ìˆ˜ë¥¼ í†µí•´ íŒ¨ìŠ¤ì›Œë“œ íŒ¨í„´ê²€ì¦
- íŒ¨í„´ ê²€ì¦ì„ í†µê³¼ ë° ì‹¤íŒ¨í•˜ë©´ ì—ëŸ¬ë©”ì‹œì§€ ë¯¸ì„¤ì •, ë¶€ëª¨ê°€ ë‚´ë ¤ì¤€ onSuccess í•¨ìˆ˜ í˜¸ì¶œ

```jsx
const [password, setPassword] = useState('');
const [errorMessage, setErrorMessage] = useState('');

const changeHandler = (e) => {
  const newPassword = e.target.value;
  setPassword(newPassword);

  if (validatePassword(newPassword)) {
    setErrorMessage('');
    onSuccess(true, newPassword);
  } else {
    setErrorMessage(
      'ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ë©°, ìˆ«ì, ë¬¸ì, íŠ¹ìˆ˜ë¬¸ìë¥¼ ëª¨ë‘ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.'
    );
    onSuccess(false, newPassword);
  }
};
```

---

## [FE] íšŒì›ê°€ì… ì™„ë£Œ

1. í•¨ìˆ˜ ë‚´ë ¤ì£¼ê¸°
- `signUpForm` ì»´í¬ë„ŒíŠ¸ì—ì„œ `passwordSuccessHandler`ë¥¼ `onSuccess`ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ë‚´ë ¤ì¤Œ
- `PasswordInput`ì—ì„œ `onSuccess` í•¨ìˆ˜ ì‹¤í–‰ ì‹œ, `passwordSuccessHandler`ê°€ ì‹¤í–‰ë¨
```jsx
// signUpForm.jsx
return (
  // ...
  {step === 3 && <PasswordInput onSuccess={passwordSuccessHandler} />}
  // ...
);
```

2. íšŒì›ê°€ì… ì™„ë£Œ ë²„íŠ¼ ê°€ì‹œí™”
- `PasswordInput`ì—ì„œ ì…ë ¥ì´ íŒ¨í„´ê²€ì¦ì„ í†µê³¼í•  ê²½ìš° `onSuccess(true, newPassword);` ì‹¤í–‰
- íŒ¨í„´ê²€ì¦ì— ì‹¤íŒ¨í•  ê²½ìš° `onSuccess(false, newPassword);` ì‹¤í–‰
- ë”°ë¼ì„œ íšŒì›ê°€ì… ì™„ë£Œ ë²„íŠ¼ì€ íŒ¨í„´ê²€ì¦ í†µê³¼ ì—¬ë¶€ì— ë”°ë¼ ë™ì ìœ¼ë¡œ ê°€ì‹œí™” ë¨
```jsx
// íŒ¨ìŠ¤ì›Œë“œ ì…ë ¥ì´ ëë‚  ë•Œ í˜¸ì¶œë  í•¨ìˆ˜
const passwordSuccessHandler = (isValid, password) => {
  setEnteredPassword(password);
  // íšŒì›ê°€ì…ë²„íŠ¼ì„ ì—´ì–´ì¤„ì§€ ì—¬ë¶€
  setIsActiveButton(isValid);
};

return (
  // ...
  {
    isActiveButton &&
    <div>
      <button onClick={handleSubmit}>íšŒì›ê°€ì… ì™„ë£Œ</button>
    </div>
  }
  // ...
);
```

3. `handleSubmit`: ì™„ë£Œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ í•¨ìˆ˜
- `navigate` íšŒì›ê°€ì… ì™„ë£Œ í›„, ì‚¬ìš©ìë¥¼ ë©”ì¸ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜

```jsx
// íšŒì›ê°€ì… ì™„ë£Œ ì´ë²¤íŠ¸
const handleSubmit = e => {
  e.preventDefault();

  (async () => {
    const response = await fetch(`${AUTH_API_URL}/join`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        email: enteredEmail,
        password: enteredPassword
      })
    });

    if (!response.ok) throw new Error('íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');

    const data = await response.json();
    alert(data.message);
    navigate('/');

  })();
};
```

---

## [BE] íšŒì›ê°€ì… ë§ˆë¬´ë¦¬ ì²˜ë¦¬
- íšŒì›ê°€ì… ì™„ë£Œ ë²„íŠ¼ì„ ëˆ„ë¥¸ ì‚¬ìš©ìëŠ” ì´ë¯¸ ì„ì‹œë¡œ íšŒì›ê°€ì… ë˜ì–´ìˆìŒ
- ë°±ì—”ë“œì—ì„œëŠ” ì´ë©”ì¼ê³¼ íŒ¨ìŠ¤ì›Œë“œë¥¼ ë°›ê³ 
- ì„ì‹œ íšŒì›ê°€ì…ëœ íšŒì›ì˜ íŒ¨ìŠ¤ì›Œë“œì™€ ìƒì„±ì‹œê°„ì„ ì±„ì›Œë„£ìœ¼ë©´ ë
- `EventUser` ì—”í‹°í‹°ì—ëŠ” `confirm` í¸ì˜ ë©”ì„œë“œ(ë¹„ë°€ë²ˆí˜¸, ìƒì„±ì‹œê°„ ì±„ì›Œë„£ê¸°) ìƒì„±
```java
// EventUserService.java
public void confirmSignup(SignupRequest dto) {

    // ì„ì‹œ íšŒì›ê°€ì…ëœ íšŒì›ì •ë³´ë¥¼ ì¡°íšŒ
    EventUser foundUser = eventUserRepository.findByEmail(dto.email()).orElseThrow(
            () -> new RuntimeException("ì„ì‹œ íšŒì›ê°€ì…ëœ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.")
    );

    // ì´ë©”ì¼ ì¸ì¦ì„ ë°›ì•˜ëŠ”ì§€ í™•ì¸
    if (!foundUser.isEmailVerified()) {
        throw new RuntimeException("ì´ë©”ì¼ ì¸ì¦ì´ ì™„ë£Œë˜ì§€ ì•Šì€ íšŒì›ì…ë‹ˆë‹¤.");
    }
    
    // ë°ì´í„°ë² ì´ìŠ¤ì— ì„ì‹œ íšŒì›ê°€ì…ëœ íšŒì›ì •ë³´ì˜ íŒ¨ìŠ¤ì›Œë“œì™€ ìƒì„±ì‹œê°„ì„ ì±„ì›Œë„£ê¸°
    foundUser.confirm(dto.password());
    eventUserRepository.save(foundUser);
}

// EventUser.java
public class EventUser {
    // ...
    public void confirm(String password) {
        this.password = password;
        this.createdAt = LocalDateTime.now();
    }
}
```

---

## [BE] íŒ¨ìŠ¤ì›Œë“œ ì•”í˜¸í™” ì²˜ë¦¬
- í˜„ì¬ DBì— íŒ¨ìŠ¤ì›Œë“œê°€ ê·¸ëŒ€ë¡œ ë“¤ì–´ê°€ê³  ìˆìŒ
- ë³´ì•ˆì— ì‹¬ê°í•œ ë¬¸ì œì´ë¯€ë¡œ í•´ì‹œ ì•”í˜¸í™” í•„ìš”

1. ë¹„ë°€ë²ˆí˜¸ í•´ì‹œ ì•”í˜¸í™”ë¥¼ ìœ„í•´ ì˜ì¡´ì„± ì¶”ê°€
```groovy
// ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ëª¨ë“ˆ
implementation 'org.springframework.boot:spring-boot-starter-security'
```

2. Spring Security ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” ì„¤ì • íŒŒì¼ ìƒì„±(`PasswordEncoderConfig`)
- ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•”í˜¸í™”í•˜ëŠ” í•µì‹¬ì ì¸ êµ¬ì„± ìš”ì†Œë¥¼ ì„¤ì •
- `BCryptPasswordEncoder`ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡
- ì´ ì½”ë“œê°€ ì—†ìœ¼ë©´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì§ì ‘ ì•”í˜¸í™”í•˜ëŠ” ì½”ë“œë¥¼ ë§¤ë²ˆ ì‘ì„±

```java
@Configuration
public class PasswordEncoderConfig {
    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}
```

3. ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”í•˜ì—¬ DBì— ì €ì¥
- `passwordEncoder`ë¥¼ í†µí•´ ë¹„ë°€ë²ˆí˜¸ ë¬¸ìì—´ì„ í•´ì‹œ ì•”í˜¸í™”
```java
// EventUserService.java
private final PasswordEncoder passwordEncoder;

public void confirmSignup(SignupRequest dto) {

    // ...
    // ë°ì´í„°ë² ì´ìŠ¤ì— ì„ì‹œ íšŒì›ê°€ì…ëœ íšŒì›ì •ë³´ì˜ íŒ¨ìŠ¤ì›Œë“œì™€ ìƒì„±ì‹œê°„ì„ ì±„ì›Œë„£ê¸°
    foundUser.confirm(passwordEncoder.encode(dto.password()));
    eventUserRepository.save(foundUser);
}
```

---

## [BE] ë¡œê·¸ì¸ ê²€ì¦

1. ë¡œê·¸ì¸ ê²€ì¦ API
- `GET` ìš”ì²­ì€ ì‚¬ìš©ì ì •ë³´ê°€ ë…¸ì¶œë  ê°€ëŠ¥ì„±ì´ ìˆìœ¼ë¯€ë¡œ `POST` ìš”ì²­ìœ¼ë¡œ ì§„í–‰
- í”„ë¡ íŠ¸ì—ì„œ ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ ë³€í™˜
- JSONì„ HTTP ìš”ì²­ì˜ bodyì— ë‹´ì•„ ë°±ì—”ë“œì™€ í†µì‹ 
- Request DTOì¸ `LoginRequest`ì™€ ì •í™•íˆ ë™ì¼í•œ í˜•ì‹ì˜ JSONì„ ë°›ì•„ì•¼ í•¨
// - payload ê°ì²´ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ HTTP ìš”ì²­ì˜ bodyì— ë‹´ì•„ ë°±ì—”ë“œì™€ í†µì‹ 

```java
// LoginRequest.java
public record LoginRequest(
        String email,
        String password
) {
}

// AuthController.java
public class AuthController {
    // ...
    @PostMapping("/login")
    public ResponseEntity<?> login(@RequestBody LoginRequest dto) {

        try {
            return ResponseEntity.ok().body(eventUserService.authenticate(dto));
        } catch (RuntimeException e) {
            return ResponseEntity.status(422).body(Map.of(
                    "message", e.getMessage()
            ));
        }
    }
}
```

2. ë¡œê·¸ì¸ ê²€ì¦ ë¡œì§
- ì ì ˆí•œ ì—ëŸ¬ ì²˜ë¦¬ í•„ìš”
- `passwordEncoder.matches()` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬
- ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸(`dto.password()`)ì™€
- DBì— ì €ì¥ëœ ì•”í˜¸í™”ëœ ë¹„ë°€ë²ˆí˜¸(`foundUser.getPassword()`)ê°€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸

```java
// EventUserService.java
public class EventUserService {
    // ...
    public void authenticate(LoginRequest dto) {

        // ì´ë©”ì¼ì„ í†µí•´ íšŒì›ê°€ì… ì—¬ë¶€ í™•ì¸
        EventUser foundUser
                = eventUserRepository.findByEmail(dto.email()).orElseThrow(
                () -> new RuntimeException("ê°€ì…ëœ íšŒì›ì´ ì•„ë‹™ë‹ˆë‹¤.")
        );

        // íšŒì›ê°€ì…ì„ ì¤‘ë‹¨í•œ íšŒì›ì— ëŒ€í•´ì„œ
        if (!foundUser.isEmailVerified() || foundUser.getPassword() == null) {
            throw new RuntimeException("íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì§€ ì•Šì€ íšŒì›ì…ë‹ˆë‹¤. ë‹¤ì‹œ ê°€ì…í•´ì£¼ì„¸ìš”.");
        }
        // íŒ¨ìŠ¤ì›Œë“œ ì¼ì¹˜ ê²€ì‚¬
        if (!passwordEncoder.matches(dto.password(), foundUser.getPassword())) {
            throw new RuntimeException("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
        }
        
    }
}
```

3. ë¡œê·¸ì¸ ê²€ì¦ í›„ ì„±ê³µí•˜ë©´ í† í° ë°œê¸‰

JWT ê´€ë ¨ ì˜ì¡´ì„± ì¶”ê°€
```groovy
implementation 'io.jsonwebtoken:jjwt-api:0.11.5'
runtimeOnly 'io.jsonwebtoken:jjwt-impl:0.11.5'
runtimeOnly 'io.jsonwebtoken:jjwt-jackson:0.11.5'
```

```java
// EventUserService.java
public class EventUserService {
    // ...
    public Map<String, Object> authenticate(LoginRequest dto) {
        
        // ... íšŒì›ê°€ì…, íšŒì›ê°€ì… ì¤‘ë‹¨ ì—¬ë¶€, íŒ¨ìŠ¤ì›Œë“œ ì¼ì¹˜ ê²€ì‚¬
        
        // ë¡œê·¸ì¸ ì„±ê³µ - í† í° ë°œê¸‰
        String accessToken = tokenProvider.createAccessToken(dto.email());

        return Map.of(
                "token", accessToken,
                "message", "ë¡œê·¸ì¸ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤.",
                "email", dto.email(),
                "role", foundUser.getRole().toString()
        );
    }
}
```

---

## [FE] ë¡œê·¸ì¸ ìš”ì²­

1. ë¼ìš°í„°ì˜ í˜ì´ì§€ì— ì•¡ì…˜ í•¨ìˆ˜ ì„¤ì •
- `WelcomePage` ì•ˆì— ìˆëŠ” `Form`ì´ `method="post"`ë¡œ ì œì¶œë˜ë©´ `loginAction`ì´ í˜¸ì¶œë¨
```jsx
// route-config.jsx

const router = createBrowserRouter([
  {
    path: '/',
    element: <RootLayout />,
    // ...
    children: [
      {
        path: '',
        element: <HomeLayout />,
        children: [
          {
            index: true,
            element: <WelcomePage />,
            action: loginAction
          },
          // ...
        ]
      },
      // ...
    ]
  },
]);
```

2. ì•¡ì…˜í•¨ìˆ˜ ì•„ì›ƒì†Œì‹±
- `GET` ìš”ì²­ìœ¼ë¡œ ì§„í–‰í•˜ë©´ ì •ë³´ ìœ ì¶œì˜ ìœ„í—˜ì´ ìˆê¸° ë•Œë¬¸ì— `POST`ë¡œ ìš”ì²­
- `request.formData()`: í¼ì— ì…ë ¥í•œ ê°’ ê°€ì ¸ì˜¤ê¸°
- `request.method`: ì–´ë–¤ ìš”ì²­ì„ í–ˆëŠ”ì§€
- `redirect()`: React Routerê°€ ì œê³µí•˜ë©°, `action` ë˜ëŠ” `loader` í•¨ìˆ˜ ë‚´ì—ì„œ `return`í•˜ë©´ ì›í•˜ëŠ” í˜ì´ì§€ë¡œ ì´ë™
- `action` í•¨ìˆ˜ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ëŠ” `useActionData`ë¼ëŠ” í›…ìœ¼ë¡œ ë¦¬í„´ ë°ì´í„° ì‚¬ìš© ê°€ëŠ¥
```js
// ë¡œê·¸ì¸ ì²˜ë¦¬ ì•¡ì…˜í•¨ìˆ˜
export const loginAction = async ({ request }) => {

  // ì…ë ¥ë°ì´í„° ì½ê¸°
  const formData = await request.formData();

  const payload = {
    email: formData.get('email'),
    password: formData.get('password'),
  };

  const response = await fetch(`${AUTH_API_URL}/login`, {
    method: 'POST',
    headers: { 'Content-Type':'application/json' },
    body: JSON.stringify(payload)
  });

  const data = await response.json();
  
  // ì˜¤ë¥˜ê°€ ë°œìƒí•œ ê²½ìš°
  if (response.status === 422) {
    // ì„œë²„ì—ì„œ ì‘ë‹µí•œ ë°ì´í„°ë¥¼ ì»´í¬ë„ŒíŠ¸ì—ì„œ ê°€ì ¸ë‹¤ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë°ì´í„°ë¥¼ ë¦¬í„´.
    return data.message;
  }

  // ë¡œê·¸ì¸ì— ì„±ê³µí–ˆì„ ë•Œ - í† í°ì„ ì €ì¥
  localStorage.setItem('userData', JSON.stringify(data));

  return redirect('/');
};
```

3. `WelcomePage` ë‚´ë¶€ì˜ `LoginForm`
- `useActionData()`ë¥¼ ì‚¬ìš©í•´ì„œ action í•¨ìˆ˜ê°€ ë¦¬í„´í•œ ë°ì´í„° ê°€ì ¸ì˜´
- ë¦¬í„´í•œ ë°ì´í„°ë¥¼ ì´ìš©í•´ì„œ ë™ì ìœ¼ë¡œ ì˜¤ë¥˜ ë©”ì‹œì§€ ì¶œë ¥
```jsx
// LoginForm.jsx
const LoginForm = () => {
  
  const error = useActionData();

  return (
    <>
      <Form
        method="post"
        className={styles.form}>
        <h1>Log in</h1>
        <p>
          <label htmlFor="email">Email</label>
          <input
            id="email"
            type="email"
            name="email"
            required
          />
        </p>
        <p>
          <label htmlFor="password">Password</label>
          <input
            id="password"
            type="password"
            name="password"
            required
          />
        </p>
        <div className={styles.actions}>
          <button
            type="submit"
            className={styles.loginButton}>
            Login
          </button>
        </div>

        {error && <p className={styles.error}>{error}</p>}
        
      </Form>
    </>
  );
};
```

---




ì•¡ì…˜ í•¨ìˆ˜ëŠ” ì—¬ëŸ¬ê°œ ëª» ê±¸ìŒ
-> ë¡œê·¸ì•„ì›ƒì„ í•˜ëŠ” ë¼ìš°íŠ¸ë¥¼ ìƒˆë¡œ ë§Œë“¤ìŒ


// í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì—ëŠ” ë°”ë¡œ ì „ë‹¬ ê°€ëŠ¥
loader: userDataLoader,
// loaderì˜ ë¦¬í„´ë°ì´í„°ëŠ” children(Outlet)ë“¤ì—ê²ŒëŠ” ì „ë‹¬ë˜ì§€ ì•ŠëŠ”ê²Œ ê¸°ë³¸
// ê·¸ëŸ°ë° idë¥¼ ì£¼ë©´ Childrenë“¤ì´ idë¡œ ê°€ì ¸ê°ˆ ìˆ˜ ìˆìŒ
id: 'user-token-data'

// ìƒìœ„ ë ˆì´ì•„ì›ƒì´ ê°€ì§€ê³  ìˆëŠ” ë¡œë”ì˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ë•ŒëŠ” idë¥¼ ì‚¬ìš©
const userData = useLoaderData('user-token-data');
