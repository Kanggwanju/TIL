# 🗓️ 2025년 7월 23일 TIL


JDBC 기초
PreparedStatement
- SQL 인젝션 방지
- 성능 향상
- 코드 가독성과 유지보수

사용 방법
1. 준비하기
```java
String sql = "INSERT INTO users (name, age) VALUES (?, ?)";
PreparedStatement pstmt = connection.prepareStatement(sql);
```
2. 값 설정
```java
pstmt.setString(1, "홍길동");  // 첫 번째 ? 에 문자열 설정
pstmt.setInt(2, 25);        // 두 번째 ? 에 숫자 설정
```
3. 실행하기
```java
pstmt.executeUpdate();  // INSERT, UPDATE, DELETE 실행할 때
// 또는
pstmt.executeQuery();   // SELECT 실행할 때
```
예시) INSERT 기능 - 도서 생성
```java
public boolean save(Book book) {
    try (Connection conn = dataSource.getConnection()) {

        String sql = """
                    INSERT INTO BOOKS
                        (title, author, isbn)
                    VALUES
                        (?, ?, ?)
                    """;

        PreparedStatement pstmt = conn.prepareStatement(sql);
        pstmt.setString(1, book.getTitle());
        pstmt.setString(2, book.getAuthor());
        pstmt.setString(3, book.getIsbn());

        int result = pstmt.executeUpdate();
        return result == 1;


    } catch (Exception e) {
        e.printStackTrace();
        return false;
    }
}

```
---
- try에 파라미터로 conn을 넣어줌으로써 나중에 close를 하지 않아도
  되게 만들음.
- sql문을 따로 설정하고 prepareStatement를 만들어서 준비
- setString을 통해 제목, 저자, ISBN을 설정
- executeUpdate을 이용하여 INSERT 문 실행


---

ResultSet 이해
```java
ResultSet rs = pstmt.executeQuery();
while (rs.next()) {  // 한 줄씩 아래로 이동
    String name = rs.getString("name");  // name 컬럼의 값을 읽기
    int age = rs.getInt("age");         // age 컬럼의 값을 읽기
}

```


데이터 조회와 수정
(SELECT, INSERT, UPDATE, DELETE)

SELECT 문 - 데이터 조회

```java
String sql = "SELECT * FROM books WHERE title LIKE ?";
pstmt.setString(1, "%자바%");
ResultSet rs = pstmt.executeQuery();

while (rs.next()) {
    String title = rs.getString("title");
    System.out.println("찾은 책: " + title);
}

```

INSERT 문 - 새로운 데이터 추가
```java
String sql = "INSERT INTO books (title, author, isbn) VALUES (?, ?, ?)";
pstmt.setString(1, "자바의 정석");
pstmt.setString(2, "남궁성");
pstmt.setString(3, "123456789");
int result = pstmt.executeUpdate();

```

UPDATE 문 - 기존 데이터 수정
```java
String sql = "UPDATE books SET available = ? WHERE isbn = ?";
pstmt.setBoolean(1, false);  // 책이 대출됨을 표시
pstmt.setString(2, "123456789");
int result = pstmt.executeUpdate();

```

DELETE 문 - 데이터 삭제
```java
// Hard Delete (실제 삭제) - 권장하지 않음
String sql = "DELETE FROM books WHERE isbn = ?";

// Soft Delete (논리적 삭제) - 권장
String sql = "UPDATE books SET deleted = true WHERE isbn = ?";
pstmt.setString(1, "123456789");
int result = pstmt.executeUpdate();

```

주의할 점

1. 리소스 관리
- ResultSet, PreparedStatement, Connection은 
- 반드시 사용 후 닫아주어야 함. try-with-resources 구문을 사용하면 자동으로 처리
2. 데이터 타입 매칭
- 데이터베이스의 컬럼 타입과 자바의 데이터 타입을 올바르게 매칭
- 데이터베이스의 NUMBER는 자바의 Long이나 Integer와 매칭
3. 예외처리
- SQL 작업은 항상 실패할 가능성이 있으므로, 적절한 예외 처리가 필요
4. 성능 고려
- 대량의 데이터를 다룰 때는 한 번에 모든 데이터를 메모리에 불러오지 않도록 주의






































SQL 기본
5강 - GROUP BY, HAVING 절


WHERE 절은 그룹화하기 전, 집계 대상이 되기 전에 빼버림
HAVING 절은 그룹화하고 난 후 필터링

 
1. FROM: 타겟팅
2. WHERE: 1차 필터링
3. GROUP BY: 집계
4. HAVING: 2차 필터
5. SELECT: 매핑
6. ORDER BY: 정렬

```sql
-- POST 테이블에서 장문(20글자이상)의 피드를 쓴 게시물들의 개수를 보고 싶다.
-- 유저별로 보고싶음
-- 장문 게시물 5개 이상 쓴 아이디
SELECT
    user_id,
    COUNT(*) AS "장문 게시물 수"
FROM
    POSTS
WHERE LENGTH(content) >= 30
GROUP BY user_id
HAVING COUNT(*) >= 5 -- 장문 게시물을 쓴 사용자만 조회
;
```




중요!
null에 어떤 연산을 해도 null이 나온다.
ex) null + 20 -> null, null*3 -> null
