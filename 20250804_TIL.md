# ğŸ—“ï¸ 2025ë…„ 8ì›” 4ì¼ TIL


QueryDSL ì„œë¸Œì¿¼ë¦¬
- ì¿¼ë¦¬ ë‚´ì— í¬í•¨ëœ ë˜ ë‹¤ë¥¸ ì¿¼ë¦¬ë¥¼ ì˜ë¯¸í•¨
- íŠ¹ì • ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ë°ì´í„°ë¥¼ ì¡°íšŒ
- ì§‘ê³„ í•¨ìˆ˜ì™€ í•¨ê»˜ ì‚¬ìš©
- ì¡´ì¬ ì—¬ë¶€ í™•ì¸

ì„œë¸Œì¿¼ë¦¬ì— ì‚¬ìš©ë˜ëŠ” íƒ€ì…
1. `JPAExpressions`
- QueryDSLì—ì„œ ì„œë¸Œì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” í´ë˜ìŠ¤
- ì„œë¸Œì¿¼ë¦¬ë¥¼ ì‘ì„±í•  ë•Œ, `JPAExpressions.select()`ì™€ ê°™ì´ ì‚¬ìš©

2. `JPQLQuery`
- `JPQLQuery`ëŠ” JPQL(Java Persistence Query Language) ì¿¼ë¦¬ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì¸í„°í˜ì´ìŠ¤
- ì„œë¸Œì¿¼ë¦¬ë¥¼ í‘œí˜„í•  ë•Œ ì‚¬ìš©


ë¹„ì—°ê´€ ì„œë¸Œì¿¼ë¦¬
ì˜ˆì œ: íŠ¹ì • ê·¸ë£¹ì˜ í‰ê·  ë‚˜ì´ë³´ë‹¤ ë§ì€ ì•„ì´ëŒ ì¡°íšŒ

```java
@Test
@DisplayName("íŠ¹ì • ê·¸ë£¹ì˜ í‰ê·  ë‚˜ì´ë³´ë‹¤ ë§ì€ ì•„ì´ëŒ ì¡°íšŒ")
void testFindIdolsOlderThanGroupAverageAge() {
    // ì„œë¸Œì¿¼ë¦¬: íŠ¹ì • ê·¸ë£¹ì˜ í‰ê·  ë‚˜ì´
    JPQLQuery<Double> subQuery = JPAExpressions
            .select(idol.age.avg())
            .from(idol)
            .innerJoin(idol.group, group)
            .where(group.groupName.eq("ë¥´ì„¸ë¼í•Œ"));

    // ë©”ì¸ì¿¼ë¦¬: ì„œë¸Œì¿¼ë¦¬ì˜ ê²°ê³¼ë³´ë‹¤ ë‚˜ì´ê°€ ë§ì€ ì•„ì´ëŒ ì¡°íšŒ
    List<Idol> result = factory
            .selectFrom(idol)
            .where(idol.age.gt(subQuery))
            .fetch();

    assertFalse(result.isEmpty());
    for (Idol i : result) {
        System.out.println("\nIdol: " + i.getIdolName()
                + ", Group: " + i.getGroup().getGroupName()
                + ", Age: " + i.getAge());
    }
}
```

ì—°ê´€ ì„œë¸Œì¿¼ë¦¬

ì˜ˆì œ: Exists êµ¬ë¬¸
- ê·¸ë£¹ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì•„ì´ëŒì„ ì¡°íšŒí•˜ëŠ” ì˜ˆì œ

```java
@Test
@DisplayName("ê·¸ë£¹ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì•„ì´ëŒ ì¡°íšŒ")
void testFindIdolsWithoutGroup() {
    

    // ì„œë¸Œì¿¼ë¦¬: ì•„ì´ëŒì´ íŠ¹ì • ê·¸ë£¹ì— ì†í•˜ëŠ”ì§€ í™•ì¸
    JPQLQuery<Long> subQuery = JPAExpressions
            .select(group.id)
            .from(group)
            .where(group.id.eq(idol.group.id));

    // ë©”ì¸ì¿¼ë¦¬: ì„œë¸Œì¿¼ë¦¬ ê²°ê³¼ê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì•„ì´ëŒ ì¡°íšŒ
    List<Idol> result = factory
            .selectFrom(idol)
            .where(subQuery.notExists())
            .fetch();

    assertFalse(result.isEmpty());
    for (Idol i : result) {
        System.out.println("\nIdol: " + i.getIdolName());
    }
}

```

---

QueryDSL ë™ì ì¿¼ë¦¬
- `BooleanBuilder` ì‚¬ìš©
- `and` ë˜ëŠ” `or` ì—°ì‚°ìë¥¼ ì‚¬ìš©í•˜ì—¬ ì—¬ëŸ¬ ì¡°ê±´ì„ ì¡°í•©í•  ìˆ˜ ìˆìŒ


ì˜ˆì œ: ë‹¤ì–‘í•œ ì¡°ê±´ì— ë”°ë¼ ì•„ì´ëŒì„ ì¡°íšŒ
```java
@Test
@DisplayName("ë™ì  ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•œ ë³µì¡í•œ ì¡°ê±´ì˜ ì•„ì´ëŒ ì¡°íšŒ")
void testComplexDynamicQueryForIdols() {

    String name = "ê¹€ì±„ì›";  
    Integer minAge = 20;
    Integer maxAge = 25;
    String gender = "ì—¬";
    String groupName = "ë¥´ì„¸ë¼í•Œ";

    BooleanBuilder builder = new BooleanBuilder();

    if (name != null) {
        builder.and(idol.idolName.eq(name));
    }
    if (minAge != null) {
        builder.and(idol.age.goe(minAge));
    }
    if (maxAge != null) {
        builder.and(idol.age.loe(maxAge));
    }
    if (gender != null) {
        builder.and(idol.gender.eq(gender));
    }
    if (groupName != null) {
        builder.and(idol.group.groupName.eq(groupName));
    }

    List<Idol> result = factory
            .selectFrom(idol)
            .where(builder)
            .fetch();

    assertFalse(result.isEmpty());
    for (Idol i : result) {
        System.out.println("\nIdol: " + i.getIdolName() + ", Age: " + i.getAge() + ", Gender: " + i.getGender() + ", Group: " + i.getGroup().getGroupName());
    }
}
```


