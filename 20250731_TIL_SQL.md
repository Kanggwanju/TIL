# 🗓️ 2025년 7월 31일 TIL - SQL 정리


계층형 쿼리(Hierarchical Query)

1. 계층형 쿼리의 핵심 4총사

`START WITH`
- 계층 탐색 시작 지점을 조건으로 정함
- START WITH의 조건에 맞는 튜플 = LEVEL 1
- LEVEL 1은 무조건 나와야함

`CONNECT BY`
- 부모와 자식의 관계를 어떻게 연결할지 규칙을 정의

`PRIOR`
- 마치 `PK`처럼 빠짐없이 있으면 자식
- 여러개에 연결되어 있으면 부모
- PRIOR가 자식쪽에 붙으면 순방향 전개 (위 -> 아래)
- PRIOR가 부모쪽에 붙으면 역방향 전개 (아래 -> 위)

`LEVEL`
- 계층의 깊이(단계)를 나타내는 가상 컬럼 (루트는 1)


ORDER SIBLINGS BY `기준`
- 계층은 유지하고, 형제끼리만 정렬

```sql
ORDER SIBLINGS BY -- ORDER BY 대신 ORDER SIBLINGS BY를 사용!
    registration_date ASC; -- 형제 노드 간 정렬 기준: 가입일 오름차순
```

---

노랭이책 문제

극히 드문 예시
SELECT, WHERE 에서도 PRIOR 키워드 사용 가능

계층형 질의문 설명 고르기는 대부분 재귀


2과목 파트 3 64번 문제

— 보기 1

부서코드  부서명   상위부서코드   LEVEL     매출액
===============================
100       아시아지부   NULL             2        NULL
120       일본지사    100                 1         NULL
121       도쿄지사    120                 2         1500
121       오사카지사    120               2         1000


— 보기 2

부서코드  부서명   상위부서코드   LEVEL
===============================
100       아시아지부     NULL          1
110       한국지사        100             2
111       서울지점        110             3
112       부산지점        110             3

120       일본지사        100             2
121       도쿄지점        120             3
122       오사카지점        120             3

130       중국지사        100             2
131       베이징지점        130             3
132       상하이지점        130             3


— 보기 3

부서코드  부서명   상위부서코드   LEVEL
===============================
121       도쿄지점        120             1
120       일본지사        100             2
100       아시아지부      null             3

— 보기 4

부서코드  부서명   상위부서코드   LEVEL
===============================

100       아시아지부     NULL          1
110       한국지사        100             2
111       서울지점        110             3
112       부산지점        110             3

120       일본지사        100             2
121       도쿄지점        120             3
122       오사카지점        120             3

130       중국지사        100             2
131       베이징지점        130             3
132       상하이지점        130             3


---

2과목 파트 4 74번 문제

[ 평가대상 상품 ]
A01    스프링부트 강의
A02    리액트 강의

[ 품질평가 항목 ]
B01    강의자료
B02    강의난이도

[ 평가 결과 ]
A01   B01     1회차    4.0
A01   B01     2회차    5.0

A01   B02     1회차    1.5
A01   B02     2회차    3.0
A01   B02     3회차    4.0

A02   B01     1회차    4.8

A02   B02     1회차    4.5
A02   B02     2회차    4.7
A02   B02     3회차    2.4

SELECT MAX(X.평가회차)
FROM 평가결과 X
WHERE X.상품ID = B.상품ID
AND X.평가항목ID = C.평가항목ID
-> 상품과 평가항목이 일치하는 튜플 조합들 중에서
가장 높은(MAX) 평가회차를 뽑음
-> 2, 3, 1, 3


