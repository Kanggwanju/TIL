# ğŸ—“ï¸ 2025ë…„ 7ì›” 22ì¼ TIL


ìŠ¤í”„ë§
íŒŒì¼ ì—…ë¡œë“œì™€ ì´ë¯¸ì§€ ì²˜ë¦¬


íŒŒì¼ ì—…ë¡œë“œ
- í´ë¼ì´ì–¸íŠ¸ê°€ ë¡œì»¬ íŒŒì¼ì„ ì„œë²„ë¡œ ì „ì†¡í•˜ëŠ” ì‘ì—…

Spring Bootì—ì„œ íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
- MultipartFile ê°ì²´ë¥¼ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ ì—…ë¡œë“œë¥¼ ê°„ë‹¨í•˜ê²Œ ì²˜ë¦¬

## **MultipartFile ê°ì²´ í™œìš©í•˜ê¸°**

- **`MultipartFile` ì£¼ìš” ë©”ì„œë“œ**:
    - `getOriginalFilename()`: ì—…ë¡œë“œëœ íŒŒì¼ì˜ ì›ë˜ ì´ë¦„ì„ ë°˜í™˜.
    - `getSize()`: íŒŒì¼ í¬ê¸°ë¥¼ ë°˜í™˜ (ë°”ì´íŠ¸ ë‹¨ìœ„).
    - `getContentType()`: íŒŒì¼ì˜ MIME íƒ€ì… ë°˜í™˜.
    - `isEmpty()`: íŒŒì¼ì´ ë¹„ì–´ ìˆëŠ”ì§€ ì—¬ë¶€ í™•ì¸.
    - `transferTo(File dest)`: íŒŒì¼ì„ ì§€ì •ëœ ìœ„ì¹˜ë¡œ ì €ì¥.

## MultipartFile ê¸°ë³¸ ì„¤ì •
- yml íŒŒì¼ì€ .gitignoreì„ ì‚¬ìš©í•˜ì—¬ ê¹ƒí—ˆë¸Œì— ì˜¬ë¦¬ë©´ ì•ˆëœë‹¤.
```yaml
# application.yml

#file upload setting
spring:
  servlet:
    multipart:
      max-file-size: 10MB     # ì—…ë¡œë“œí•  íŒŒì¼ 1ê°œì˜ ìµœëŒ€ ìš©ëŸ‰ì„ ì œí•œ
      max-request-size: 100MB # í•œë²ˆì— ì—…ë¡œë“œí•  ìˆ˜ ìˆëŠ” íŒŒì¼ì˜ ì´ ìš©ëŸ‰

# custom setting
# ì‚¬ìš©ìë“¤ì´ ì˜¬ë¦° íŒŒì¼ë“¤ì„ ì–´ë””ì— ì €ì¥í• ì§€ ë£¨íŠ¸ ê²½ë¡œ
file:
  upload:
    location: ${user.home}/spring/upload/
```
---
FileUploadConfig
- íŒŒì¼ ì—…ë¡œë“œ ê´€ë ¨ ì„¤ì • í´ë˜ìŠ¤
```java
@Configuration
@Getter
public class FileUploadConfig {
    @Value("${file.upload.location}")
    private String location;
    
    // ë£¨íŠ¸ ê²½ë¡œê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ì—†ìœ¼ë©´ ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±
    @PostConstruct
    public void init() {
        File directory = new File(location);
        if (!directory.exists()) directory.mkdirs();
    }

}
```
@Configuration
- ì´ ì• ë…¸í…Œì´ì…˜ì€ ì„¤ì • íŒŒì¼(ë…¼ë¦¬ì ìœ¼ë¡œëŠ” í´ë˜ìŠ¤)ì„ì„ ë°í˜

@Value("${file.upload.location}")
- ìŠ¤í”„ë§ì˜ Value ì•„ë…¸í…Œì´ì…˜
- application.ymlì— ìˆëŠ” íŒŒì¼ì—…ë¡œë“œ ë£¨íŠ¸ê²½ë¡œë¥¼ ì½ì–´ì˜´
- ì´ë ‡ê²Œ í•˜ëŠ” ì´ìœ ëŠ” ymlì€ ìˆ¨ê²¨ì„œ ê²½ë¡œë¥¼ ë“œëŸ¬ë‚´ì§€ ì•Šì•„, ë³´ì•ˆì„ ê°•í™”í•¨

@PostConstruct
- ë¹ˆì´ ìƒì„±ë˜ëŠ” ìˆœê°„ ìë™ìœ¼ë¡œ 1íšŒ ì‹¤í–‰
- Springì´ í•´ë‹¹ í´ë˜ìŠ¤ì˜ ì˜ì¡´ì„± ì£¼ì…ì„ ë§ˆì¹œ í›„ ìë™ìœ¼ë¡œ ì‹¤í–‰
- ì´ˆê¸° ì„¤ì •ìš© ë©”ì„œë“œ

---
WebResourceConfig
- ì‚¬ìš©ìê°€ ì—…ë¡œë“œí•œ íŒŒì¼ ì„œë²„ì— URLë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ì„¤ì •
```java
@Configuration
@RequiredArgsConstructor
public class WebResourceConfig implements WebMvcConfigurer {
    private final FileUploadConfig fileUploadConfig;
    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/uploads/**")
                .addResourceLocations("file:" + fileUploadConfig.getLocation());
    }
}
```
* WebMvcConfigurer ìƒì† ì´ìœ 
- ì›¹ ê´€ë ¨ ì„¤ì •ì„ ë‚´ ì…ë§›ëŒ€ë¡œ ë°”ê¾¸ê¸° ìœ„í•´
- ì—¬ê¸°ì„œëŠ” ì •ì  ìì›(ì´ë¯¸ì§€, ì—…ë¡œë“œëœ íŒŒì¼ ë“±)ì„ ì™¸ë¶€ ë””ë ‰í† ë¦¬ì—ì„œ ì„œë¹™í•˜ê³  ìˆìŒ

addResourceHandlers
- íŒŒì¼ì„œë²„ì— ì €ì¥ëœ C:/Users/user/spring/upload ì•ˆì— ë“¤ì–´ìˆëŠ” íŒŒì¼ë“¤ì„
- ë°±ì—”ë“œì„œë²„ì—ì„œ http://localhost:9000/uploads/íŒŒì¼ëª… -> í–ˆì„ ë•Œ êº¼ë‚´ì£¼ê² ë‹¤.
---

íŒŒì¼ ì—…ë¡œë“œ
ì‚¬ìš©ìê°€ ì˜¬ë¦° ì²¨ë¶€íŒŒì¼ (ì´ë¯¸ì§€, ì˜ìƒ ë“±) ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬
```java
@RestController
@RequestMapping("/api/v8")
@Slf4j
@RequiredArgsConstructor
public class FileUploadController {

    private final FileUploadConfig fileUploadConfig;

    // ì²¨ë¶€íŒŒì¼ ì—…ë¡œë“œ ìš”ì²­ ì²˜ë¦¬
    @PostMapping("/uploads")
    public ResponseEntity<?> uploadSingleFile(
        @RequestParam("profile") MultipartFile originFile
    ) {

        log.info("uploaded file name: {}", originFile.getOriginalFilename());
        log.info("uploaded file type: {}", originFile.getContentType());

        // íŒŒì¼ì„ ë°›ì•˜ìœ¼ë©´ ì˜ ë³´ê´€ (ë¡œì»¬ì— ì €ì¥)
      
        // ì €ì¥ íŒŒì¼ ê²½ë¡œ ìƒì„±
        // ë£¨íŠ¸ ë””ë ‰í† ë¦¬ ê°€ì ¸ì˜¤ê¸°
        String rootDir = fileUploadConfig.getLocation();
        // íŒŒì¼ëª… ê°€ì ¸ì˜¤ê¸°
        String originFilename = originFile.getOriginalFilename();
        String extension = originFilename.substring(originFilename.lastIndexOf("."));
        String filename = UUID.randomUUID().toString() + extension;
        String fullName = rootDir + filename;

        File uploadedLocation = new File(fullName);

        // íŒŒì¼ ì „ì†¡ ëª…ë ¹
        try {
            originFile.transferTo(uploadedLocation);
        } catch (IOException e) {
            return ResponseEntity.internalServerError().body("íŒŒì¼ ì €ì¥ ì‹¤íŒ¨!");
        }

        return ResponseEntity.ok("OK!!");
    }
}
```

íŒŒì¼ì´ë¦„ì´ ê²¹ì³ì§€ë©´ ë®ì–´ì”Œì›Œì§€ë¯€ë¡œ
íŒŒì¼ ì´ë¦„ì„ uuidë¡œ ì„¤ì •
DBì—ëŠ” ì›ë³¸ íŒŒì¼ëª…ì´ ë¬´ì—‡ì´ê³ , ì–¸ì œ ì˜¬ë¦¬ê³ , ëˆ„ê°€ ì˜¬ë ¸ëŠ”ì§€ ë“±ì˜
ì •ë³´ë¥¼ ì €ì¥í•´ë†”ì•¼í•¨.

---

íŒŒì¼ ê²€ì¦

1. íŒŒì¼ ìœ í˜• ê²€ì¦ (MIME íƒ€ì…)

- ì—…ë¡œë“œëœ íŒŒì¼ì˜ **MIME íƒ€ì…**ì„ í™•ì¸í•˜ì—¬ í—ˆìš©ëœ íŒŒì¼ ìœ í˜•ì¸ì§€ ê²€ì¦.
- `MultipartFile.getContentType()` ë©”ì„œë“œë¡œ íŒŒì¼ì˜ MIME íƒ€ì…ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŒ.

**í—ˆìš©ë˜ì§€ ì•Šì€ íŒŒì¼ ìœ í˜• ì²˜ë¦¬:**

- ì˜ˆë¥¼ ë“¤ì–´, ì´ë¯¸ì§€ë§Œ ì—…ë¡œë“œí•˜ë„ë¡ ì œí•œí•˜ë ¤ë©´ `image/jpeg`, `image/png`ì™€ ê°™ì€ MIME íƒ€ì…ë§Œ í—ˆìš©.

2. íŒŒì¼ í¬ê¸° ì œí•œ ì²˜ë¦¬

- **Spring Boot ì„¤ì •**ìœ¼ë¡œ íŒŒì¼ í¬ê¸°ì™€ ìš”ì²­ í¬ê¸°ë¥¼ ì œí•œí•  ìˆ˜ ìˆìŒ:

```yaml
# application.yml

spring:
  servlet:
    multipart:
      max-file-size: 10MB
      max-request-size: 20MB
```
- ì—…ë¡œë“œëœ íŒŒì¼ í¬ê¸°ëŠ” MultipartFile.getSize() ë©”ì„œë“œë¡œ í™•ì¸ ê°€ëŠ¥.
---




## ìŠ¤í”„ë§ ë°ì´í„° ì ‘ê·¼
### JDBC ê¸°ì´ˆ
#### ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°

Maria DB(ë¬´ë£Œë¡œ ì´ìš© ê°€ëŠ¥) ì„¤ì¹˜
ì•„ë§ˆì¡´ê³¼ ì„¸íŒ…ì„ ë§ì¶”ê¸° ìœ„í•´ 11.4.7 ë‹¤ìš´ë¡œë“œ
ì„¤ì¹˜ ê³¼ì • ì¤‘ì— ë¹„ë°€ë²ˆí˜¸ë¥¼ ì œì™¸í•˜ê³  ë‹¤ë¥¸ ê²ƒë“¤ì€ ë„˜ì–´ê°€ë©´ ëœë‹¤.

ì¸í…”ë¦¬ì œì´ì—ì„œ ë°ì´í„° ì†ŒìŠ¤ Maria DB ì¶”ê°€
ê´€ë¦¬ì(ì‚¬ìš©ì) ì´ë¦„: root

ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ê³µë¶€ë¥¼ ìœ„í•´ ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ ìƒì„±
ì¢…ì†ì„± ì¶”ê°€
- Lombok
- Spring Web
- Spring Data JPA
- MariaDB Driver


ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì— í•„ìš”í•œ í•µì‹¬ ìš”ì†Œ
1. ë°ì´í„°ë² ì´ìŠ¤ ì£¼ì†Œ(URL)
```
jdbc:mariadb://localhost:3306/spring_study
```
- localhost: ë‚´ ì»´í“¨í„°ë¥¼ ì˜ë¯¸
- 3306: MySQL, MariaDBê°€ ì‚¬ìš©í•˜ëŠ” ë¬¸ ë²ˆí˜¸(í¬íŠ¸)ì…ë‹ˆë‹¤
- spring_study: ì‚¬ìš©í•  ë°ì´í„°ë² ì´ìŠ¤ ì´ë¦„

2. ì‚¬ìš©ì ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸
```
username: "root"
password: "mariadb"
```

3. JDBC ë“œë¼ì´ë²„
- MySQLì„ ì“¸ ë•ŒëŠ” MySQL ë“œë¼ì´ë²„ê°€,
- Oracleì„ ì“¸ ë•ŒëŠ” Oracle ë“œë¼ì´ë²„ê°€ í•„ìš”
- ì•„ê¹Œ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ ë•Œ MariaDB Driver ì¢…ì†ì„± ì¶”ê°€í–ˆìŒ.

4. ì—°ê²° ê´€ë¦¬
- application.yml íŒŒì¼ì— ì•„ë˜ì™€ ê°™ì´ ì„¤ì •
```yaml
spring.datasource.url=jdbc:mariadb://localhost:3306/spring_study
spring.datasource.username=root
spring.datasource.password=mariadb
```

