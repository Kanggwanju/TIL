# ğŸ—“ï¸ 2025ë…„ 7ì›” 24ì¼ TIL

JdbcTemplate
- JDBCë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ë©´ì„œ ë§ì€ ë°˜ë³µì ì¸ ì½”ë“œë¥¼ ì‘ì„±

í•´ê²°í•´ì£¼ëŠ” ê²ƒë“¤
1. ë¦¬ì†ŒìŠ¤ ê´€ë¦¬ ìë™í™”

2. ì˜ˆì™¸ ì²˜ë¦¬ ë‹¨ìˆœí™”
- SQL ê´€ë ¨ ëª¨ë“  ì˜ˆì™¸ë¥¼ ìŠ¤í”„ë§ì˜ DataAccessExceptionìœ¼ë¡œ ë³€í™˜í•´ì¤Œ
- checked ì˜ˆì™¸ë¥¼ unchecked ì˜ˆì™¸ë¡œ ë³€í™˜í•˜ì—¬ ì½”ë“œë¥¼ ë” ê¹”ë”í•˜ê²Œ ë§Œë“¤ì–´ì¤Œ

3. ë°˜ë³µ ì‘ì—… ì œê±°
- ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì–»ê¸°
- PreparedStatement ìƒì„±
- ê²°ê³¼ ì²˜ë¦¬
- ë¦¬ì†ŒìŠ¤ ì •ë¦¬

JdbcTemplateì˜ ì£¼ìš” ë©”ì„œë“œ
1. ì¡°íšŒ ê´€ë ¨
```java
// ë‹¨ì¼ í–‰ ì¡°íšŒ
jdbcTemplate.queryForObject(sql, rowMapper, params);

// ì—¬ëŸ¬ í–‰ ì¡°íšŒ
jdbcTemplate.query(sql, rowMapper, params);

// ë‹¨ì¼ ê°’ ì¡°íšŒ
jdbcTemplate.queryForObject(sql, Integer.class, params);

```

2. ìˆ˜ì • ê´€ë ¨

```java
// INSERT, UPDATE, DELETE
jdbcTemplate.update(sql, params);

```

---

JdbcTemplate ì„¤ì •
build.gradle íŒŒì¼ì— ì˜ì¡´ì„± ì¶”ê°€
```groovy
dependencies {
    // ìŠ¤í”„ë§ JDBC ì˜ì¡´ì„±
    implementation 'org.springframework.boot:spring-boot-starter-jdbc'

    // MariaDB ë“œë¼ì´ë²„ ì˜ì¡´ì„±
    implementation 'org.mariadb.jdbc:mariadb-java-client:3.1.4'
}
```
ë‚˜ëŠ” Spring Bootì—ì„œ `Spring Data JPA`, `MariaDB Driver` ì˜ì¡´ì„±ì„ ì¶”ê°€í–ˆê¸° ë•Œë¬¸ì— ë”°ë¡œ ì˜ì¡´ì„±ì„ ì¶”ê°€í•˜ì§€ ì•Šì•˜ìŒ.
Spring Data JPA ì˜ì¡´ì„±ë§Œ ì¶”ê°€í•´ë„ JdbcTemplateì€ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
ì´ìœ ëŠ” Spring Bootê°€ ë‚´ë¶€ì ìœ¼ë¡œ **spring-boot-starter-data-jpa â†’ spring-boot-starter-jdbc**ë¥¼ í•¨ê»˜ í¬í•¨í•˜ê³  ìˆê¸° ë•Œë¬¸

---


JdbcTemplate ê¸°ë³¸ ì‚¬ìš©ë²•
```java
@Repository
public class ProductRepository {
    private final JdbcTemplate template;

    public ProductRepository(JdbcTemplate jdbcTemplate) {
        this.template = jdbcTemplate;
    }
}
```

ë°ì´í„° ë³€ê²½í•˜ê¸° (INSERT, UPDATE, DELETE)
- update() ë©”ì„œë“œë¥¼ ì‚¬ìš©

1. ë°ì´í„° ì¶”ê°€ (INSERT)
```java
public boolean save(Product product) {
        String sql = """
                    INSERT INTO PRODUCTS
                        (name, price, stock_quantity, status)
                    VALUES
                        (?, ?, ?, ?)
                """;

        return template.update(
                sql,
                product.getName(),
                product.getPrice(),
                product.getStockQuantity(),
                product.getStatus(),
        ) == 1;
    }
```
2. ë°ì´í„° ìˆ˜ì • (UPDATE)
```java
public boolean update(Product product) {
        String sql = """
                    UPDATE PRODUCTS
                    SET
                        name = ?,
                        price = ?,
                        stock_quantity = ?,
                    WHERE id = ?
                """;

        return template.update(
                sql,
                product.getName(),
                product.getPrice(),
                product.getStockQuantity(),
                product.getId()
        ) == 1;
```

3. ë°ì´í„° ì‚­ì œ (DELETE)
- ë³´í†µ DBì—ì„œ ì§„ì§œ ì‚­ì œí•˜ì§€ ì•Šê³ , status ê°’ì„ í†µí•´ ë…¼ë¦¬ì  ì‚­ì œë¥¼ í•œë‹¤.
- statusê°€ DELETEDê°€ ëë‹¤ëŠ” ê±´ ë…¼ë¦¬ì ìœ¼ë¡œ ì‚­ì œë˜ì–´, ëª©ë¡ ì¡°íšŒì—ì„œ ì•ˆ ë³´ì´ê²Œ í•´ì•¼í•¨.
```java
public boolean deleteById(Long id) {
    String sql = """
                UPDATE PRODUCTS
                SET status = ?
                WHERE id = ?
            """;

    return template.update(
            sql,
            "DELETED",
            id
    ) == 1;
}
```


RowMapper í™œìš©
- JdbcTemplateì˜ ê°€ì¥ ì¤‘ìš”í•œ ë„êµ¬ ì¤‘ í•˜ë‚˜
- ë°ì´í„°ë² ì´ìŠ¤ì˜ ê²°ê³¼ë¥¼ ìë°” ê°ì²´ë¡œ ë³€í™˜í•´ì£¼ëŠ” ë³€í™˜ê¸°ì™€ ê°™ì€ ì—­í• 

RowMapperê°€ í•„ìš”í•œ ì´ìœ 
- ë°ì´í„°ë² ì´ìŠ¤ëŠ” í‘œ(í…Œì´ë¸”) í˜•íƒœë¡œ ë°ì´í„°ë¥¼ ì €ì¥
- ìë°”ì—ì„œëŠ” ê°ì²´ í˜•íƒœë¡œ ë°ì´í„°ë¥¼ ë‹¤ë£¸
- ê¸°ì¡´ì—ëŠ” ì „ì²´ ë°ì´í„° ì¡°íšŒ ì¿¼ë¦¬ë¥¼ í†µí•´ ResultSetì„ ì–»ì–´ì„œ 
- ResultSetì˜ ì •ë³´ë¥¼ í† ëŒ€ë¡œ ê°ì²´ë¥¼ ë§Œë“¤ê³ , ê°ì²´ ë¦¬ìŠ¤íŠ¸ì— ë„£ì–´ì„œ return í•´ì¤¬ìŒ.
- ì´ ê·€ì°®ì€ ì‘ì—…ì„ ëŒ€ì‹  í•´ì¤€ë‹¤.

ë°ì´í„° ì¡°íšŒí•˜ê¸° (SELECT)
1. ë‹¨ì¼ ìƒí’ˆ ì¡°íšŒ
```java
public Book findById(Long id) {
    String sql = """
                    SELECT * FROM BOOKS
                    WHERE id = ?
                """;
    return template.queryForObject(
            sql,
            new RowMapper<Book>() {
                @Override
                public Book mapRow(ResultSet rs, int n) throws SQLException {
                    return new Book(rs);
                }
            },
            // (rs, n) -> new Book(rs),
            id
    );
}
```
- RowMapperì€ ì¸í„°í˜ì´ìŠ¤ì„. ëŒë‹¤ë¡œ ë°”ê¾¸ë©´ `(rs, n) -> new Book(rs)`

2. ìƒí’ˆ ëª©ë¡ ì¡°íšŒ
```java
public List<Product> findAll() {
    String sql = """
                SELECT * FROM PRODUCTS
                WHERE status <> 'DELETED'
            """;
    return template.query(
            sql,
            new BeanPropertyRowMapper<>(Product.class)
    );
}
```
- BeanPropertyRowMapper: í…Œì´ë¸”ì˜ ì»¬ëŸ¼ëª…ê³¼ ì—”í„°í‹°í´ë˜ìŠ¤ì˜ í•„ë“œëª…ì´
- ë˜‘ê°™ì„ ê²½ìš° (camel, snake ì°¨ì´ë§Œ ë¹¼ê³ ) ìë™ ë§¤í•‘í•´ì¤Œ
- ì‚¬ìš©í•˜ë ¤ë©´ Product í´ë˜ìŠ¤ì— ê¸°ë³¸ ìƒì„±ì + setter ë©”ì„œë“œê°€ ìˆì–´ì•¼ í•¨.

3. SQLì˜ ì§‘ê³„ í•¨ìˆ˜ë¥¼ ì´ìš©í•œ ì „ì²´ ìƒí’ˆì˜ ì´ì•¡ê³¼ í‰ê·  ì¡°íšŒ
3-1. Map í˜•íƒœë¡œ return
```java
public Map<String, Number> getPriceInfo() {
    String sql = """
            SELECT 
                SUM(price * stock_quantity) AS "total_price"
                , AVG(price * stock_quantity) AS "average_price"
            FROM PRODUCTS
            WHERE status = 'ACTIVE'
            """;

    return template.queryForObject(sql, (rs, rowNum) -> {
        int totalPrice = rs.getInt("total_price");
        double averagePrice = rs.getDouble("average_price");
        // Mapìœ¼ë¡œ ë¦¬í„´í•˜ê¸°
        return Map.of(
                "total", totalPrice,
                "average", averagePrice
        );
    });
}
```
3-2. PriceInfo í´ë˜ìŠ¤, dtoë¡œ ë¦¬í„´
- PriceInfo dto í´ë˜ìŠ¤
```java
@Getter
@Setter
@ToString
@EqualsAndHashCode
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class PriceInfo {
    private int totalPrice;
    private double averagePrice;
}
```

- returnë¬¸
```java
return template.queryForObject(sql, (rs, rowNum) -> {
    int totalPrice = rs.getInt("total_price");
    double averagePrice = rs.getDouble("average_price");
    // dtoë¡œ ë¦¬í„´
    return new PriceInfo(totalPrice, averagePrice);
});
```

3-3. BeanPropertyRowMapper, dto ì‚¬ìš© return
```java
return template.queryForObject(sql, new BeanPropertyRowMapper<>(PriceInfo.class));
```

íŒŒë¼ë¯¸í„° ì²˜ë¦¬ ë°©ë²•
JdbcTemplateì€ SQL íŒŒë¼ë¯¸í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì—¬ëŸ¬ ë°©ë²•ì„ ì œê³µí•¨
1. ìˆœì„œ ê¸°ë°˜ íŒŒë¼ë¯¸í„°
ê°€ì¥ ê¸°ë³¸ì ì¸ ë°©ë²•:
```java
jdbcTemplate.update(
    "INSERT INTO products (name, price) VALUES (?, ?)",
    "ìƒˆìš°ê¹¡",  // ì²« ë²ˆì§¸ ?
    1500      // ë‘ ë²ˆì§¸ ?
);
```

2. ì´ë¦„ ê¸°ë°˜ íŒŒë¼ë¯¸í„°
ë” ì½ê¸° ì‰½ê³  ì‹¤ìˆ˜í•  ê°€ëŠ¥ì„±ì´ ì ìŒ:
```java
MapSqlParameterSource params = new MapSqlParameterSource()
   .addValue("name", "ìƒˆìš°ê¹¡")
   .addValue("price", 1500);

namedParameterJdbcTemplate.update(
    "INSERT INTO products (name, price) VALUES (:name, :price)",
    params
);
```







