# ğŸ—“ï¸ 2025ë…„ 7ì›” 28ì¼ TIL


Spring JPA
- Spring Frameworkì˜ í•˜ìœ„ í”„ë¡œì íŠ¸ ì¤‘ í•˜ë‚˜
- ìë°” ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì˜ ë°ì´í„°ë¥¼ ì ‘ê·¼í•˜ê³  ì¡°ì‘í•˜ëŠ”ë° ì‚¬ìš©ë˜ëŠ” í‘œì¤€ì¸
- JPA(Java Persistence API)ë¥¼ ë”ìš± ì‰½ê³  í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì¤Œ

JPA(Java Persistence API)
- Java EE5ë¶€í„° ë“±ì¥í•œ APIë¡œ, ìë°” ê°œë°œìê°€ RDBMSë¥¼ ë³´ë‹¤ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•˜ê¸° ìœ„í•œ ëª©ì ìœ¼ë¡œ ì œì‘
- ORM(Object-Relational Mapping) í‘œì¤€ ê¸°ìˆ 
- ìë°” í´ë˜ìŠ¤ì™€ DB í…Œì´ë¸” ê°„ì˜ ë§¤í•‘ ì •ë³´ë¥¼ ì‚¬ìš©
- SQL Query ì—†ì´ ë°ì´í„°ë¥¼ ì¡°ì‘í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤Œ


ìŠ¤í”„ë§ JPA ê¸°ëŠ¥
- Repository ì¸í„°í˜ì´ìŠ¤: ê¸°ë³¸ CRUD ì—°ì‚° ë©”ì†Œë“œë¥¼ ì œê³µ
- ì¿¼ë¦¬ ë©”ì†Œë“œ: ë©”ì†Œë“œ ì´ë¦„ì„ í†µí•´ ì¿¼ë¦¬ë¥¼ ìƒì„±í•˜ê³  ì‹¤í–‰
- í˜ì´ì§•ê³¼ ì •ë ¬: í˜ì´ì§•ê³¼ ì •ë ¬ì— ëŒ€í•œ ë³µì¡í•œ ì½”ë“œë¥¼ ë‹¨ìˆœí™”
- ë™ì  ì¿¼ë¦¬: ì¡°ê±´ì— ë”°ë¼ ë™ì ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ìƒì„±


Spring bootì—ì„œ JPA ê¸°ë³¸ì„¤ì •

```yaml
# application.yml

server:
  port: 9001

spring:
  application:
    name: spring-db202507
  datasource:
    url: jdbc:mariadb://localhost:3306/spring_study
    username: root
    password: mariadb
  jpa:
    hibernate:
      ddl-auto: create # sql ìë™ ìƒì„±
    properties:
      hibernate:
        format_sql: true # sql ì„¸ë¡œë¡œ ì¨ì£¼ëŠ” ì˜µì…˜
    database: mysql
```
ddl-auto: create # sql ìë™ ìƒì„±
í…Œì´ë¸”ì„ dropí•˜ê³  ìƒˆë¡œ createí•¨.
ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ìŒ“ê³ ì‹¶ìœ¼ë©´ updateë¡œ ë³€ê²½
ì‹¤ë¬´ or ë°°í¬ ê³¼ì •ì—ì„  ë³´í†µì€ noneìœ¼ë¡œ í•¨.
ìë™í™”ëœ DDL ì‘ì—…ì€ ì˜ˆê¸°ì¹˜ ì•Šì€ ë°ì´í„° ì†ì‹¤ì„ ì´ˆë˜í•  ìˆ˜ ìˆìŒ.



Entity í´ë˜ìŠ¤ ìƒì„±í•˜ê¸°

MyBatisì—ì„œëŠ” DBì— í…Œì´ë¸” ìƒì„± -> ì—”í„°í‹° ìƒì„± -> mapper ìƒì„± -> mapper xml íŒŒì¼ ì‘ì„±
JPAì—ì„œëŠ” ì—”í„°í‹° ìƒì„± -> Repository ìƒì„±, sql ì½”ë“œë„ ì§ì ‘ ì“¸ í•„ìš” ì—†ìŒ

JPAì—ì„œ Entity í´ë˜ìŠ¤ë¥¼ ìƒì„±í•  ë•Œ ì‚¬ìš©ë˜ëŠ” ì£¼ìš” Annotation
1. @Entity
- í´ë˜ìŠ¤ë¥¼ JPA Entityë¡œ ì„ ì–¸í•˜ëŠ” ë° ì‚¬ìš©
- ì´ í´ë˜ìŠ¤ëŠ” ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ê³¼ 1:1ë¡œ ë§¤ì¹­ë˜ëŠ” í´ë˜ìŠ¤ì„ì„ ë°í˜

```java
@Entity
public class User {
    // ...
}
```

2. @Table
- ì—”í‹°í‹°ê°€ ì—°ê²°ë  ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ì§€ì •
- ìƒëµí•˜ë©´ í´ë˜ìŠ¤ ì´ë¦„ì´ í…Œì´ë¸” ì´ë¦„ìœ¼ë¡œ ì‚¬ìš©ë¨
```java
@Entity
@Table(name="users")
public class User {
    // ...
}
```

3. @Id
- í•„ë“œê°€ ì—”í‹°í‹°ì˜ ê¸°ë³¸ í‚¤(Primary Key)ì„ì„ ì§€ì •
```java
@Entity
public class User {
    @Id
    private Long id;
}
```

4. @GeneratedValue
- ê¸°ë³¸ í‚¤ì˜ ìƒì„± ì „ëµì„ ì§€ì •
```java
@Entity
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO) // ìë™ìƒì„±
    private Long id;
}
```

5. @Column
- í•„ë“œê°€ ë§¤í•‘ë  ë°ì´í„°ë² ì´ìŠ¤ ì»¬ëŸ¼ì„ ì§€ì •
- name(ì»¬ëŸ¼ ì´ë¦„), nullable(ë„ ê°€ëŠ¥ ì—¬ë¶€), length(ê¸¸ì´ ì œí•œ), updatable(ìˆ˜ì •ê°€ëŠ¥ì—¬ë¶€), unique ë“±ì˜ ì†ì„± ì„¤ì • ê°€ëŠ¥
```java
@Entity
public class User {
    @Id
    @GeneratedValue
    private Long id;

    @Column(name="prod_nm", length = 50, nullable=false, unique=true)
    private String username;
}
```

6. @CreationTimestamp
- INSERTì‹œ ìë™ìœ¼ë¡œ ì‹œê°„ì„ ì €ì¥

7. @UpdateTimestamp
- UPDATEë¬¸ ì‹¤í–‰ì‹œ ìë™ìœ¼ë¡œ ì‹œê°„ ìˆ˜ì •

8. @Enumerated
- Javaì˜ enum íƒ€ì…ì„ ë§¤í•‘í•˜ëŠ” ë° ì‚¬ìš©
- @Enumeratedì€ ORDINAL ë˜ëŠ” STRING ì¤‘ í•˜ë‚˜ì˜ ê°’ì„ ê°€ì§ˆ ìˆ˜ ìˆìŒ
- ì—´ê±°í˜•ë°ì´í„°ëŠ” ë”°ë¡œ ì˜µì…˜ì„ ì•ˆì£¼ë©´ ìˆ«ìë¡œ ì €ì¥í•¨.
- FOOD: 1, FASHION: 2, ...
```java
public class Product {
	@Enumerated(EnumType.STRING)
	private Category category; // ìƒí’ˆ ì¹´í…Œê³ ë¦¬

	public enum Category {
		FOOD, FASHION, ELECTRONIC
	}
}
```



í…ŒìŠ¤íŠ¸ë¥¼ ë§ì´ í•´ì•¼í•˜ëŠ”ë°, ë°ì´í„°ê°€ ê³„ì† ìŒ“ìœ¼ë©´ ë³„ë¡œ ì•ˆì¢‹ìŒ
ddl-auto: updateë¡œ í•´ë†“ê³  ë¡¤ë°±ì„ í•´ì£¼ë©´ ë¨
í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ì— @Transactional (ìŠ¤í”„ë§í”„ë ˆì„ì›Œí¬) ì•„ë…¸í…Œì´ì…˜ ì¶”ê°€
@Rollback ì•„ë…¸í…Œì´ì…˜ ì¶”ê°€ - í…ŒìŠ¤íŠ¸ê°€ ëë‚˜ë©´ DMLì„ ì·¨ì†Œ


JpaRepository
- Spring Data JPAì—ì„œ ê¸°ë³¸ì ì¸ Repository ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“œëŠ” ë°©ë²•ì€ ë§¤ìš° ê°„ë‹¨
- ì‚¬ìš©í•  ì—”í‹°í‹°ë¥¼ Productë¼ê³  ê°€ì •
- JpaRepositoryì˜ ì²«ë²ˆì§¸ ì œë„ˆë¦­ íƒ€ì…ì€ ì—”í‹°í‹°ì˜ íƒ€ì…
- ë‘ë²ˆì§¸ ì œë„ˆë¦­ íƒ€ì…ì€ Primary Keyì˜ íƒ€ì…
```java
public interface ProductJpaRepository extends JpaRepository<Product, Long> { // ì—”í‹°í‹°, PKì˜ íƒ€ì…

}
```

JpaRepositoryë¥¼ ìƒì†í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ ê¸°ë³¸ CRUD ë©”ì„œë“œë“¤ì´ ìë™ìœ¼ë¡œ ì œê³µ
- `save(S entity)`: ì£¼ì–´ì§„ ì—”í‹°í‹°ë¥¼ ì €ì¥í•˜ê³  ë°˜í™˜í•©ë‹ˆë‹¤.
- `findById(ID id)`: ì£¼ì–´ì§„ IDë¥¼ ê°€ì§„ ì—”í‹°í‹°ë¥¼ ì°¾ì•„ Optionalë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.
- `existsById(ID id)`: ì£¼ì–´ì§„ IDë¥¼ ê°€ì§„ ì—”í‹°í‹°ì˜ ì¡´ì¬ ì—¬ë¶€ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
- `findAll()`: ëª¨ë“  ì—”í‹°í‹°ë¥¼ ì°¾ì•„ ë°˜í™˜í•©ë‹ˆë‹¤.
- `count()`: ì—”í‹°í‹°ì˜ ì´ ìˆ˜ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
- `deleteById(ID id)`: ì£¼ì–´ì§„ IDë¥¼ ê°€ì§„ ì—”í‹°í‹°ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤.
- `deleteAll()`: ëª¨ë“  ì—”í‹°í‹°ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤.

JpaRepository í…ŒìŠ¤íŠ¸

@SpringBootTest 
- ìŠ¤í”„ë§ì´ ê´€ë¦¬í•˜ëŠ” ëª¨ë“  Beanì„ ë¡œë”©
@Transactional
- íŠ¸ëœì­ì…˜(transaction)ì„ ì‹œì‘í•˜ê³ , ì„±ê³µí•˜ë©´ commit, ì‹¤íŒ¨í•˜ë©´ rollback í•´ì£¼ëŠ” ì• ë„ˆí…Œì´ì…˜
@Rollback 
- í…ŒìŠ¤íŠ¸ê°€ ëë‚˜ë©´ DMLì„ ì·¨ì†Œ
ìœ„ì˜ ì„¸ ì•„ë…¸í…Œì´ì…˜ì„ í•œê°€ì§€ë¡œ í†µí•©í•˜ëŠ” ì•„ë…¸í…Œì´ì…˜ `@DataJpaTest`

@DataJpaTest
- @Repository ë¹ˆë§Œ ë¡œë”©, ë¡¤ë°± ì˜µì…˜ ìë™ í¬í•¨, ë‚´ì¥ DBë§Œ ì‚¬ìš©ê°€ëŠ¥ (H2 Database)



SQL ë¡œê·¸ ì„¤ì • (p6spy)

build.gradle
dependencies {
	implementation 'com.github.gavlyukovskiy:p6spy-spring-boot-starter:1.9.1'
}




