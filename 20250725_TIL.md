# 🗓️ 2025년 7월 25일


MyBatis
주요 특징
1. SQL과 자바 코드의 분리
- SQL을 별도의 XML 파일에 작성
2. 자동 객체 매핑
- ResultSet을 자바 객체로 자동 변환
3. 동적 SQL 지원
- 조건에 따라 SQL이 변하는 상황을 쉽게 처리

설정 방법
1. 의존성 추가
build.gradle 파일
```text
dependencies {
    implementation 'org.mybatis.spring.boot:mybatis-spring-boot-starter:3.0.3'
}
```
2. 데이터베이스 연결 설정
application.yml 파일
```text
spring:
  application:
    name: spring-db202507
  datasource:
    url: jdbc:mariadb://localhost:3306/spring_study
    username: root
    password: mariadb

# MyBatis Setting
mybatis:
  # SQL file location
  mapper-locations: classpath:mappers/**/*.xml
  configuration:
    map-underscore-to-camel-case: true
  type-aliases-package: com.spring.database
  
```

3. SQL 테이블 생성
```sql
CREATE TABLE tbl_pet (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    pet_name VARCHAR(50),
    pet_age INT,
    injection BOOLEAN
) CHARSET=utf8mb4;
```

4. 엔티티 생성
- 생성한 SQL 테이블의 속성과 동일한 필드를 갖게끔 만들음
```java
public class Pet {
    private Long id;
    private String petName;
    private int petAge;
    private boolean injection;
}
```


5. Mapper 인터페이스 작성
```java
// CRUD를 명세
@Mapper
public interface PetMapper {
    // CREATE
    boolean save(Pet pet);
    // READ - SINGLE MATCHING
    Pet findById(Long id);
    // 나머지 기능 ...
}
```
@Mapper 어노테이션: 스프링에 빈 자동 등록, 구현체를 MyBatis가 직접 만들어줌
jdbc 사용할 때는 구현체(클래스)를 직접 만들어야 했음

6. XML 매퍼 파일 작성

팁! MyBatis Mapper XML 파일 기본 설정
```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.mybatis.example.BlogMapper">
  <select id="selectBlog" resultType="Blog">
    select * from Blog where id = #{id}
  </select>
</mapper>
```
- 설정 파일에서 mapper-locations: classpath:mappers/**/*.xml
- 그러므로 resources/mappers 폴더 내부에 xml 파일을 생성해야 함.
- mapper 태그의 namespace에는 연결할 인터페이스의 풀네임(패키지명+클래스명)을 작성



### 주요 SQL 요소 알아보기
- id: 연결된 인터페이스의 추상메서드 이름을 정확하게 적음
- 마이바티스의 sql 문법에서 `;` 쓰면 안된다.

INSERT 문
```xml
<insert id="save">
    INSERT INTO tbl_pet
    (pet_name, pet_age, injection)
    VALUES
    (#{petName}, #{petAge}, #{injection})
</insert>
```


SELECT 문
```xml
<select id="findById" resultType="com.spring.database.chap03.entity.Pet">
    SELECT *
    FROM tbl_pet
    WHERE id = #{id}
</select>
```
- resultType : 결과 테이블을 어떤 자바 객체에 연결할건지
- 설정 파일에서 type-aliases-package: com.spring.database을 해줬음
- 프로젝트 파일 내에서 반환할 엔티티가 유일(이름 안겹침)하면 `Pet`으로 써줄 수 있음
- 마이바티스는 단일조회면 단일으로 나오고
- 여러개 조회면 리스트 형식으로 나옴










