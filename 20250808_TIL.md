# 🗓️ 2025년 8월 8일 TIL

## 🔑 오늘의 키워드

* Spring Boot
* REST API
* 중복 체크
* JPA `existsBy...`
* Controller–Service–Repository 계층 분리
* 표준 응답 포맷 `ApiResponse`

---

## 1) 오늘 한 일 개요

* 회원가입 UX 개선을 위해 **사용자명 중복 체크 API**와 **이메일 중복 체크 API**를 구현.
* `UserRepository`의 `existsBy...` 메서드를 사용하여 **존재 여부만 빠르게 확인**.
* Controller에서는 **표준 응답 포맷(ApiResponse)** 으로 메시지와 불리언 값을 함께 반환.

---

## 2) 구현 코드

### 📌 UserRepository

```java
public interface UserRepository extends JpaRepository<User, Long> {
    Optional<User> findByUsername(String username);
    Optional<User> findByEmail(String email);

    // 중복확인
    boolean existsByUsername(String username);
    boolean existsByEmail(String email);
}
```

* `existsByUsername`, `existsByEmail`은 DB에서 존재 여부만 반환하므로 **성능상 유리**.

---

### 📌 UserService

```java
@Service
@RequiredArgsConstructor
@Transactional
@Slf4j
public class UserService {

    private final UserRepository userRepository;

    public boolean checkDuplicateUsername(String username) {
        return userRepository.existsByUsername(username);
    }

    public boolean checkDuplicateEmail(String email) {
        return userRepository.existsByEmail(email);
    }
}
```

* 단순 호출로 중복 여부를 boolean으로 반환.

---

### 📌 AuthController

```java
@RestController
@RequestMapping("/api/auth")
@Slf4j
@RequiredArgsConstructor
public class AuthController {

    private final UserService userService;

    // 사용자명 중복 체크
    @GetMapping("/check-username")
    public ResponseEntity<?> checkUsername(@RequestParam String username) {
        boolean exists = userService.checkDuplicateUsername(username);
        return ResponseEntity.ok()
                .body(ApiResponse.success(
                        exists ? "이미 사용 중인 사용자명입니다." : "사용 가능한 사용자명입니다.",
                        exists
                ));
    }

    // 이메일 중복 체크
    @GetMapping("/check-email")
    public ResponseEntity<?> checkEmail(@RequestParam String email) {
        boolean exists = userService.checkDuplicateEmail(email);
        return ResponseEntity.ok()
                .body(ApiResponse.success(
                        exists ? "이미 사용 중인 이메일입니다." : "사용 가능한 이메일입니다.",
                        exists
                ));
    }
}
```

* `ApiResponse.success(message, exists)` 형태로 **메시지와 중복 여부를 함께 응답**.

---

## 3) API 명세

### 1) 사용자명 중복 체크

* **HTTP Method / URL**
  `GET /api/auth/check-username?username={value}`

* **Query Parameters**

  | 이름         | 타입     | 필수 | 설명              |
  | ---------- | ------ | -- | --------------- |
  | `username` | string | Y  | 중복 여부를 확인할 사용자명 |

* **Response: 200 OK** — `ApiResponse<Boolean>`

    * **스키마**

      ```json
      {
        "success": true,
        "message": "문자열",
        "timestamp": "YYYY-MM-DDTHH:mm:ss[.SSS]",
        "data": true
      }
      ```

        * `data`: `true` 이면 **중복(이미 사용 중)**, `false` 이면 **사용 가능**
    * **예시 (사용 가능)**

      ```json
      {
        "success": true,
        "message": "사용 가능한 사용자명입니다.",
        "timestamp": "2025-08-10T20:45:12.345",
        "data": false
      }
      ```
    * **예시 (중복)**

      ```json
      {
        "success": true,
        "message": "이미 사용 중인 사용자명입니다.",
        "timestamp": "2025-08-10T20:45:15.102",
        "data": true
      }
      ```

---

### 2) 이메일 중복 체크

* **HTTP Method / URL**
  `GET /api/auth/check-email?email={value}`

* **Query Parameters**

  | 이름      | 타입     | 필수 | 설명             |
  | ------- | ------ | -- | -------------- |
  | `email` | string | Y  | 중복 여부를 확인할 이메일 |

* **Response: 200 OK** — `ApiResponse<Boolean>`

    * **스키마**

      ```json
      {
        "success": true,
        "message": "문자열",
        "timestamp": "YYYY-MM-DDTHH:mm:ss[.SSS]",
        "data": true
      }
      ```

        * `data`: `true` 이면 **중복(이미 사용 중)**, `false` 이면 **사용 가능**
    * **예시 (사용 가능)**

      ```json
      {
        "success": true,
        "message": "사용 가능한 이메일입니다.",
        "timestamp": "2025-08-10T20:46:03.011",
        "data": false
      }
      ```
    * **예시 (중복)**

      ```json
      {
        "success": true,
        "message": "이미 사용 중인 이메일입니다.",
        "timestamp": "2025-08-10T20:46:05.427",
        "data": true
      }
      ```

---

### 참고 사항

* 컨트롤러는 `ApiResponse.success(message, exists)` 를 사용해 위와 같은 포맷으로 응답합니다.


---

## 4) 오늘 배운 점

* `existsBy...` 메서드는 존재 여부를 확인할 때 효율적이며, 엔티티 로딩 없이 처리 가능.
* API 응답에 **메시지와 상태값을 함께 제공**하면 프론트엔드에서 처리 로직을 단순화할 수 있다.
* 컨트롤러–서비스–리포지토리 계층 분리를 통해 유지보수성을 높일 수 있다.

