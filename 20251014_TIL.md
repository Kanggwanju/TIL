# ğŸ—“ï¸ 2025ë…„ 10ì›” 14ì¼ TIL

## ğŸ“Œ ì˜¤ëŠ˜ì˜ í‚¤ì›Œë“œ
`Docker Hub` `AWS EC2` `Docker Compose` `CI/CD` `Jenkins` `GitHub Actions` `S3 ì •ì  í˜¸ìŠ¤íŒ…` `ìë™ ë°°í¬`

---

## 1ï¸âƒ£ ë„ì»¤í—ˆë¸Œ(Docker Hub) í™œìš©

ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ì €ì¥í•˜ê³  ê³µìœ í•  ìˆ˜ ìˆëŠ” í´ë¼ìš°ë“œ ê¸°ë°˜ì˜ ì„œë¹„ìŠ¤

### ê¸°ë³¸ ì›Œí¬í”Œë¡œìš°

#### 1ë‹¨ê³„: ë„ì»¤ ë¡œê·¸ì¸
```shell
docker login
```

#### 2ë‹¨ê³„: ì´ë¯¸ì§€ íƒœê·¸ ì§€ì •
- ë„ì»¤ í—ˆë¸Œì—ì„œ ì €ì¥ì†Œ ìƒì„±(hub-test-image)
```shell
docker tag SOURCE_IMAGE[:TAG] TARGET_IMAGE[:TAG]

# ì˜ˆì‹œ
docker tag hub-test-image kgj0318/hub-test-image
```

**íŒŒë¼ë¯¸í„° ì„¤ëª…**
- `SOURCE_IMAGE`: íƒœê·¸ë¥¼ ì¶”ê°€í•  ê¸°ì¡´ ë¡œì»¬ ë„ì»¤ ì´ë¯¸ì§€ ì´ë¦„
- `SOURCE_TAG`: ì´ë¯¸ì§€ì˜ íŠ¹ì • íƒœê·¸ (ë¯¸ì§€ì • ì‹œ `latest`)
- `TARGET_IMAGE`: ì›ê²© ì €ì¥ì†Œì— ì €ì¥í•  ì´ë¯¸ì§€ ì´ë¦„
- `TARGET_TAG`: ìƒˆ ì´ë¯¸ì§€ì˜ íƒœê·¸ (ë¯¸ì§€ì • ì‹œ `latest`)

#### 3ë‹¨ê³„: ì´ë¯¸ì§€ í‘¸ì‹œ
- íƒœê·¸ê°€ ì§€ì •ëœ ì´ë¯¸ì§€ë¥¼ ë„ì»¤í—ˆë¸Œì— í‘¸ì‹œ

```shell
docker push myusername/myapp-image:latest

# ì˜ˆì‹œ
docker push kgj0318/hub-test-image
```

#### 4ë‹¨ê³„: ì´ë¯¸ì§€ ê°€ì ¸ì˜¤ê¸°
- ë„ì»¤í—ˆë¸Œì—ì„œ í•´ë‹¹ ì´ë¯¸ì§€ë¥¼ ë¡œì»¬ ë„ì»¤ í™˜ê²½ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ
```shell
docker pull kgj0318/hub-test-image:latest
```

### ğŸ’¡ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…: Already Exists ì´ìŠˆ

**ì›ì¸**
- ë„ì»¤ëŠ” ì´ë¯¸ì§€ ë ˆì´ì–´ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê¸° ìœ„í•´ ë‚´ë¶€ ìºì‹œ ì‹œìŠ¤í…œì„ ì‚¬ìš©
- ì´ë¯¸ ë‹¤ìš´ë¡œë“œí•œ ë ˆì´ì–´ëŠ” ë‹¤ì‹œ ë‹¤ìš´ë¡œë“œí•˜ì§€ ì•ŠìŒ

**í•´ê²°ë°©ë²•**
```shell
docker system prune
```

---

## 2ï¸âƒ£ AWS EC2ì— Docker í™˜ê²½ êµ¬ì¶•

### EC2 ë¦¬ëˆ…ìŠ¤ì— Docker ì„¤ì¹˜

```shell
sudo su                              # ê´€ë¦¬ì ì „í™˜
yum install docker -y                # docker ì„¤ì¹˜
systemctl start docker               # docker ì‹¤í–‰
systemctl enable docker              # docker ìë™ì‹¤í–‰ ì„¤ì •
sudo usermod -aG docker ec2-user     # docker ìœ ì €ê¶Œí•œ ë¶€ì—¬
docker --version                      # docker ë²„ì „ í™•ì¸
```

### EC2 ë¦¬ëˆ…ìŠ¤ì— Docker Compose ì„¤ì¹˜

```shell
# 1. ì‹¤í–‰íŒŒì¼ ë‹¤ìš´ë¡œë“œ
sudo curl -L "https://github.com/docker/compose/releases/download/v2.11.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose

# 2. ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬
sudo chmod +x /usr/local/bin/docker-compose

# 3. ë²„ì „ í™•ì¸
docker-compose --version
```

### í”„ë¡œì íŠ¸ ë°°í¬ ì‹¤ìŠµ

#### Git ì„¤ì¹˜ ë° í”„ë¡œì íŠ¸ í´ë¡ 
```shell
yum install git -y
git clone https://github.com/soongu/memo-api.git
```

#### Dockerfile ìƒì„±
```dockerfile
# 1. ë‹¨ì¼ ìŠ¤í…Œì´ì§€ ë¹Œë“œ: Amazon Corretto JDK ì´ë¯¸ì§€ í•˜ë‚˜ë¡œ ë¹Œë“œì™€ ì‹¤í–‰ì„ ëª¨ë‘ ì²˜ë¦¬í•©ë‹ˆë‹¤.
FROM amazoncorretto:17-al2-jdk

# ì‘ì—… ë””ë ‰í† ë¦¬ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
WORKDIR /app

# í˜„ì¬ ë””ë ‰í† ë¦¬ì˜ ëª¨ë“  íŒŒì¼ì„ ì»¨í…Œì´ë„ˆì˜ /app ë””ë ‰í† ë¦¬ë¡œ ë³µì‚¬í•©ë‹ˆë‹¤.
COPY . .

# Gradleì„ ì‚¬ìš©í•˜ì—¬ í”„ë¡œì íŠ¸ë¥¼ ë¹Œë“œí•©ë‹ˆë‹¤.
RUN ./gradlew clean build

# ë¹Œë“œëœ jar íŒŒì¼ì˜ ì´ë¦„ì„ app.jarë¡œ ë³€ê²½í•˜ê³  /app ë””ë ‰í† ë¦¬ë¡œ ì´ë™ì‹œí‚µë‹ˆë‹¤.
RUN mv /app/build/libs/*.jar /app/app.jar

# ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì‹œ Spring Bootì˜ 'prod' í”„ë¡œí•„ì„ í™œì„±í™”í•˜ê³ ,
# ë¹Œë“œëœ JAR íŒŒì¼ì„ ì§ì ‘ ì‹¤í–‰í•©ë‹ˆë‹¤.
ENTRYPOINT ["java", "-jar", "-Dspring.profiles.active=dev", "app.jar"]
```

#### ì´ë¯¸ì§€ ë¹Œë“œ ë° ì»¨í…Œì´ë„ˆ ì‹¤í–‰
```shell
# ì´ë¯¸ì§€ ë¹Œë“œ
docker build -t memo-api-image .

# ì»¨í…Œì´ë„ˆ ì‹¤í–‰
docker run -d -p 80:8080 --name memo-api-container memo-api-image

# ìƒíƒœ í™•ì¸
docker ps
docker logs memo-api-container

# ì»¨í…Œì´ë„ˆ ì¤‘ì§€
docker stop <ì»¨í…Œì´ë„ˆ ID>
```

#### Docker Hubì— í‘¸ì‹œ
```shell
docker login
docker tag memo-api-image kgj0318/memo-api-image
docker push kgj0318/memo-api-image:latest
docker pull kgj0318/memo-api-image:latest
```

### Docker Compose í™œìš©

#### docker-compose.yml ìƒì„±
```yaml
services:
  app:
    image: soongu/memo-api-image
    ports:
      - "80:8080"
```

#### ì‹¤í–‰ ëª…ë ¹ì–´
```shell
docker-compose up -d       # ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰
docker-compose down        # ì„œë¹„ìŠ¤ ì¤‘ì§€ ë° ë¦¬ì†ŒìŠ¤ ì œê±°
```

---

## 3ï¸âƒ£ CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶•

### Jenkins vs GitHub Actions

#### Jenkins
**ì¥ì **
- ì˜¤í”ˆ ì†ŒìŠ¤ ìë™í™” ì„œë²„
- í”ŒëŸ¬ê·¸ì¸ì„ í†µí•œ ìœ ì—°í•œ ì»¤ìŠ¤í„°ë§ˆì´ì§•
- ê±°ì˜ ëª¨ë“  í”„ë¡œì íŠ¸ì— ë§ê²Œ êµ¬ì„± ê°€ëŠ¥

**ë‹¨ì **
- ì„œë²„ì— ì§ì ‘ ì„¤ì¹˜ í•„ìš”
- ìœ ì§€ ê´€ë¦¬ì— ì‹œê°„ê³¼ ë…¸ë ¥ ì†Œìš”

#### GitHub Actions
**ì¥ì **
- GitHub ì €ì¥ì†Œ ë‚´ì—ì„œ ì§ì ‘ CI/CD ìë™í™”
- ì¶”ê°€ ì„œë²„ ì„¤ì¹˜ ë¶ˆí•„ìš”
- GitHub ì¸í”„ë¼ì—ì„œ ì‹¤í–‰
- ì„¤ì •ì´ ê°„ë‹¨í•˜ë©° í†µí•©ì´ ì‰¬ì›€

**ì í•©í•œ ê²½ìš°**
- ì†Œê·œëª¨~ì¤‘ê·œëª¨ í”„ë¡œì íŠ¸
- GitHubì„ ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ í”„ë¡œì íŠ¸

---

## 4ï¸âƒ£ GitHub Actionsë¡œ AWS S3ì— ë¦¬ì•¡íŠ¸ ì•± CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶•

### Step 1: AWS IAM ì‚¬ìš©ì ì„¤ì •

1. AWS ì½˜ì†” ë¡œê·¸ì¸
2. IAM â†’ ì‚¬ìš©ì â†’ ì‚¬ìš©ì ìƒì„±
3. ì‚¬ìš©ì ì´ë¦„ ì„¤ì •, ì§ì ‘ ì •ì±… ì—°ê²°
4. ê¶Œí•œ ì •ì±…: `AmazonS3FullAccess` ì²´í¬
5. ì•¡ì„¸ìŠ¤ í‚¤ IDì™€ ë¹„ë°€ ì•¡ì„¸ìŠ¤ í‚¤ ë°±ì—…

### Step 2: ë¡œì»¬ PC ì‚¬ìš©ì ë“±ë¡

```shell
aws configure --profile deploy-admin
# ì•¡ì„¸ìŠ¤ í‚¤, ë¹„ë°€ ì•¡ì„¸ìŠ¤ í‚¤ ì…ë ¥
# Default region name: ap-northeast-2
# Default output format: json
```

### Step 3: AWS S3 ë²„í‚· ìƒì„±

1. S3 â†’ ë²„í‚· ë§Œë“¤ê¸°
2. ë²„í‚· ì´ë¦„ ì„¤ì • (unique)
3. ëª¨ë“  í¼ë¸”ë¦­ ì•¡ì„¸ìŠ¤ ì°¨ë‹¨ í•´ì œ â†’ í•˜ë‹¨ ë…¸ë€ìƒ‰ ë°•ìŠ¤ ì²´í¬ â†’ ë²„í‚·ë§Œë“¤ê¸°
4. ë²„í‚· ì†ì„± â†’ ì •ì  ì›¹ ì‚¬ì´íŠ¸ í˜¸ìŠ¤íŒ… í™œì„±í™”
  - ì¸ë±ìŠ¤ ë¬¸ì„œ: `index.html`
  - ì˜¤ë¥˜ ë¬¸ì„œ: `index.html`
5. ë²„í‚· ê¶Œí•œ â†’ ë²„í‚· ì •ì±… í¸ì§‘ â†’ ì •ì±… ìƒì„±ê¸°
  - Type of Policy: `S3 Bucket Policy`
  - Principal: `*`
  - Actions: `GetObject`
  - ARN: `ë²„í‚· ARN/*`

### Step 4: React í”„ë¡œì íŠ¸ ë°°í¬ ì„¤ì •

#### package.jsonì— deploy ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€
```json
"scripts": {
  "dev": "vite",
  "build": "vite build",
 "deploy": "aws s3 sync ./dist s3://ë²„í‚·ëª… --profile=IAM ê³„ì •ëª…",
  "lint": "eslint .",
  "preview": "vite preview"
}
```

#### .github/workflows/deploy.yml ìƒì„±
```yaml
name: Deploy React App to S3

on:
  push:
    branches:
      - main  # main ë¸Œëœì¹˜ì— í‘¸ì‹œë  ë•Œ ì‹¤í–‰

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4  # ë¦¬í¬ì§€í† ë¦¬ ì½”ë“œ ì²´í¬ì•„ì›ƒ

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'  # Node.js ë²„ì „ ì§€ì •

      - name: Install Dependencies
        run: npm install  # ì˜ì¡´ì„± ì„¤ì¹˜

      - name: Build React App
        run: CI=false npm run build  # í”„ë¡œë•ì…˜ ë¹Œë“œ ìƒì„±

      - name: Deploy to AWS S3
        uses: jakejarvis/s3-sync-action@master
        with:
          args: --delete  #  ë¶ˆí•„ìš”í•œ íŒŒì¼ ì‚­ì œ
        env:
          AWS_S3_BUCKET: ${{ secrets.S3_BUCKET }}
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          AWS_REGION: ${{ secrets.AWS_REGION }}
          SOURCE_DIR: 'dist'  # ë¹Œë“œëœ íŒŒì¼ì´ ìˆëŠ” ë””ë ‰í† ë¦¬
```

#### GitHub Secrets ì„¤ì •

1. í”„ë¡œì íŠ¸ â†’ Settings â†’ Secrets and variables â†’ Actions
2. New repository secret í´ë¦­
3. ë‹¤ìŒ í•­ëª© ì¶”ê°€:
  - `S3_BUCKET`: ë²„í‚· ì´ë¦„
  - `AWS_ACCESS_KEY_ID`: IAM ì•¡ì„¸ìŠ¤ í‚¤
  - `AWS_SECRET_ACCESS_KEY`: IAM ë¹„ë°€ í‚¤
  - `AWS_REGION`: `ap-northeast-2`

#### ìë™ ë°°í¬
main ë¸Œëœì¹˜ì— í‘¸ì‹œí•˜ë©´ ìë™ìœ¼ë¡œ ë¹Œë“œ ë° ë°°í¬ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.

---

## ğŸ“ ìµœì¢… ì •ë¦¬

### ì˜¤ëŠ˜ ë°°ìš´ í•µì‹¬ ê°œë…

1. **ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ê´€ë¦¬**
  - Docker Hubë¥¼ í†µí•œ ì´ë¯¸ì§€ ê³µìœ  ë° ë°°í¬
  - íƒœê·¸ ê´€ë¦¬ì™€ ë²„ì „ ê´€ë¦¬ì˜ ì¤‘ìš”ì„±

2. **í´ë¼ìš°ë“œ í™˜ê²½ êµ¬ì¶•**
  - AWS EC2ì— Docker í™˜ê²½ ì„¤ì •
  - Docker Composeë¥¼ í™œìš©í•œ ë©€í‹° ì»¨í…Œì´ë„ˆ ê´€ë¦¬

3. **CI/CD ìë™í™”**
  - GitHub Actionsë¥¼ í†µí•œ ìë™ ë¹Œë“œ/ë°°í¬
  - í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬ì™€ ë³´ì•ˆ ì„¤ì •

4. **ì •ì  ì›¹ í˜¸ìŠ¤íŒ…**
  - S3ë¥¼ í™œìš©í•œ React ì•± ë°°í¬
  - ë²„í‚· ì •ì±… ì„¤ì •ê³¼ í¼ë¸”ë¦­ ì•¡ì„¸ìŠ¤ ê´€ë¦¬

### ì‹¤ë¬´ ì ìš© í¬ì¸íŠ¸

- **Docker Hub**: íŒ€ ê°„ ì´ë¯¸ì§€ ê³µìœ ë¡œ ê°œë°œ í™˜ê²½ í†µì¼
- **EC2 + Docker**: ì„œë²„ë¦¬ìŠ¤ë³´ë‹¤ ì œì–´ê°€ í•„ìš”í•œ ê²½ìš° í™œìš©
- **GitHub Actions**: ì½”ë“œ í‘¸ì‹œë§Œìœ¼ë¡œ ìë™ ë°°í¬ë˜ëŠ” íŒŒì´í”„ë¼ì¸ êµ¬ì¶•
- **S3 ì •ì  í˜¸ìŠ¤íŒ…**: í”„ë¡ íŠ¸ì—”ë“œ ì•±ì˜ ë¹ ë¥´ê³  ì €ë ´í•œ ë°°í¬
