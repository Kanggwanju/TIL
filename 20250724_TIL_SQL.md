# 🗓️ 2025년 7월 24일 TIL - SQL 정리

ORDER BY 절

결과 정렬하기 (Part 1. ORDER BY 기본)
- 추출된 데이터의 순서를 깔끔하게 정리해주는 명령어
- SQL 쿼리의 가장 마지막에 위치해서, 최종 결과를 우리가 원하는 기준에 맞춰 정렬


1. 오름차순 정렬: `ASC` (Ascending)
- 가장 작은 값부터 큰 값 순서로 정렬하는 방식
- **숫자**: 1, 2, 3, ...
- **문자**: A, B, C, ... (가나다순)
- **날짜**: 과거부터 현재 순
- 아무것도 지정하지 않으면, 이 오름차순(ASC)이 기본값으로 적용

```sql
-- registration_date를 기준으로 오름차순 정렬합니다.
-- ASC는 기본값이므로 생략할 수 있습니다.
SELECT
    username,
    registration_date
FROM
        USERS
ORDER BY
    registration_date ASC -- 또는 registration_date; 라고만 써도 동일하게 동작
; 
```

2. 내림차순 정렬: `DESC` (Descending)
- 가장 큰 값부터 작은 값 순서로 정렬
```sql
-- creation_date를 기준으로 내림차순 정렬합니다.
SELECT
    post_id,
    user_id,
    content,
    creation_date
FROM
    POSTS
ORDER BY
    creation_date DESC;
```

3. 여러 기준으로 정렬
```sql
-- 1차: post_type 오름차순, 2차: creation_date 내림차순으로 정렬
SELECT
    post_id,
    post_type,
    creation_date
FROM
    POSTS
ORDER BY
    post_type ASC         -- 1차 정렬 기준 (ASC는 생략 가능)
    , creation_date DESC  -- 2차 정렬 기준
;
```

결과 정렬하기 (Part 2. ORDER BY 고급)

4. 컬럼 위치 번호, 별명(Alias)으로 정렬 가능
```sql
SELECT
  USERNAME AS UNAME,  -- 1번
  REGISTRATION_DATE   -- 2번
FROM USERS
ORDER BY UNAME DESC, 2 ASC
-- 1차 정렬 기준이 이름임, 동명이인이 있을 경우에만 유의미하게 적용됨.
;
```

5. ORDER BY 절에 집계함수 사용 가능
```sql
-- 5강에서 배운 GROUP BY를 활용해 사용자별 게시물 수를 구하고,
-- 그 결과(별명: post_count)를 기준으로 내림차순 정렬합니다.
SELECT
    user_id,
    COUNT(*) AS post_count
FROM
    POSTS
GROUP BY
    user_id
-- 오더바이 절에 집계 함수 사용 가능, 별칭으로도 가능
ORDER BY COUNT(*) DESC, USER_ID DESC
;
```

6. `CASE` 표현식으로 내 마음대로 정렬하기
```sql
-- user_id가 1이면 1순위, 나머지는 2순위로 정렬 우선순위를 부여하고,
-- 같은 순위 내에서는 creation_date를 기준으로 내림차순 정렬합니다.
SELECT
    post_id,
    user_id,
    content,
    creation_date
FROM
    POSTS
ORDER BY
    CASE
        WHEN user_id = 21 THEN 1 -- user_id가 1이면 1순위
        ELSE 2                   -- 나머지는 2순위
    END ASC, -- 1차 정렬 기준: CASE 표현식
    creation_date DESC -- 2차 정렬 기준: 작성일
;
```
- user-id = 21이면 1으로 치환해서 생각하고, 나머지는 2로 치환해서 생각하는거라 보면 됨.
- 아이디가 21이면 위쪽, 나머지는 아래쪽에 있고, 작성일 기준으로 2차 정렬을 함.
- 2차 정렬을 하지 않았더라면 아이디가 21인 행이 위쪽, 나머지는 아래쪽에 순번대로 정렬된다. 


표준 조인

JOIN은 두 테이블을 가로로 합치는 문법
카티션 곱
- 조건 없이 JOIN을 하면 열의 개수는 x + y, 행의 개수는 x * y 형태로 결과가 나옵니다.
EMPLOYEES: 4행 3열 (ID, NAME, DEPT_ID)
DEPARTMENTS: 3행 2열 (ID, NAME)
```sql
SELECT *
FROM EMPLOYEES, DEPARTMENTS
;
```
- 열: 5열(3 + 2), 행: 12행 (4 * 3)

---

- 별칭 사용 가능
- 오라클 조인
```sql
SELECT
    E.ID,
    E.NAME,
    D.ID,
    D.NAME AS DEPT_NAME
FROM EMPLOYEES E, DEPARTMENTS D
WHERE E.DEPT_ID = D.ID
;
```

- 표준 조인, 다른 DB에서 사용, INNER는 생략 가능(기본값)
```sql
SELECT
  E.ID,
  E.NAME,
  D.ID,
  D.NAME AS DEPT_NAME
FROM EMPLOYEES E
INNER JOIN DEPARTMENTS D
ON E.DEPT_ID = D.ID
;
```

---




표준 조인 문법: `INNER JOIN ~ ON`
```sql
-- 피드 조회 (피드번호, 회원이름, 회원이메일, 피드 내용)
SELECT
    P.POST_ID,
    U.USERNAME,
    U.EMAIL,
    P.CONTENT
FROM POSTS P, USERS U
WHERE P.USER_ID = U.USER_ID
;

-- INNER가 생략되어 있음
SELECT
    P.POST_ID,
    U.USERNAME,
    U.EMAIL,
    P.CONTENT
FROM POSTS P
-- JOIN USERS U
INNER JOIN USERS U
ON P.USER_ID = U.USER_ID
;
```

여러 테이블을 연결하기 (3개 이상 JOIN)
- POST_TAGS 테이블에는 어떤 게시물에 어떤 태그(아이디)가 있는지만 담겨있음
- HASHTAGS 테이블에는 태그 아이디에 따라 어떤 태그 이름인지 담겨있음
-> 둘을 태그 아이디를 기준으로 합치면 어떤 게시물에 어떤 태그가 있는지 알 수 있음
-> 그럼 그 게시물의 내용은 무엇인가?
- POSTS 테이블의 CONTENT 칼럼에는 게시물 내용이 나와있음
-> 위의 합친 결과물과 POSTS 테이블을 태그 아이디 기준으로 합침
- 게시물 아이디, 게시물, 태그 이름을 뽑아낼 수 있음
- 이후 WHERE 절을 이용해서 특정한 태그를 가지고 있는 게시물을 뽑을 수 있다.
```sql
-- 해시태그 테이블 조회
SELECT * FROM HASHTAGS;
SELECT * FROM POST_TAGS;
SELECT * FROM POSTS;

SELECT
    PT.POST_ID,
    P.CONTENT,
    H.TAG_NAME
FROM POST_TAGS PT, HASHTAGS H, POSTS P
WHERE PT.TAG_ID = H.TAG_ID
  AND PT.POST_ID = P.POST_ID
  AND H.TAG_NAME LIKE '%일상%'
ORDER BY PT.POST_ID
;

-- 표준 이너 조인
SELECT
    PT.POST_ID,
    P.CONTENT,
    H.TAG_NAME
FROM POST_TAGS PT
INNER JOIN HASHTAGS H
ON PT.TAG_ID = H.TAG_ID
INNER JOIN POSTS P
ON PT.POST_ID = P.POST_ID
WHERE H.TAG_NAME LIKE '%일상%'
ORDER BY PT.POST_ID
;
```


